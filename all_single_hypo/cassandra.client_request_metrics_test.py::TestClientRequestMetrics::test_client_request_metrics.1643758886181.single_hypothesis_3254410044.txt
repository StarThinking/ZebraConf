my_type=hypothesis
proj=cassandra
u_test=client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
h_list[1]=read_request_timeout_in_ms@@@CassandraDaemon@@@-2@@@10000@@@3000
proj: cassandra
u_test: client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
h_list: read_request_timeout_in_ms@@@CassandraDaemon@@@-2@@@10000@@@3000
cassandra client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics 
-------------------------------- live log call ---------------------------------
23:59:05,70 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.

-------------------------------- live log call ---------------------------------
00:02:52,725 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_client_request_metrics failed (1 runs remaining out of 2).
	<class 'ccmlib.node.TimeoutError'>
	02 Feb 2022 00:02:00 [node1] after 120.13/120 seconds Missing: ['127.0.0.2:7000.* is now UP'] not found in system.log:
 Head: 
 Tail: ...
	[<TracebackEntry /root/cassandra-dtest/client_request_metrics_test.py:105>, <TracebackEntry /root/cassandra-dtest/client_request_metrics_test.py:405>, <TracebackEntry /root/cassandra-dtest/client_request_metrics_test.py:420>, <TracebackEntry /root/dtest/lib/python3.6/site-packages/ccmlib/node.py:895>, <TracebackEntry /root/dtest/lib/python3.6/site-packages/ccmlib/node.py:664>, <TracebackEntry /root/dtest/lib/python3.6/site-packages/ccmlib/node.py:592>, <TracebackEntry /root/dtest/lib/python3.6/site-packages/ccmlib/node.py:56>]
test_client_request_metrics passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 383.97 seconds ==========================
[msx] rc = 0
v1v2 running time = 405658982072
---> v1v2 test suceeded.
cassandra client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics 
-------------------------------- live log call ---------------------------------
00:05:47,399 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_client_request_metrics passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 146.77 seconds ==========================
[msx] rc = 0
v1v1 running time = 168638858424
cassandra client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics 
-------------------------------- live log call ---------------------------------
00:08:40,871 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_client_request_metrics passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 157.91 seconds ==========================
[msx] rc = 0
v2v2 running time = 179608604972
---> v1v1 and v2v2 test test suceeded.
cassandra client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics 
-------------------------------- live log call ---------------------------------
00:11:35,503 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_client_request_metrics passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 160.38 seconds ==========================
[msx] rc = 0
v1v2 running time = 182066101508
---> v1v2 test suceeded.
cassandra client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics 
-------------------------------- live log call ---------------------------------
00:14:35,996 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_client_request_metrics passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 163.38 seconds ==========================
[msx] rc = 0
v1v1 running time = 185019201861
cassandra client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics 
-------------------------------- live log call ---------------------------------
00:17:43,700 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_client_request_metrics passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 140.50 seconds ==========================
[msx] rc = 0
v2v2 running time = 162270918165
---> v1v1 and v2v2 test test suceeded.
cassandra client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics 
-------------------------------- live log call ---------------------------------
00:20:26,882 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_client_request_metrics passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 163.29 seconds ==========================
[msx] rc = 0
v1v2 running time = 184972978604
---> v1v2 test suceeded.
cassandra client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics 
-------------------------------- live log call ---------------------------------
00:23:33,149 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_____________ TestClientRequestMetrics.test_client_request_metrics _____________

self = <client_request_metrics_test.TestClientRequestMetrics object at 0x7f977a3fe400>

    def test_client_request_metrics(self):
        # this is written as a single test method in order to reuse the same cluster for all tests
        # setup_once configures and starts the cluster with all schema and preconditions required by all tests.
        self.setup_once()
    
>       self.write_nominal()

client_request_metrics_test.py:85: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
client_request_metrics_test.py:121: in write_nominal
    query_count)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <client_request_metrics_test.TestClientRequestMetrics object at 0x7f977a3fe400>
global_scope = 'Write'
metric_class = <class 'client_request_metrics_test.WriteMetrics'>
statement = <SimpleStatement query="INSERT INTO ks.t (k,c) VALUES (0,0)", consistency=ONE>
query_count = 5

    def validate_nominal(self, global_scope, metric_class, statement, query_count):
        query_cl = statement.consistency_level
        cl_scope = scope_for_cl(global_scope, query_cl)
        # Validate other CLs metrics are not changing. We're not messing with Quorum because of the async write coming from
        # role creation at startup.
        # If the test takes long enough, it's possible to see some of the time-based metrics shift.
        other_cls = [c for c in CL.value_to_name if c not in (query_cl, CL.QUORUM)]
        global_baseline = metric_class(global_scope)
        cl_baseline = metric_class(cl_scope)
        other_baselines = [metric_class(scope_for_cl(global_scope, c)) for c in other_cls]
        cassandra_version = self.dtest_config.cassandra_version_from_build
    
        global_baseline.validate(cassandra_version)
        cl_baseline.validate(cassandra_version)
        for b in other_baselines:
            b.validate(cassandra_version)
    
        for _ in range(query_count):
            self.session.execute(statement)
    
        global_updated = metric_class(global_scope)
        cl_updated = metric_class(cl_scope)
        global_updated.validate(cassandra_version)
        cl_updated.validate(cassandra_version)
    
        global_diff = global_updated.diff(global_baseline)
        cl_diff = cl_updated.diff(cl_baseline)
        for diff in [global_diff, cl_diff]:
            assert diff['TotalLatency.Count'] > 0, diff.scope
>           assert diff['Latency.Count'] == query_count, diff.scope
E           AttributeError: 'dict' object has no attribute 'scope'

client_request_metrics_test.py:162: AttributeError
---------------------------- Captured stdout setup -----------------------------
00:22:48,390 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
00:22:47,29 conftest INFO Starting execution of test_client_request_metrics at 2022-02-02 00:22:47.029879
00:22:48,290 dtest_setup INFO cluster ccm directory: /tmp/dtest-9wr893l4
------------------------------ Captured log call -------------------------------
00:22:49,635 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '03021badca66', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'client_request_metrics_test.py::TestClientRequestMetrics::()::test_client_request_metrics (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9wr893l4/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9wr893l4/test/node1/conf'}
00:22:49,636 ccm INFO node1: using Java 8 for the current invocation
00:22:49,813 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '03021badca66', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'client_request_metrics_test.py::TestClientRequestMetrics::()::test_client_request_metrics (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9wr893l4/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9wr893l4/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.test.fail_writes_ks=fail_keyspace -Dcassandra.migration_task_wait_in_seconds=4'}
00:22:49,813 ccm INFO node1: using Java 8 for the current invocation
00:22:49,898 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
00:22:50,155 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '03021badca66', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'client_request_metrics_test.py::TestClientRequestMetrics::()::test_client_request_metrics (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9wr893l4/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9wr893l4/test/node2/conf'}
00:22:50,156 ccm INFO node2: using Java 8 for the current invocation
00:22:50,318 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '03021badca66', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'client_request_metrics_test.py::TestClientRequestMetrics::()::test_client_request_metrics (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9wr893l4/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9wr893l4/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.test.fail_writes_ks=fail_keyspace -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
00:22:50,319 ccm INFO node2: using Java 8 for the current invocation
00:22:50,405 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
00:23:14,555 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
00:23:33,149 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
00:23:35,704 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_client_request_metrics failed and was not selected for rerun.
	<class 'AttributeError'>
	'dict' object has no attribute 'scope'
	[<TracebackEntry /root/cassandra-dtest/client_request_metrics_test.py:85>, <TracebackEntry /root/cassandra-dtest/client_request_metrics_test.py:121>, <TracebackEntry /root/cassandra-dtest/client_request_metrics_test.py:162>]

===End Flaky Test Report===
========================== 1 failed in 49.38 seconds ===========================
[msx] rc = 1
v1v1 running time = 71288003924
cassandra client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics 
-------------------------------- live log call ---------------------------------
00:24:42,235 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_____________ TestClientRequestMetrics.test_client_request_metrics _____________

self = <client_request_metrics_test.TestClientRequestMetrics object at 0x7f97ecfa2748>

    def test_client_request_metrics(self):
        # this is written as a single test method in order to reuse the same cluster for all tests
        # setup_once configures and starts the cluster with all schema and preconditions required by all tests.
        self.setup_once()
    
>       self.write_nominal()

client_request_metrics_test.py:85: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
client_request_metrics_test.py:121: in write_nominal
    query_count)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <client_request_metrics_test.TestClientRequestMetrics object at 0x7f97ecfa2748>
global_scope = 'Write'
metric_class = <class 'client_request_metrics_test.WriteMetrics'>
statement = <SimpleStatement query="INSERT INTO ks.t (k,c) VALUES (0,0)", consistency=ONE>
query_count = 5

    def validate_nominal(self, global_scope, metric_class, statement, query_count):
        query_cl = statement.consistency_level
        cl_scope = scope_for_cl(global_scope, query_cl)
        # Validate other CLs metrics are not changing. We're not messing with Quorum because of the async write coming from
        # role creation at startup.
        # If the test takes long enough, it's possible to see some of the time-based metrics shift.
        other_cls = [c for c in CL.value_to_name if c not in (query_cl, CL.QUORUM)]
        global_baseline = metric_class(global_scope)
        cl_baseline = metric_class(cl_scope)
        other_baselines = [metric_class(scope_for_cl(global_scope, c)) for c in other_cls]
        cassandra_version = self.dtest_config.cassandra_version_from_build
    
        global_baseline.validate(cassandra_version)
        cl_baseline.validate(cassandra_version)
        for b in other_baselines:
            b.validate(cassandra_version)
    
        for _ in range(query_count):
            self.session.execute(statement)
    
        global_updated = metric_class(global_scope)
        cl_updated = metric_class(cl_scope)
        global_updated.validate(cassandra_version)
        cl_updated.validate(cassandra_version)
    
        global_diff = global_updated.diff(global_baseline)
        cl_diff = cl_updated.diff(cl_baseline)
        for diff in [global_diff, cl_diff]:
            assert diff['TotalLatency.Count'] > 0, diff.scope
>           assert diff['Latency.Count'] == query_count, diff.scope
E           AttributeError: 'dict' object has no attribute 'scope'

client_request_metrics_test.py:162: AttributeError
---------------------------- Captured stdout setup -----------------------------
00:24:00,43 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
00:23:58,275 conftest INFO Starting execution of test_client_request_metrics at 2022-02-02 00:23:58.275482
00:23:59,937 dtest_setup INFO cluster ccm directory: /tmp/dtest-cmmekewz
------------------------------ Captured log call -------------------------------
00:24:01,164 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '03021badca66', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'client_request_metrics_test.py::TestClientRequestMetrics::()::test_client_request_metrics (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-cmmekewz/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-cmmekewz/test/node1/conf'}
00:24:01,165 ccm INFO node1: using Java 8 for the current invocation
00:24:01,341 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '03021badca66', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'client_request_metrics_test.py::TestClientRequestMetrics::()::test_client_request_metrics (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-cmmekewz/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-cmmekewz/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.test.fail_writes_ks=fail_keyspace -Dcassandra.migration_task_wait_in_seconds=4'}
00:24:01,342 ccm INFO node1: using Java 8 for the current invocation
00:24:01,433 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
00:24:01,715 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '03021badca66', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'client_request_metrics_test.py::TestClientRequestMetrics::()::test_client_request_metrics (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-cmmekewz/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-cmmekewz/test/node2/conf'}
00:24:01,722 ccm INFO node2: using Java 8 for the current invocation
00:24:01,908 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '03021badca66', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'client_request_metrics_test.py::TestClientRequestMetrics::()::test_client_request_metrics (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-cmmekewz/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-cmmekewz/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.test.fail_writes_ks=fail_keyspace -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
00:24:01,909 ccm INFO node2: using Java 8 for the current invocation
00:24:01,989 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
00:24:25,149 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
00:24:42,235 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
00:24:46,965 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_client_request_metrics failed and was not selected for rerun.
	<class 'AttributeError'>
	'dict' object has no attribute 'scope'
	[<TracebackEntry /root/cassandra-dtest/client_request_metrics_test.py:85>, <TracebackEntry /root/cassandra-dtest/client_request_metrics_test.py:121>, <TracebackEntry /root/cassandra-dtest/client_request_metrics_test.py:162>]

===End Flaky Test Report===
========================== 1 failed in 49.37 seconds ===========================
[msx] rc = 1
v2v2 running time = 71165429569
---> v1v1 or v2v2 test failed.
v1v1 failed in a hypo test
proj: cassandra
u_test: client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
h_list: read_request_timeout_in_ms@@@CassandraDaemon@@@-2@@@10000@@@3000
vv_mode: v1v1
result: FAIL
failureMessage: 
stackTrace: 

v2v2 failed in a hypo test
proj: cassandra
u_test: client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
h_list: read_request_timeout_in_ms@@@CassandraDaemon@@@-2@@@10000@@@3000
vv_mode: v2v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics 
-------------------------------- live log call ---------------------------------
00:25:53,829 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_client_request_metrics passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 163.53 seconds ==========================
[msx] rc = 0
v1v2 running time = 185316063621
---> v1v2 test suceeded.
cassandra client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics 
-------------------------------- live log call ---------------------------------
00:28:55,37 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_client_request_metrics passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 161.63 seconds ==========================
[msx] rc = 0
v1v1 running time = 183289958258
cassandra client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics 
-------------------------------- live log call ---------------------------------
00:31:55,598 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_client_request_metrics passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 137.16 seconds ==========================
[msx] rc = 0
v2v2 running time = 158959820195
---> v1v1 and v2v2 test test suceeded.
cassandra client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics 
-------------------------------- live log call ---------------------------------
00:34:38,18 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_client_request_metrics passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 146.53 seconds ==========================
[msx] rc = 0
v1v2 running time = 168198471488
---> v1v2 test suceeded.
cassandra client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics 
-------------------------------- live log call ---------------------------------
00:37:28,368 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_client_request_metrics passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 144.29 seconds ==========================
[msx] rc = 0
v1v1 running time = 166003545895
cassandra client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics 
-------------------------------- live log call ---------------------------------
00:40:11,380 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_client_request_metrics passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 137.44 seconds ==========================
[msx] rc = 0
v2v2 running time = 159212312412
---> v1v1 and v2v2 test test suceeded.
cassandra client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics 
-------------------------------- live log call ---------------------------------
00:42:52,241 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_client_request_metrics passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 148.66 seconds ==========================
[msx] rc = 0
v1v2 running time = 170375512054
---> v1v2 test suceeded.
cassandra client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics 
-------------------------------- live log call ---------------------------------
00:45:44,589 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_____________ TestClientRequestMetrics.test_client_request_metrics _____________

self = <client_request_metrics_test.TestClientRequestMetrics object at 0x7f92788ff3c8>

    def test_client_request_metrics(self):
        # this is written as a single test method in order to reuse the same cluster for all tests
        # setup_once configures and starts the cluster with all schema and preconditions required by all tests.
        self.setup_once()
    
>       self.write_nominal()

client_request_metrics_test.py:85: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
client_request_metrics_test.py:121: in write_nominal
    query_count)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <client_request_metrics_test.TestClientRequestMetrics object at 0x7f92788ff3c8>
global_scope = 'Write'
metric_class = <class 'client_request_metrics_test.WriteMetrics'>
statement = <SimpleStatement query="INSERT INTO ks.t (k,c) VALUES (0,0)", consistency=ONE>
query_count = 5

    def validate_nominal(self, global_scope, metric_class, statement, query_count):
        query_cl = statement.consistency_level
        cl_scope = scope_for_cl(global_scope, query_cl)
        # Validate other CLs metrics are not changing. We're not messing with Quorum because of the async write coming from
        # role creation at startup.
        # If the test takes long enough, it's possible to see some of the time-based metrics shift.
        other_cls = [c for c in CL.value_to_name if c not in (query_cl, CL.QUORUM)]
        global_baseline = metric_class(global_scope)
        cl_baseline = metric_class(cl_scope)
        other_baselines = [metric_class(scope_for_cl(global_scope, c)) for c in other_cls]
        cassandra_version = self.dtest_config.cassandra_version_from_build
    
        global_baseline.validate(cassandra_version)
        cl_baseline.validate(cassandra_version)
        for b in other_baselines:
            b.validate(cassandra_version)
    
        for _ in range(query_count):
            self.session.execute(statement)
    
        global_updated = metric_class(global_scope)
        cl_updated = metric_class(cl_scope)
        global_updated.validate(cassandra_version)
        cl_updated.validate(cassandra_version)
    
        global_diff = global_updated.diff(global_baseline)
        cl_diff = cl_updated.diff(cl_baseline)
        for diff in [global_diff, cl_diff]:
            assert diff['TotalLatency.Count'] > 0, diff.scope
>           assert diff['Latency.Count'] == query_count, diff.scope
E           AttributeError: 'dict' object has no attribute 'scope'

client_request_metrics_test.py:162: AttributeError
---------------------------- Captured stdout setup -----------------------------
00:45:01,834 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
00:45:00,667 conftest INFO Starting execution of test_client_request_metrics at 2022-02-02 00:45:00.667513
00:45:01,728 dtest_setup INFO cluster ccm directory: /tmp/dtest-jbzhv7pa
------------------------------ Captured log call -------------------------------
00:45:02,897 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '03021badca66', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'client_request_metrics_test.py::TestClientRequestMetrics::()::test_client_request_metrics (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-jbzhv7pa/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-jbzhv7pa/test/node1/conf'}
00:45:02,898 ccm INFO node1: using Java 8 for the current invocation
00:45:03,59 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '03021badca66', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'client_request_metrics_test.py::TestClientRequestMetrics::()::test_client_request_metrics (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-jbzhv7pa/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-jbzhv7pa/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.test.fail_writes_ks=fail_keyspace -Dcassandra.migration_task_wait_in_seconds=4'}
00:45:03,59 ccm INFO node1: using Java 8 for the current invocation
00:45:03,145 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
00:45:03,392 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '03021badca66', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'client_request_metrics_test.py::TestClientRequestMetrics::()::test_client_request_metrics (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-jbzhv7pa/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-jbzhv7pa/test/node2/conf'}
00:45:03,392 ccm INFO node2: using Java 8 for the current invocation
00:45:03,550 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '03021badca66', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'client_request_metrics_test.py::TestClientRequestMetrics::()::test_client_request_metrics (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-jbzhv7pa/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-jbzhv7pa/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.test.fail_writes_ks=fail_keyspace -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
00:45:03,550 ccm INFO node2: using Java 8 for the current invocation
00:45:03,635 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
00:45:29,796 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
00:45:44,589 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
00:45:47,783 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_client_request_metrics failed and was not selected for rerun.
	<class 'AttributeError'>
	'dict' object has no attribute 'scope'
	[<TracebackEntry /root/cassandra-dtest/client_request_metrics_test.py:85>, <TracebackEntry /root/cassandra-dtest/client_request_metrics_test.py:121>, <TracebackEntry /root/cassandra-dtest/client_request_metrics_test.py:162>]

===End Flaky Test Report===
========================== 1 failed in 47.78 seconds ===========================
[msx] rc = 1
v1v1 running time = 69628173308
cassandra client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics 
-------------------------------- live log call ---------------------------------
00:46:51,276 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_client_request_metrics passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 153.97 seconds ==========================
[msx] rc = 0
v2v2 running time = 175710433719
---> v1v1 or v2v2 test failed.
v1v1 failed in a hypo test
proj: cassandra
u_test: client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
h_list: read_request_timeout_in_ms@@@CassandraDaemon@@@-2@@@10000@@@3000
vv_mode: v1v1
result: FAIL
failureMessage: 
stackTrace: 

cassandra client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics 
-------------------------------- live log call ---------------------------------
00:49:47,135 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_client_request_metrics passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 142.56 seconds ==========================
[msx] rc = 0
v1v2 running time = 164143096553
---> v1v2 test suceeded.
cassandra client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics 
-------------------------------- live log call ---------------------------------
00:52:30,217 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_client_request_metrics passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 144.51 seconds ==========================
[msx] rc = 0
v1v1 running time = 166277380055
cassandra client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics 
-------------------------------- live log call ---------------------------------
00:55:17,719 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_____________ TestClientRequestMetrics.test_client_request_metrics _____________

self = <client_request_metrics_test.TestClientRequestMetrics object at 0x7f5972e26470>

    def test_client_request_metrics(self):
        # this is written as a single test method in order to reuse the same cluster for all tests
        # setup_once configures and starts the cluster with all schema and preconditions required by all tests.
        self.setup_once()
    
>       self.write_nominal()

client_request_metrics_test.py:85: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
client_request_metrics_test.py:121: in write_nominal
    query_count)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <client_request_metrics_test.TestClientRequestMetrics object at 0x7f5972e26470>
global_scope = 'Write'
metric_class = <class 'client_request_metrics_test.WriteMetrics'>
statement = <SimpleStatement query="INSERT INTO ks.t (k,c) VALUES (0,0)", consistency=ONE>
query_count = 5

    def validate_nominal(self, global_scope, metric_class, statement, query_count):
        query_cl = statement.consistency_level
        cl_scope = scope_for_cl(global_scope, query_cl)
        # Validate other CLs metrics are not changing. We're not messing with Quorum because of the async write coming from
        # role creation at startup.
        # If the test takes long enough, it's possible to see some of the time-based metrics shift.
        other_cls = [c for c in CL.value_to_name if c not in (query_cl, CL.QUORUM)]
        global_baseline = metric_class(global_scope)
        cl_baseline = metric_class(cl_scope)
        other_baselines = [metric_class(scope_for_cl(global_scope, c)) for c in other_cls]
        cassandra_version = self.dtest_config.cassandra_version_from_build
    
        global_baseline.validate(cassandra_version)
        cl_baseline.validate(cassandra_version)
        for b in other_baselines:
            b.validate(cassandra_version)
    
        for _ in range(query_count):
            self.session.execute(statement)
    
        global_updated = metric_class(global_scope)
        cl_updated = metric_class(cl_scope)
        global_updated.validate(cassandra_version)
        cl_updated.validate(cassandra_version)
    
        global_diff = global_updated.diff(global_baseline)
        cl_diff = cl_updated.diff(cl_baseline)
        for diff in [global_diff, cl_diff]:
            assert diff['TotalLatency.Count'] > 0, diff.scope
>           assert diff['Latency.Count'] == query_count, diff.scope
E           AttributeError: 'dict' object has no attribute 'scope'

client_request_metrics_test.py:162: AttributeError
---------------------------- Captured stdout setup -----------------------------
00:54:37,756 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
00:54:36,543 conftest INFO Starting execution of test_client_request_metrics at 2022-02-02 00:54:36.543055
00:54:37,653 dtest_setup INFO cluster ccm directory: /tmp/dtest-0nlx7bds
------------------------------ Captured log call -------------------------------
00:54:38,877 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '03021badca66', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'client_request_metrics_test.py::TestClientRequestMetrics::()::test_client_request_metrics (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-0nlx7bds/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-0nlx7bds/test/node1/conf'}
00:54:38,878 ccm INFO node1: using Java 8 for the current invocation
00:54:39,59 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '03021badca66', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'client_request_metrics_test.py::TestClientRequestMetrics::()::test_client_request_metrics (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-0nlx7bds/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-0nlx7bds/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.test.fail_writes_ks=fail_keyspace -Dcassandra.migration_task_wait_in_seconds=4'}
00:54:39,60 ccm INFO node1: using Java 8 for the current invocation
00:54:39,152 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
00:54:39,418 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '03021badca66', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'client_request_metrics_test.py::TestClientRequestMetrics::()::test_client_request_metrics (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-0nlx7bds/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-0nlx7bds/test/node2/conf'}
00:54:39,418 ccm INFO node2: using Java 8 for the current invocation
00:54:39,606 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '03021badca66', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'client_request_metrics_test.py::TestClientRequestMetrics::()::test_client_request_metrics (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-0nlx7bds/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-0nlx7bds/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.test.fail_writes_ks=fail_keyspace -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
00:54:39,607 ccm INFO node2: using Java 8 for the current invocation
00:54:39,697 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
00:55:01,865 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
00:55:17,719 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
00:55:22,188 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_client_request_metrics failed and was not selected for rerun.
	<class 'AttributeError'>
	'dict' object has no attribute 'scope'
	[<TracebackEntry /root/cassandra-dtest/client_request_metrics_test.py:85>, <TracebackEntry /root/cassandra-dtest/client_request_metrics_test.py:121>, <TracebackEntry /root/cassandra-dtest/client_request_metrics_test.py:162>]

===End Flaky Test Report===
========================== 1 failed in 46.31 seconds ===========================
[msx] rc = 1
v2v2 running time = 68044883092
---> v1v1 or v2v2 test failed.
v2v2 failed in a hypo test
proj: cassandra
u_test: client_request_metrics_test.py::TestClientRequestMetrics::test_client_request_metrics
h_list: read_request_timeout_in_ms@@@CassandraDaemon@@@-2@@@10000@@@3000
vv_mode: v2v2
result: FAIL
failureMessage: 
stackTrace: 

early stop after 7 is satisfied
v1v2 failed with probability 0 out of 7
v1v1v2v2 failed with probability 3 out of 7
Total execution time in seconds : 3445
0
