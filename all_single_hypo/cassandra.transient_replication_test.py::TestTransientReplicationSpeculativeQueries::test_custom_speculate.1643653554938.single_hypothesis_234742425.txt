my_type=hypothesis
proj=cassandra
u_test=transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
h_list[1]=native_transport_idle_timeout_in_ms@@@CassandraDaemon@@@-2@@@600@@@0
proj: cassandra
u_test: transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
h_list: native_transport_idle_timeout_in_ms@@@CassandraDaemon@@@-2@@@600@@@0
cassandra transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate 
-------------------------------- live log call ---------------------------------
18:34:04,421 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down


=================================== FAILURES ===================================
_______ TestTransientReplicationSpeculativeQueries.test_custom_speculate _______

self = <transient_replication_test.TestTransientReplicationSpeculativeQueries object at 0x7f7146ca3f60>

    @pytest.mark.no_vnodes
    def test_custom_speculate(self):
        """ If write can't succeed on full replica, it's written to the transient node instead """
        session = self.exclusive_cql_connection(self.node1)
        session.execute("ALTER TABLE %s.%s WITH speculative_retry = '99.99PERCENTILE';" % (self.keyspace, self.table))
        self.insert_row(1, 1, 1)
        # Stop writes to the other full node
        self.node2.byteman_submit([mk_bman_path('stop_writes.btm')])
>       self.insert_row(1, 2, 2)

transient_replication_test.py:622: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
transient_replication_test.py:259: in insert_row
    self.quorum(session, "INSERT INTO %s.%s (pk, ck, value) VALUES (%s, %s, %s)" % (self.keyspace, self.table, pk, ck, value))
transient_replication_test.py:243: in quorum
    return session.execute(SimpleStatement(stmt_str, consistency_level=ConsistencyLevel.QUORUM))
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
---------------------------- Captured stdout setup -----------------------------
18:33:37,720 ccm DEBUG Log-watching thread starting.
18:33:39,413 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-y7ebodhc/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-y7ebodhc/test/node1/conf'}
18:33:39,414 ccm INFO node1: using Java 8 for the current invocation
18:33:39,652 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-y7ebodhc/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-y7ebodhc/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:33:39,653 ccm INFO node1: using Java 8 for the current invocation
18:33:39,763 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:33:40,103 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-y7ebodhc/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-y7ebodhc/test/node2/conf'}
18:33:40,105 ccm INFO node2: using Java 8 for the current invocation
18:33:40,332 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-y7ebodhc/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-y7ebodhc/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:33:40,333 ccm INFO node2: using Java 8 for the current invocation
18:33:40,431 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:33:40,767 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-y7ebodhc/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-y7ebodhc/test/node3/conf'}
18:33:40,767 ccm INFO node3: using Java 8 for the current invocation
18:33:40,976 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-y7ebodhc/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-y7ebodhc/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:33:40,977 ccm INFO node3: using Java 8 for the current invocation
18:33:41,67 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
install rule block digest

---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
18:33:37,441 conftest INFO Starting execution of test_custom_speculate at 2022-01-31 18:33:37.441444
18:33:37,620 dtest_setup INFO cluster ccm directory: /tmp/dtest-y7ebodhc
18:33:39,413 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-y7ebodhc/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-y7ebodhc/test/node1/conf'}
18:33:39,414 ccm INFO node1: using Java 8 for the current invocation
18:33:39,652 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-y7ebodhc/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-y7ebodhc/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:33:39,653 ccm INFO node1: using Java 8 for the current invocation
18:33:39,763 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:33:40,103 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-y7ebodhc/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-y7ebodhc/test/node2/conf'}
18:33:40,105 ccm INFO node2: using Java 8 for the current invocation
18:33:40,332 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-y7ebodhc/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-y7ebodhc/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:33:40,333 ccm INFO node2: using Java 8 for the current invocation
18:33:40,431 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:33:40,767 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-y7ebodhc/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-y7ebodhc/test/node3/conf'}
18:33:40,767 ccm INFO node3: using Java 8 for the current invocation
18:33:40,976 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-y7ebodhc/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-y7ebodhc/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:33:40,977 ccm INFO node3: using Java 8 for the current invocation
18:33:41,67 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:34:00,238 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
18:34:00,240 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:34:00,461 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:34:00,462 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
------------------------------ Captured log call -------------------------------
18:34:02,377 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:34:02,378 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:34:03,340 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:34:03,341 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:34:03,756 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:34:03,757 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
--------------------------- Captured stdout teardown ---------------------------
FAILED                                                                   [100%]18:34:04,858 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_custom_speculate failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/transient_replication_test.py:622>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:259>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:243>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 28.24 seconds ===========================
[msx] rc = 1
v1v2 running time = 49959173974
---> v1v2 test failed.
proj: cassandra
u_test: transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
h_list: native_transport_idle_timeout_in_ms@@@CassandraDaemon@@@-2@@@600@@@0
vv_mode: v1v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate 
-------------------------------- live log setup --------------------------------
18:34:50,531 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
-------------------------------- live log call ---------------------------------
18:34:54,840 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down


=================================== FAILURES ===================================
_______ TestTransientReplicationSpeculativeQueries.test_custom_speculate _______

self = <transient_replication_test.TestTransientReplicationSpeculativeQueries object at 0x7f485b89c898>

    @pytest.mark.no_vnodes
    def test_custom_speculate(self):
        """ If write can't succeed on full replica, it's written to the transient node instead """
        session = self.exclusive_cql_connection(self.node1)
        session.execute("ALTER TABLE %s.%s WITH speculative_retry = '99.99PERCENTILE';" % (self.keyspace, self.table))
        self.insert_row(1, 1, 1)
        # Stop writes to the other full node
        self.node2.byteman_submit([mk_bman_path('stop_writes.btm')])
>       self.insert_row(1, 2, 2)

transient_replication_test.py:622: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
transient_replication_test.py:259: in insert_row
    self.quorum(session, "INSERT INTO %s.%s (pk, ck, value) VALUES (%s, %s, %s)" % (self.keyspace, self.table, pk, ck, value))
transient_replication_test.py:243: in quorum
    return session.execute(SimpleStatement(stmt_str, consistency_level=ConsistencyLevel.QUORUM))
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
------------------------------ Captured log setup ------------------------------
18:34:27,362 conftest INFO Starting execution of test_custom_speculate at 2022-01-31 18:34:27.362491
18:34:27,522 dtest_setup INFO cluster ccm directory: /tmp/dtest-dwg7r7td
18:34:29,445 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-dwg7r7td/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-dwg7r7td/test/node1/conf'}
18:34:29,447 ccm INFO node1: using Java 8 for the current invocation
18:34:29,658 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-dwg7r7td/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-dwg7r7td/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:34:29,659 ccm INFO node1: using Java 8 for the current invocation
18:34:29,767 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:34:30,112 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-dwg7r7td/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-dwg7r7td/test/node2/conf'}
18:34:30,113 ccm INFO node2: using Java 8 for the current invocation
18:34:30,332 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-dwg7r7td/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-dwg7r7td/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:34:30,333 ccm INFO node2: using Java 8 for the current invocation
18:34:30,436 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:34:30,779 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-dwg7r7td/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-dwg7r7td/test/node3/conf'}
18:34:30,779 ccm INFO node3: using Java 8 for the current invocation
18:34:31,8 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-dwg7r7td/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-dwg7r7td/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:34:31,9 ccm INFO node3: using Java 8 for the current invocation
18:34:31,119 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:34:49,312 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
18:34:49,315 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:34:49,518 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:34:49,519 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:34:50,531 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
18:34:51,744 cassandra.pool INFO Successful reconnection to 127.0.0.3:9042, marking node up if it isn't already
18:34:51,744 cassandra.cluster INFO Host 127.0.0.3:9042 may be up; will prepare queries and open connection pool
18:34:51,752 cassandra.cluster INFO Connection pools established for node 127.0.0.3:9042
------------------------------ Captured log call -------------------------------
18:34:52,987 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:34:52,987 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:34:53,728 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:34:53,728 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:34:54,169 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:34:54,170 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
--------------------------- Captured stdout teardown ---------------------------
FAILED                                                                   [100%]18:34:55,81 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_custom_speculate failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/transient_replication_test.py:622>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:259>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:243>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 28.51 seconds ===========================
[msx] rc = 1
v1v1 running time = 50198388547
cassandra transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate PASSED [100%]
===Flaky Test Report===

test_custom_speculate passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 37.01 seconds ===========================
[msx] rc = 0
v2v2 running time = 58644193446
---> v1v1 or v2v2 test failed.
v1v1 failed in a hypo test
proj: cassandra
u_test: transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
h_list: native_transport_idle_timeout_in_ms@@@CassandraDaemon@@@-2@@@600@@@0
vv_mode: v1v1
result: FAIL
failureMessage: 
stackTrace: 

cassandra transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate 
-------------------------------- live log call ---------------------------------
18:36:41,794 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
18:36:43,894 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
FAILED                                                                   [100%]
------------------------------ live log teardown -------------------------------
18:36:43,997 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down


=================================== FAILURES ===================================
_______ TestTransientReplicationSpeculativeQueries.test_custom_speculate _______

self = <transient_replication_test.TestTransientReplicationSpeculativeQueries object at 0x7f1948cf0860>

    @pytest.mark.no_vnodes
    def test_custom_speculate(self):
        """ If write can't succeed on full replica, it's written to the transient node instead """
        session = self.exclusive_cql_connection(self.node1)
        session.execute("ALTER TABLE %s.%s WITH speculative_retry = '99.99PERCENTILE';" % (self.keyspace, self.table))
        self.insert_row(1, 1, 1)
        # Stop writes to the other full node
        self.node2.byteman_submit([mk_bman_path('stop_writes.btm')])
>       self.insert_row(1, 2, 2)

transient_replication_test.py:622: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
transient_replication_test.py:259: in insert_row
    self.quorum(session, "INSERT INTO %s.%s (pk, ck, value) VALUES (%s, %s, %s)" % (self.keyspace, self.table, pk, ck, value))
transient_replication_test.py:243: in quorum
    return session.execute(SimpleStatement(stmt_str, consistency_level=ConsistencyLevel.QUORUM))
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
---------------------------- Captured stdout setup -----------------------------
18:36:16,489 ccm DEBUG Log-watching thread starting.
18:36:18,347 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9g8a4dh2/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9g8a4dh2/test/node1/conf'}
18:36:18,348 ccm INFO node1: using Java 8 for the current invocation
18:36:18,569 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9g8a4dh2/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9g8a4dh2/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:36:18,570 ccm INFO node1: using Java 8 for the current invocation
18:36:18,681 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:36:19,23 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9g8a4dh2/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9g8a4dh2/test/node2/conf'}
18:36:19,25 ccm INFO node2: using Java 8 for the current invocation
18:36:19,239 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9g8a4dh2/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9g8a4dh2/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:36:19,240 ccm INFO node2: using Java 8 for the current invocation
18:36:19,349 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:36:19,686 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9g8a4dh2/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9g8a4dh2/test/node3/conf'}
18:36:19,688 ccm INFO node3: using Java 8 for the current invocation
18:36:19,910 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9g8a4dh2/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9g8a4dh2/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:36:19,911 ccm INFO node3: using Java 8 for the current invocation
18:36:20,18 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
install rule block digest

---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
18:36:16,212 conftest INFO Starting execution of test_custom_speculate at 2022-01-31 18:36:16.212049
18:36:16,388 dtest_setup INFO cluster ccm directory: /tmp/dtest-9g8a4dh2
18:36:18,347 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9g8a4dh2/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9g8a4dh2/test/node1/conf'}
18:36:18,348 ccm INFO node1: using Java 8 for the current invocation
18:36:18,569 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9g8a4dh2/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9g8a4dh2/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:36:18,570 ccm INFO node1: using Java 8 for the current invocation
18:36:18,681 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:36:19,23 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9g8a4dh2/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9g8a4dh2/test/node2/conf'}
18:36:19,25 ccm INFO node2: using Java 8 for the current invocation
18:36:19,239 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9g8a4dh2/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9g8a4dh2/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:36:19,240 ccm INFO node2: using Java 8 for the current invocation
18:36:19,349 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:36:19,686 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9g8a4dh2/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9g8a4dh2/test/node3/conf'}
18:36:19,688 ccm INFO node3: using Java 8 for the current invocation
18:36:19,910 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9g8a4dh2/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9g8a4dh2/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:36:19,911 ccm INFO node3: using Java 8 for the current invocation
18:36:20,18 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:36:39,219 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
18:36:39,221 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:36:39,430 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:36:39,430 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
------------------------------ Captured log call -------------------------------
18:36:41,707 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:36:41,707 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:36:41,794 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
18:36:42,781 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:36:42,781 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:36:42,807 cassandra.pool INFO Successful reconnection to 127.0.0.3:9042, marking node up if it isn't already
18:36:42,808 cassandra.cluster INFO Host 127.0.0.3:9042 may be up; will prepare queries and open connection pool
18:36:42,839 cassandra.cluster INFO Connection pools established for node 127.0.0.3:9042
18:36:43,229 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:36:43,230 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:36:43,894 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
--------------------------- Captured stdout teardown ---------------------------
18:36:44,259 ccm DEBUG Log-watching thread exiting.
---------------------------- Captured log teardown -----------------------------
18:36:43,997 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
===Flaky Test Report===

test_custom_speculate failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/transient_replication_test.py:622>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:259>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:243>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 28.83 seconds ===========================
[msx] rc = 1
v1v2 running time = 50541918706
---> v1v2 test failed.
proj: cassandra
u_test: transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
h_list: native_transport_idle_timeout_in_ms@@@CassandraDaemon@@@-2@@@600@@@0
vv_mode: v1v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate 
-------------------------------- live log call ---------------------------------
18:37:32,593 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
18:37:34,92 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down


=================================== FAILURES ===================================
_______ TestTransientReplicationSpeculativeQueries.test_custom_speculate _______

self = <transient_replication_test.TestTransientReplicationSpeculativeQueries object at 0x7fc2713320b8>

    @pytest.mark.no_vnodes
    def test_custom_speculate(self):
        """ If write can't succeed on full replica, it's written to the transient node instead """
        session = self.exclusive_cql_connection(self.node1)
        session.execute("ALTER TABLE %s.%s WITH speculative_retry = '99.99PERCENTILE';" % (self.keyspace, self.table))
        self.insert_row(1, 1, 1)
        # Stop writes to the other full node
        self.node2.byteman_submit([mk_bman_path('stop_writes.btm')])
>       self.insert_row(1, 2, 2)

transient_replication_test.py:622: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
transient_replication_test.py:259: in insert_row
    self.quorum(session, "INSERT INTO %s.%s (pk, ck, value) VALUES (%s, %s, %s)" % (self.keyspace, self.table, pk, ck, value))
transient_replication_test.py:243: in quorum
    return session.execute(SimpleStatement(stmt_str, consistency_level=ConsistencyLevel.QUORUM))
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
---------------------------- Captured stdout setup -----------------------------
18:37:07,173 ccm DEBUG Log-watching thread starting.
18:37:09,65 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-clrjz601/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-clrjz601/test/node1/conf'}
18:37:09,66 ccm INFO node1: using Java 8 for the current invocation
18:37:09,288 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-clrjz601/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-clrjz601/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:37:09,289 ccm INFO node1: using Java 8 for the current invocation
18:37:09,402 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:37:09,745 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-clrjz601/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-clrjz601/test/node2/conf'}
18:37:09,746 ccm INFO node2: using Java 8 for the current invocation
18:37:09,961 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-clrjz601/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-clrjz601/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:37:09,962 ccm INFO node2: using Java 8 for the current invocation
18:37:10,74 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:37:10,416 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-clrjz601/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-clrjz601/test/node3/conf'}
18:37:10,417 ccm INFO node3: using Java 8 for the current invocation
18:37:10,640 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-clrjz601/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-clrjz601/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:37:10,642 ccm INFO node3: using Java 8 for the current invocation
18:37:10,748 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
install rule block digest

---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
18:37:06,856 conftest INFO Starting execution of test_custom_speculate at 2022-01-31 18:37:06.856657
18:37:07,16 dtest_setup INFO cluster ccm directory: /tmp/dtest-clrjz601
18:37:09,65 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-clrjz601/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-clrjz601/test/node1/conf'}
18:37:09,66 ccm INFO node1: using Java 8 for the current invocation
18:37:09,288 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-clrjz601/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-clrjz601/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:37:09,289 ccm INFO node1: using Java 8 for the current invocation
18:37:09,402 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:37:09,745 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-clrjz601/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-clrjz601/test/node2/conf'}
18:37:09,746 ccm INFO node2: using Java 8 for the current invocation
18:37:09,961 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-clrjz601/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-clrjz601/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:37:09,962 ccm INFO node2: using Java 8 for the current invocation
18:37:10,74 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:37:10,416 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-clrjz601/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-clrjz601/test/node3/conf'}
18:37:10,417 ccm INFO node3: using Java 8 for the current invocation
18:37:10,640 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-clrjz601/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-clrjz601/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:37:10,642 ccm INFO node3: using Java 8 for the current invocation
18:37:10,748 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:37:29,920 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
18:37:29,923 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:37:30,142 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:37:30,142 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
----------------------------- Captured stdout call -----------------------------
install rule disable mutations

------------------------------ Captured log call -------------------------------
18:37:32,31 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:37:32,32 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:37:32,593 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
18:37:32,962 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:37:32,962 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:37:33,412 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:37:33,413 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:37:33,816 cassandra.pool INFO Successful reconnection to 127.0.0.3:9042, marking node up if it isn't already
18:37:33,817 cassandra.cluster INFO Host 127.0.0.3:9042 may be up; will prepare queries and open connection pool
18:37:33,824 cassandra.cluster INFO Connection pools established for node 127.0.0.3:9042
--------------------------- Captured stdout teardown ---------------------------
FAILED                                                                   [100%]18:37:34,648 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_custom_speculate failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/transient_replication_test.py:622>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:259>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:243>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 28.61 seconds ===========================
[msx] rc = 1
v1v1 running time = 50383743437
cassandra transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate PASSED [100%]
===Flaky Test Report===

test_custom_speculate passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 35.50 seconds ===========================
[msx] rc = 0
v2v2 running time = 57162674143
---> v1v1 or v2v2 test failed.
v1v1 failed in a hypo test
proj: cassandra
u_test: transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
h_list: native_transport_idle_timeout_in_ms@@@CassandraDaemon@@@-2@@@600@@@0
vv_mode: v1v1
result: FAIL
failureMessage: 
stackTrace: 

cassandra transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate 
-------------------------------- live log setup --------------------------------
18:39:17,578 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
-------------------------------- live log call ---------------------------------
18:39:21,160 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
FAILED                                                                   [100%]
------------------------------ live log teardown -------------------------------
18:39:21,277 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down


=================================== FAILURES ===================================
_______ TestTransientReplicationSpeculativeQueries.test_custom_speculate _______

self = <transient_replication_test.TestTransientReplicationSpeculativeQueries object at 0x7fe1d1c0d668>

    @pytest.mark.no_vnodes
    def test_custom_speculate(self):
        """ If write can't succeed on full replica, it's written to the transient node instead """
        session = self.exclusive_cql_connection(self.node1)
        session.execute("ALTER TABLE %s.%s WITH speculative_retry = '99.99PERCENTILE';" % (self.keyspace, self.table))
        self.insert_row(1, 1, 1)
        # Stop writes to the other full node
        self.node2.byteman_submit([mk_bman_path('stop_writes.btm')])
>       self.insert_row(1, 2, 2)

transient_replication_test.py:622: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
transient_replication_test.py:259: in insert_row
    self.quorum(session, "INSERT INTO %s.%s (pk, ck, value) VALUES (%s, %s, %s)" % (self.keyspace, self.table, pk, ck, value))
transient_replication_test.py:243: in quorum
    return session.execute(SimpleStatement(stmt_str, consistency_level=ConsistencyLevel.QUORUM))
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
------------------------------ Captured log setup ------------------------------
18:38:54,271 conftest INFO Starting execution of test_custom_speculate at 2022-01-31 18:38:54.271883
18:38:54,385 dtest_setup INFO cluster ccm directory: /tmp/dtest-kwh0tpmy
18:38:56,96 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-kwh0tpmy/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-kwh0tpmy/test/node1/conf'}
18:38:56,97 ccm INFO node1: using Java 8 for the current invocation
18:38:56,333 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-kwh0tpmy/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-kwh0tpmy/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:38:56,334 ccm INFO node1: using Java 8 for the current invocation
18:38:56,446 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:38:56,802 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-kwh0tpmy/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-kwh0tpmy/test/node2/conf'}
18:38:56,803 ccm INFO node2: using Java 8 for the current invocation
18:38:57,17 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-kwh0tpmy/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-kwh0tpmy/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:38:57,18 ccm INFO node2: using Java 8 for the current invocation
18:38:57,129 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:38:57,517 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-kwh0tpmy/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-kwh0tpmy/test/node3/conf'}
18:38:57,518 ccm INFO node3: using Java 8 for the current invocation
18:38:57,765 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-kwh0tpmy/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-kwh0tpmy/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:38:57,766 ccm INFO node3: using Java 8 for the current invocation
18:38:57,889 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:39:16,69 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
18:39:16,71 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:39:16,280 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:39:16,280 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:39:17,578 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
18:39:18,592 cassandra.pool INFO Successful reconnection to 127.0.0.3:9042, marking node up if it isn't already
18:39:18,592 cassandra.cluster INFO Host 127.0.0.3:9042 may be up; will prepare queries and open connection pool
18:39:18,600 cassandra.cluster INFO Connection pools established for node 127.0.0.3:9042
------------------------------ Captured log call -------------------------------
18:39:19,76 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:39:19,76 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:39:20,67 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:39:20,67 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:39:20,504 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:39:20,505 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:39:21,160 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
--------------------------- Captured stdout teardown ---------------------------
18:39:21,657 ccm DEBUG Log-watching thread exiting.
---------------------------- Captured log teardown -----------------------------
18:39:21,277 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
===Flaky Test Report===

test_custom_speculate failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/transient_replication_test.py:622>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:259>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:243>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 28.18 seconds ===========================
[msx] rc = 1
v1v2 running time = 49851939535
---> v1v2 test failed.
proj: cassandra
u_test: transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
h_list: native_transport_idle_timeout_in_ms@@@CassandraDaemon@@@-2@@@600@@@0
vv_mode: v1v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate 
-------------------------------- live log setup --------------------------------
18:40:08,515 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
-------------------------------- live log call ---------------------------------
18:40:11,274 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
18:40:11,422 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down


=================================== FAILURES ===================================
_______ TestTransientReplicationSpeculativeQueries.test_custom_speculate _______

self = <transient_replication_test.TestTransientReplicationSpeculativeQueries object at 0x7f40f3d030f0>

    @pytest.mark.no_vnodes
    def test_custom_speculate(self):
        """ If write can't succeed on full replica, it's written to the transient node instead """
        session = self.exclusive_cql_connection(self.node1)
        session.execute("ALTER TABLE %s.%s WITH speculative_retry = '99.99PERCENTILE';" % (self.keyspace, self.table))
        self.insert_row(1, 1, 1)
        # Stop writes to the other full node
        self.node2.byteman_submit([mk_bman_path('stop_writes.btm')])
>       self.insert_row(1, 2, 2)

transient_replication_test.py:622: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
transient_replication_test.py:259: in insert_row
    self.quorum(session, "INSERT INTO %s.%s (pk, ck, value) VALUES (%s, %s, %s)" % (self.keyspace, self.table, pk, ck, value))
transient_replication_test.py:243: in quorum
    return session.execute(SimpleStatement(stmt_str, consistency_level=ConsistencyLevel.QUORUM))
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
------------------------------ Captured log setup ------------------------------
18:39:44,155 conftest INFO Starting execution of test_custom_speculate at 2022-01-31 18:39:44.155120
18:39:44,316 dtest_setup INFO cluster ccm directory: /tmp/dtest-woa6ks5c
18:39:46,117 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-woa6ks5c/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-woa6ks5c/test/node1/conf'}
18:39:46,118 ccm INFO node1: using Java 8 for the current invocation
18:39:46,332 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-woa6ks5c/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-woa6ks5c/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:39:46,333 ccm INFO node1: using Java 8 for the current invocation
18:39:46,443 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:39:46,778 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-woa6ks5c/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-woa6ks5c/test/node2/conf'}
18:39:46,779 ccm INFO node2: using Java 8 for the current invocation
18:39:46,994 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-woa6ks5c/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-woa6ks5c/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:39:46,995 ccm INFO node2: using Java 8 for the current invocation
18:39:47,116 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:39:47,457 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-woa6ks5c/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-woa6ks5c/test/node3/conf'}
18:39:47,458 ccm INFO node3: using Java 8 for the current invocation
18:39:47,695 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-woa6ks5c/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-woa6ks5c/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:39:47,696 ccm INFO node3: using Java 8 for the current invocation
18:39:47,795 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:40:06,980 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
18:40:06,982 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:40:07,180 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:40:07,180 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:40:08,515 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
------------------------------ Captured log call -------------------------------
18:40:09,471 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:40:09,472 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:40:09,627 cassandra.pool INFO Successful reconnection to 127.0.0.3:9042, marking node up if it isn't already
18:40:09,627 cassandra.cluster INFO Host 127.0.0.3:9042 may be up; will prepare queries and open connection pool
18:40:09,634 cassandra.cluster INFO Connection pools established for node 127.0.0.3:9042
18:40:10,391 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:40:10,391 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:40:10,768 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:40:10,769 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:40:11,274 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
18:40:11,422 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
--------------------------- Captured stdout teardown ---------------------------
FAILED                                                                   [100%]18:40:11,819 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_custom_speculate failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/transient_replication_test.py:622>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:259>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:243>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 30.55 seconds ===========================
[msx] rc = 1
v1v1 running time = 52246835939
cassandra transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate PASSED [100%]
===Flaky Test Report===

test_custom_speculate passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 35.02 seconds ===========================
[msx] rc = 0
v2v2 running time = 56668202460
---> v1v1 or v2v2 test failed.
v1v1 failed in a hypo test
proj: cassandra
u_test: transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
h_list: native_transport_idle_timeout_in_ms@@@CassandraDaemon@@@-2@@@600@@@0
vv_mode: v1v1
result: FAIL
failureMessage: 
stackTrace: 

cassandra transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate 
-------------------------------- live log setup --------------------------------
18:41:58,265 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
-------------------------------- live log call ---------------------------------
18:42:01,530 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_______ TestTransientReplicationSpeculativeQueries.test_custom_speculate _______

self = <transient_replication_test.TestTransientReplicationSpeculativeQueries object at 0x7f1ba462e0b8>

    @pytest.mark.no_vnodes
    def test_custom_speculate(self):
        """ If write can't succeed on full replica, it's written to the transient node instead """
        session = self.exclusive_cql_connection(self.node1)
        session.execute("ALTER TABLE %s.%s WITH speculative_retry = '99.99PERCENTILE';" % (self.keyspace, self.table))
        self.insert_row(1, 1, 1)
        # Stop writes to the other full node
        self.node2.byteman_submit([mk_bman_path('stop_writes.btm')])
>       self.insert_row(1, 2, 2)

transient_replication_test.py:622: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
transient_replication_test.py:259: in insert_row
    self.quorum(session, "INSERT INTO %s.%s (pk, ck, value) VALUES (%s, %s, %s)" % (self.keyspace, self.table, pk, ck, value))
transient_replication_test.py:243: in quorum
    return session.execute(SimpleStatement(stmt_str, consistency_level=ConsistencyLevel.QUORUM))
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
------------------------------ Captured log setup ------------------------------
18:41:33,44 conftest INFO Starting execution of test_custom_speculate at 2022-01-31 18:41:33.044002
18:41:33,202 dtest_setup INFO cluster ccm directory: /tmp/dtest-9e9jem74
18:41:35,77 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9e9jem74/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9e9jem74/test/node1/conf'}
18:41:35,79 ccm INFO node1: using Java 8 for the current invocation
18:41:35,286 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9e9jem74/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9e9jem74/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:41:35,287 ccm INFO node1: using Java 8 for the current invocation
18:41:35,385 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:41:35,697 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9e9jem74/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9e9jem74/test/node2/conf'}
18:41:35,697 ccm INFO node2: using Java 8 for the current invocation
18:41:35,926 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9e9jem74/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9e9jem74/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:41:35,926 ccm INFO node2: using Java 8 for the current invocation
18:41:36,34 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:41:36,374 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9e9jem74/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9e9jem74/test/node3/conf'}
18:41:36,374 ccm INFO node3: using Java 8 for the current invocation
18:41:36,605 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-9e9jem74/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-9e9jem74/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:41:36,605 ccm INFO node3: using Java 8 for the current invocation
18:41:36,721 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:41:56,937 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
18:41:56,940 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:41:57,152 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:41:57,152 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:41:58,265 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
18:41:59,290 cassandra.pool INFO Successful reconnection to 127.0.0.3:9042, marking node up if it isn't already
18:41:59,290 cassandra.cluster INFO Host 127.0.0.3:9042 may be up; will prepare queries and open connection pool
18:41:59,298 cassandra.cluster INFO Connection pools established for node 127.0.0.3:9042
------------------------------ Captured log call -------------------------------
18:41:59,528 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:41:59,528 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:42:00,423 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:42:00,423 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:42:00,862 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:42:00,863 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:42:01,530 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
--------------------------- Captured stdout teardown ---------------------------
18:42:01,755 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_custom_speculate failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/transient_replication_test.py:622>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:259>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:243>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 29.54 seconds ===========================
[msx] rc = 1
v1v2 running time = 51187578515
---> v1v2 test failed.
proj: cassandra
u_test: transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
h_list: native_transport_idle_timeout_in_ms@@@CassandraDaemon@@@-2@@@600@@@0
vv_mode: v1v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate 
-------------------------------- live log call ---------------------------------
18:42:49,572 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
18:42:51,844 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_______ TestTransientReplicationSpeculativeQueries.test_custom_speculate _______

self = <transient_replication_test.TestTransientReplicationSpeculativeQueries object at 0x7f9245c505c0>

    @pytest.mark.no_vnodes
    def test_custom_speculate(self):
        """ If write can't succeed on full replica, it's written to the transient node instead """
        session = self.exclusive_cql_connection(self.node1)
        session.execute("ALTER TABLE %s.%s WITH speculative_retry = '99.99PERCENTILE';" % (self.keyspace, self.table))
        self.insert_row(1, 1, 1)
        # Stop writes to the other full node
        self.node2.byteman_submit([mk_bman_path('stop_writes.btm')])
>       self.insert_row(1, 2, 2)

transient_replication_test.py:622: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
transient_replication_test.py:259: in insert_row
    self.quorum(session, "INSERT INTO %s.%s (pk, ck, value) VALUES (%s, %s, %s)" % (self.keyspace, self.table, pk, ck, value))
transient_replication_test.py:243: in quorum
    return session.execute(SimpleStatement(stmt_str, consistency_level=ConsistencyLevel.QUORUM))
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
---------------------------- Captured stdout setup -----------------------------
18:42:24,605 ccm DEBUG Log-watching thread starting.
18:42:26,193 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-v6ytd7sw/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-v6ytd7sw/test/node1/conf'}
18:42:26,194 ccm INFO node1: using Java 8 for the current invocation
18:42:26,416 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-v6ytd7sw/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-v6ytd7sw/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:42:26,417 ccm INFO node1: using Java 8 for the current invocation
18:42:26,522 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:42:26,900 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-v6ytd7sw/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-v6ytd7sw/test/node2/conf'}
18:42:26,901 ccm INFO node2: using Java 8 for the current invocation
18:42:27,107 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-v6ytd7sw/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-v6ytd7sw/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:42:27,107 ccm INFO node2: using Java 8 for the current invocation
18:42:27,222 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:42:27,560 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-v6ytd7sw/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-v6ytd7sw/test/node3/conf'}
18:42:27,561 ccm INFO node3: using Java 8 for the current invocation
18:42:27,763 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-v6ytd7sw/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-v6ytd7sw/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:42:27,764 ccm INFO node3: using Java 8 for the current invocation
18:42:27,877 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
install rule block digest

---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
18:42:24,329 conftest INFO Starting execution of test_custom_speculate at 2022-01-31 18:42:24.329751
18:42:24,507 dtest_setup INFO cluster ccm directory: /tmp/dtest-v6ytd7sw
18:42:26,193 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-v6ytd7sw/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-v6ytd7sw/test/node1/conf'}
18:42:26,194 ccm INFO node1: using Java 8 for the current invocation
18:42:26,416 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-v6ytd7sw/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-v6ytd7sw/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:42:26,417 ccm INFO node1: using Java 8 for the current invocation
18:42:26,522 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:42:26,900 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-v6ytd7sw/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-v6ytd7sw/test/node2/conf'}
18:42:26,901 ccm INFO node2: using Java 8 for the current invocation
18:42:27,107 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-v6ytd7sw/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-v6ytd7sw/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:42:27,107 ccm INFO node2: using Java 8 for the current invocation
18:42:27,222 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:42:27,560 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-v6ytd7sw/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-v6ytd7sw/test/node3/conf'}
18:42:27,561 ccm INFO node3: using Java 8 for the current invocation
18:42:27,763 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-v6ytd7sw/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-v6ytd7sw/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:42:27,764 ccm INFO node3: using Java 8 for the current invocation
18:42:27,877 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:42:47,73 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
18:42:47,74 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:42:47,257 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:42:47,258 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
------------------------------ Captured log call -------------------------------
18:42:49,572 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
18:42:49,597 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:42:49,598 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:42:50,686 cassandra.pool INFO Successful reconnection to 127.0.0.3:9042, marking node up if it isn't already
18:42:50,686 cassandra.cluster INFO Host 127.0.0.3:9042 may be up; will prepare queries and open connection pool
18:42:50,693 cassandra.cluster INFO Connection pools established for node 127.0.0.3:9042
18:42:50,733 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:42:50,734 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:42:51,177 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:42:51,178 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:42:51,844 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
--------------------------- Captured stdout teardown ---------------------------
18:42:52,281 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_custom_speculate failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/transient_replication_test.py:622>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:259>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:243>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 28.79 seconds ===========================
[msx] rc = 1
v1v1 running time = 50509412178
cassandra transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate PASSED [100%]
===Flaky Test Report===

test_custom_speculate passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 35.90 seconds ===========================
[msx] rc = 0
v2v2 running time = 57612332002
---> v1v1 or v2v2 test failed.
v1v1 failed in a hypo test
proj: cassandra
u_test: transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
h_list: native_transport_idle_timeout_in_ms@@@CassandraDaemon@@@-2@@@600@@@0
vv_mode: v1v1
result: FAIL
failureMessage: 
stackTrace: 

cassandra transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate 
-------------------------------- live log setup --------------------------------
18:44:36,604 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
-------------------------------- live log call ---------------------------------
18:44:39,464 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down


=================================== FAILURES ===================================
_______ TestTransientReplicationSpeculativeQueries.test_custom_speculate _______

self = <transient_replication_test.TestTransientReplicationSpeculativeQueries object at 0x7f1d3a7fd828>

    @pytest.mark.no_vnodes
    def test_custom_speculate(self):
        """ If write can't succeed on full replica, it's written to the transient node instead """
        session = self.exclusive_cql_connection(self.node1)
        session.execute("ALTER TABLE %s.%s WITH speculative_retry = '99.99PERCENTILE';" % (self.keyspace, self.table))
        self.insert_row(1, 1, 1)
        # Stop writes to the other full node
        self.node2.byteman_submit([mk_bman_path('stop_writes.btm')])
>       self.insert_row(1, 2, 2)

transient_replication_test.py:622: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
transient_replication_test.py:259: in insert_row
    self.quorum(session, "INSERT INTO %s.%s (pk, ck, value) VALUES (%s, %s, %s)" % (self.keyspace, self.table, pk, ck, value))
transient_replication_test.py:243: in quorum
    return session.execute(SimpleStatement(stmt_str, consistency_level=ConsistencyLevel.QUORUM))
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
------------------------------ Captured log setup ------------------------------
18:44:12,397 conftest INFO Starting execution of test_custom_speculate at 2022-01-31 18:44:12.397745
18:44:12,510 dtest_setup INFO cluster ccm directory: /tmp/dtest-82d1dzij
18:44:14,191 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-82d1dzij/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-82d1dzij/test/node1/conf'}
18:44:14,192 ccm INFO node1: using Java 8 for the current invocation
18:44:14,415 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-82d1dzij/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-82d1dzij/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:44:14,416 ccm INFO node1: using Java 8 for the current invocation
18:44:14,528 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:44:14,894 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-82d1dzij/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-82d1dzij/test/node2/conf'}
18:44:14,896 ccm INFO node2: using Java 8 for the current invocation
18:44:15,122 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-82d1dzij/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-82d1dzij/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:44:15,123 ccm INFO node2: using Java 8 for the current invocation
18:44:15,240 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:44:15,578 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-82d1dzij/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-82d1dzij/test/node3/conf'}
18:44:15,579 ccm INFO node3: using Java 8 for the current invocation
18:44:15,790 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-82d1dzij/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-82d1dzij/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:44:15,791 ccm INFO node3: using Java 8 for the current invocation
18:44:15,900 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:44:34,64 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
18:44:34,67 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:44:34,306 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:44:34,306 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:44:36,604 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
------------------------------ Captured log call -------------------------------
18:44:37,311 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:44:37,311 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:44:37,624 cassandra.pool INFO Successful reconnection to 127.0.0.3:9042, marking node up if it isn't already
18:44:37,624 cassandra.cluster INFO Host 127.0.0.3:9042 may be up; will prepare queries and open connection pool
18:44:37,631 cassandra.cluster INFO Connection pools established for node 127.0.0.3:9042
18:44:38,375 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:44:38,375 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:44:38,802 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:44:38,803 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
--------------------------- Captured stdout teardown ---------------------------
FAILED                                                                   [100%]18:44:39,830 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_custom_speculate failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/transient_replication_test.py:622>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:259>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:243>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 28.26 seconds ===========================
[msx] rc = 1
v1v2 running time = 49912664279
---> v1v2 test failed.
proj: cassandra
u_test: transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
h_list: native_transport_idle_timeout_in_ms@@@CassandraDaemon@@@-2@@@600@@@0
vv_mode: v1v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate 
-------------------------------- live log setup --------------------------------
18:45:26,312 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
-------------------------------- live log call ---------------------------------
18:45:28,147 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
18:45:28,663 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_______ TestTransientReplicationSpeculativeQueries.test_custom_speculate _______

self = <transient_replication_test.TestTransientReplicationSpeculativeQueries object at 0x7f6fa2465668>

    @pytest.mark.no_vnodes
    def test_custom_speculate(self):
        """ If write can't succeed on full replica, it's written to the transient node instead """
        session = self.exclusive_cql_connection(self.node1)
        session.execute("ALTER TABLE %s.%s WITH speculative_retry = '99.99PERCENTILE';" % (self.keyspace, self.table))
        self.insert_row(1, 1, 1)
        # Stop writes to the other full node
        self.node2.byteman_submit([mk_bman_path('stop_writes.btm')])
>       self.insert_row(1, 2, 2)

transient_replication_test.py:622: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
transient_replication_test.py:259: in insert_row
    self.quorum(session, "INSERT INTO %s.%s (pk, ck, value) VALUES (%s, %s, %s)" % (self.keyspace, self.table, pk, ck, value))
transient_replication_test.py:243: in quorum
    return session.execute(SimpleStatement(stmt_str, consistency_level=ConsistencyLevel.QUORUM))
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
------------------------------ Captured log setup ------------------------------
18:45:02,329 conftest INFO Starting execution of test_custom_speculate at 2022-01-31 18:45:02.328990
18:45:02,439 dtest_setup INFO cluster ccm directory: /tmp/dtest-45oy8ahp
18:45:04,111 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-45oy8ahp/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-45oy8ahp/test/node1/conf'}
18:45:04,112 ccm INFO node1: using Java 8 for the current invocation
18:45:04,333 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-45oy8ahp/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-45oy8ahp/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:45:04,334 ccm INFO node1: using Java 8 for the current invocation
18:45:04,442 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:45:04,785 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-45oy8ahp/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-45oy8ahp/test/node2/conf'}
18:45:04,786 ccm INFO node2: using Java 8 for the current invocation
18:45:04,999 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-45oy8ahp/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-45oy8ahp/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:45:05,0 ccm INFO node2: using Java 8 for the current invocation
18:45:05,118 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:45:05,456 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-45oy8ahp/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-45oy8ahp/test/node3/conf'}
18:45:05,457 ccm INFO node3: using Java 8 for the current invocation
18:45:05,690 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-45oy8ahp/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-45oy8ahp/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:45:05,691 ccm INFO node3: using Java 8 for the current invocation
18:45:05,797 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:45:23,980 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
18:45:23,982 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:45:24,230 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:45:24,230 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:45:26,238 cassandra.cluster INFO Host 127.0.0.3:9042 may be up; will prepare queries and open connection pool
18:45:26,312 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
------------------------------ Captured log call -------------------------------
18:45:26,598 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:45:26,599 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:45:27,325 cassandra.pool INFO Successful reconnection to 127.0.0.3:9042, marking node up if it isn't already
18:45:27,325 cassandra.cluster INFO Host 127.0.0.3:9042 may be up; will prepare queries and open connection pool
18:45:27,332 cassandra.cluster INFO Connection pools established for node 127.0.0.3:9042
18:45:27,549 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:45:27,549 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:45:27,997 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:45:27,998 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:45:28,147 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
18:45:28,663 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
--------------------------- Captured stdout teardown ---------------------------
18:45:28,960 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_custom_speculate failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/transient_replication_test.py:622>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:259>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:243>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 27.42 seconds ===========================
[msx] rc = 1
v1v1 running time = 49120426181
cassandra transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate PASSED [100%]
===Flaky Test Report===

test_custom_speculate passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 34.96 seconds ===========================
[msx] rc = 0
v2v2 running time = 56722020158
---> v1v1 or v2v2 test failed.
v1v1 failed in a hypo test
proj: cassandra
u_test: transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
h_list: native_transport_idle_timeout_in_ms@@@CassandraDaemon@@@-2@@@600@@@0
vv_mode: v1v1
result: FAIL
failureMessage: 
stackTrace: 

cassandra transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate 
-------------------------------- live log setup --------------------------------
18:47:12,107 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
-------------------------------- live log call ---------------------------------
18:47:15,448 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down


=================================== FAILURES ===================================
_______ TestTransientReplicationSpeculativeQueries.test_custom_speculate _______

self = <transient_replication_test.TestTransientReplicationSpeculativeQueries object at 0x7f00d9bb2828>

    @pytest.mark.no_vnodes
    def test_custom_speculate(self):
        """ If write can't succeed on full replica, it's written to the transient node instead """
        session = self.exclusive_cql_connection(self.node1)
        session.execute("ALTER TABLE %s.%s WITH speculative_retry = '99.99PERCENTILE';" % (self.keyspace, self.table))
        self.insert_row(1, 1, 1)
        # Stop writes to the other full node
        self.node2.byteman_submit([mk_bman_path('stop_writes.btm')])
>       self.insert_row(1, 2, 2)

transient_replication_test.py:622: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
transient_replication_test.py:259: in insert_row
    self.quorum(session, "INSERT INTO %s.%s (pk, ck, value) VALUES (%s, %s, %s)" % (self.keyspace, self.table, pk, ck, value))
transient_replication_test.py:243: in quorum
    return session.execute(SimpleStatement(stmt_str, consistency_level=ConsistencyLevel.QUORUM))
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
------------------------------ Captured log setup ------------------------------
18:46:48,108 conftest INFO Starting execution of test_custom_speculate at 2022-01-31 18:46:48.108913
18:46:48,222 dtest_setup INFO cluster ccm directory: /tmp/dtest-ha5u_3p5
18:46:49,858 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-ha5u_3p5/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-ha5u_3p5/test/node1/conf'}
18:46:49,859 ccm INFO node1: using Java 8 for the current invocation
18:46:50,85 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-ha5u_3p5/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-ha5u_3p5/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:46:50,86 ccm INFO node1: using Java 8 for the current invocation
18:46:50,195 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:46:50,543 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-ha5u_3p5/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-ha5u_3p5/test/node2/conf'}
18:46:50,544 ccm INFO node2: using Java 8 for the current invocation
18:46:50,757 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-ha5u_3p5/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-ha5u_3p5/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:46:50,757 ccm INFO node2: using Java 8 for the current invocation
18:46:50,879 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:46:51,231 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-ha5u_3p5/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-ha5u_3p5/test/node3/conf'}
18:46:51,232 ccm INFO node3: using Java 8 for the current invocation
18:46:51,454 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-ha5u_3p5/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-ha5u_3p5/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:46:51,455 ccm INFO node3: using Java 8 for the current invocation
18:46:51,561 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:47:09,750 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
18:47:09,753 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:47:09,991 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:47:09,992 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:47:12,107 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
----------------------------- Captured stdout call -----------------------------
install rule disable mutations

------------------------------ Captured log call -------------------------------
18:47:12,321 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:47:12,322 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:47:13,222 cassandra.pool INFO Successful reconnection to 127.0.0.3:9042, marking node up if it isn't already
18:47:13,222 cassandra.cluster INFO Host 127.0.0.3:9042 may be up; will prepare queries and open connection pool
18:47:13,230 cassandra.cluster INFO Connection pools established for node 127.0.0.3:9042
18:47:14,354 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:47:14,354 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:47:14,774 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:47:14,775 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
--------------------------- Captured stdout teardown ---------------------------
FAILED                                                                   [100%]18:47:15,741 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_custom_speculate failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/transient_replication_test.py:622>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:259>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:243>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 28.44 seconds ===========================
[msx] rc = 1
v1v2 running time = 50105964867
---> v1v2 test failed.
proj: cassandra
u_test: transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
h_list: native_transport_idle_timeout_in_ms@@@CassandraDaemon@@@-2@@@600@@@0
vv_mode: v1v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate 
-------------------------------- live log call ---------------------------------
18:48:05,36 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
18:48:07,116 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down


=================================== FAILURES ===================================
_______ TestTransientReplicationSpeculativeQueries.test_custom_speculate _______

self = <transient_replication_test.TestTransientReplicationSpeculativeQueries object at 0x7fb47b465780>

    @pytest.mark.no_vnodes
    def test_custom_speculate(self):
        """ If write can't succeed on full replica, it's written to the transient node instead """
        session = self.exclusive_cql_connection(self.node1)
        session.execute("ALTER TABLE %s.%s WITH speculative_retry = '99.99PERCENTILE';" % (self.keyspace, self.table))
        self.insert_row(1, 1, 1)
        # Stop writes to the other full node
        self.node2.byteman_submit([mk_bman_path('stop_writes.btm')])
>       self.insert_row(1, 2, 2)

transient_replication_test.py:622: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
transient_replication_test.py:259: in insert_row
    self.quorum(session, "INSERT INTO %s.%s (pk, ck, value) VALUES (%s, %s, %s)" % (self.keyspace, self.table, pk, ck, value))
transient_replication_test.py:243: in quorum
    return session.execute(SimpleStatement(stmt_str, consistency_level=ConsistencyLevel.QUORUM))
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
---------------------------- Captured stdout setup -----------------------------
18:47:38,457 ccm DEBUG Log-watching thread starting.
18:47:40,309 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-8hn9p7rz/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-8hn9p7rz/test/node1/conf'}
18:47:40,310 ccm INFO node1: using Java 8 for the current invocation
18:47:40,542 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-8hn9p7rz/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-8hn9p7rz/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:47:40,543 ccm INFO node1: using Java 8 for the current invocation
18:47:40,655 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:47:40,934 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-8hn9p7rz/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-8hn9p7rz/test/node2/conf'}
18:47:40,935 ccm INFO node2: using Java 8 for the current invocation
18:47:41,156 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-8hn9p7rz/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-8hn9p7rz/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:47:41,157 ccm INFO node2: using Java 8 for the current invocation
18:47:41,246 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:47:41,558 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-8hn9p7rz/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-8hn9p7rz/test/node3/conf'}
18:47:41,559 ccm INFO node3: using Java 8 for the current invocation
18:47:41,775 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-8hn9p7rz/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-8hn9p7rz/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:47:41,776 ccm INFO node3: using Java 8 for the current invocation
18:47:41,885 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
install rule block digest

---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
18:47:38,248 conftest INFO Starting execution of test_custom_speculate at 2022-01-31 18:47:38.248137
18:47:38,361 dtest_setup INFO cluster ccm directory: /tmp/dtest-8hn9p7rz
18:47:40,309 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-8hn9p7rz/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-8hn9p7rz/test/node1/conf'}
18:47:40,310 ccm INFO node1: using Java 8 for the current invocation
18:47:40,542 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-8hn9p7rz/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-8hn9p7rz/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:47:40,543 ccm INFO node1: using Java 8 for the current invocation
18:47:40,655 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:47:40,934 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-8hn9p7rz/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-8hn9p7rz/test/node2/conf'}
18:47:40,935 ccm INFO node2: using Java 8 for the current invocation
18:47:41,156 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-8hn9p7rz/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-8hn9p7rz/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:47:41,157 ccm INFO node2: using Java 8 for the current invocation
18:47:41,246 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:47:41,558 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-8hn9p7rz/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-8hn9p7rz/test/node3/conf'}
18:47:41,559 ccm INFO node3: using Java 8 for the current invocation
18:47:41,775 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-8hn9p7rz/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-8hn9p7rz/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:47:41,776 ccm INFO node3: using Java 8 for the current invocation
18:47:41,885 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:48:01,78 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
18:48:01,81 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:48:01,292 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:48:01,292 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
----------------------------- Captured stdout call -----------------------------
install rule disable mutations

------------------------------ Captured log call -------------------------------
18:48:04,18 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:48:04,19 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:48:05,36 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
18:48:06,14 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:48:06,14 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:48:06,52 cassandra.pool INFO Successful reconnection to 127.0.0.3:9042, marking node up if it isn't already
18:48:06,53 cassandra.cluster INFO Host 127.0.0.3:9042 may be up; will prepare queries and open connection pool
18:48:06,58 cassandra.cluster INFO Connection pools established for node 127.0.0.3:9042
18:48:06,447 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:48:06,448 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
--------------------------- Captured stdout teardown ---------------------------
FAILED                                                                   [100%]18:48:07,388 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_custom_speculate failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/transient_replication_test.py:622>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:259>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:243>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 31.93 seconds ===========================
[msx] rc = 1
v1v1 running time = 53625994538
cassandra transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate PASSED [100%]
===Flaky Test Report===

test_custom_speculate passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 36.83 seconds ===========================
[msx] rc = 0
v2v2 running time = 58472369836
---> v1v1 or v2v2 test failed.
v1v1 failed in a hypo test
proj: cassandra
u_test: transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
h_list: native_transport_idle_timeout_in_ms@@@CassandraDaemon@@@-2@@@600@@@0
vv_mode: v1v1
result: FAIL
failureMessage: 
stackTrace: 

cassandra transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate 
-------------------------------- live log call ---------------------------------
18:49:58,331 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
FAILED                                                                   [100%]
------------------------------ live log teardown -------------------------------
18:49:58,550 conftest ERROR Unexpected error in node3 log, error: 
WARN  [epollEventLoopGroup-5-3] 2022-01-31 18:49:52,911 ExceptionHandlers.java:110 - Unknown exception in client networking
io.netty.channel.StacklessClosedChannelException: null
	at io.netty.channel.AbstractChannel$AbstractUnsafe.write(Object, ChannelPromise)(Unknown Source)

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate ERROR [100%]

==================================== ERRORS ====================================
_ ERROR at teardown of TestTransientReplicationSpeculativeQueries.test_custom_speculate _
Unexpected error found in node logs (see stdout for full details). Errors: [WARN  [epollEventLoopGroup-5-3] 2022-01-31 18:49:52,911 ExceptionHandlers.java:110 - Unknown exception in client networking
io.netty.channel.StacklessClosedChannelException: null
	at io.netty.channel.AbstractChannel$AbstractUnsafe.write(Object, ChannelPromise)(Unknown Source), WARN  [epollEventLoopGroup-5-3] 2022-01-31 18:49:52,911 ExceptionHandlers.java:110 - Unknown exception in client networking
io.netty.channel.StacklessClosedChannelException: null
	at io.netty.channel.AbstractChannel$AbstractUnsafe.write(Object, ChannelPromise)(Unknown Source)]
---------------------------- Captured stdout setup -----------------------------
18:49:30,705 ccm DEBUG Log-watching thread starting.
18:49:32,365 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node1/conf'}
18:49:32,366 ccm INFO node1: using Java 8 for the current invocation
18:49:32,584 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:49:32,585 ccm INFO node1: using Java 8 for the current invocation
18:49:32,696 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:49:33,45 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node2/conf'}
18:49:33,46 ccm INFO node2: using Java 8 for the current invocation
18:49:33,256 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:49:33,257 ccm INFO node2: using Java 8 for the current invocation
18:49:33,365 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:49:33,692 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node3/conf'}
18:49:33,694 ccm INFO node3: using Java 8 for the current invocation
18:49:33,904 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:49:33,906 ccm INFO node3: using Java 8 for the current invocation
18:49:34,13 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
install rule block digest

---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
Exception in thread Thread-1:
Traceback (most recent call last):
  File "/usr/lib/python3.6/threading.py", line 916, in _bootstrap_inner
    self.run()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 193, in run
    self.scan_and_report()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 186, in scan_and_report
    on_error_call(errordata)
  File "/root/cassandra-dtest/dtest_setup.py", line 136, in _log_error_handler
    pytest.fail("Error details: \n{message}".format(message=message))
  File "/root/dtest/lib/python3.6/site-packages/_pytest/outcomes.py", line 97, in fail
    raise Failed(msg=msg, pytrace=pytrace)
Failed: Error details: 
Errors seen in logs for: node3
node3: WARN  [epollEventLoopGroup-5-3] 2022-01-31 18:49:52,911 ExceptionHandlers.java:110 - Unknown exception in client networking
io.netty.channel.StacklessClosedChannelException: null
	at io.netty.channel.AbstractChannel$AbstractUnsafe.write(Object, ChannelPromise)(Unknown Source)

------------------------------ Captured log setup ------------------------------
18:49:30,443 conftest INFO Starting execution of test_custom_speculate at 2022-01-31 18:49:30.443471
18:49:30,605 dtest_setup INFO cluster ccm directory: /tmp/dtest-o2_i8gk_
18:49:32,365 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node1/conf'}
18:49:32,366 ccm INFO node1: using Java 8 for the current invocation
18:49:32,584 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:49:32,585 ccm INFO node1: using Java 8 for the current invocation
18:49:32,696 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:49:33,45 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node2/conf'}
18:49:33,46 ccm INFO node2: using Java 8 for the current invocation
18:49:33,256 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:49:33,257 ccm INFO node2: using Java 8 for the current invocation
18:49:33,365 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:49:33,692 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node3/conf'}
18:49:33,694 ccm INFO node3: using Java 8 for the current invocation
18:49:33,904 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:49:33,906 ccm INFO node3: using Java 8 for the current invocation
18:49:34,13 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:49:52,218 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
18:49:52,220 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:49:52,466 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:49:52,466 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
------------------------------ Captured log call -------------------------------
18:49:55,673 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:49:55,674 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:49:57,260 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:49:57,261 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:49:57,664 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:49:57,665 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:49:58,331 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
---------------------------- Captured log teardown -----------------------------
18:49:58,550 conftest ERROR Unexpected error in node3 log, error: 
WARN  [epollEventLoopGroup-5-3] 2022-01-31 18:49:52,911 ExceptionHandlers.java:110 - Unknown exception in client networking
io.netty.channel.StacklessClosedChannelException: null
	at io.netty.channel.AbstractChannel$AbstractUnsafe.write(Object, ChannelPromise)(Unknown Source)
=================================== FAILURES ===================================
_______ TestTransientReplicationSpeculativeQueries.test_custom_speculate _______

self = <transient_replication_test.TestTransientReplicationSpeculativeQueries object at 0x7f25fc47b080>

    @pytest.mark.no_vnodes
    def test_custom_speculate(self):
        """ If write can't succeed on full replica, it's written to the transient node instead """
        session = self.exclusive_cql_connection(self.node1)
        session.execute("ALTER TABLE %s.%s WITH speculative_retry = '99.99PERCENTILE';" % (self.keyspace, self.table))
        self.insert_row(1, 1, 1)
        # Stop writes to the other full node
        self.node2.byteman_submit([mk_bman_path('stop_writes.btm')])
>       self.insert_row(1, 2, 2)

transient_replication_test.py:622: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
transient_replication_test.py:259: in insert_row
    self.quorum(session, "INSERT INTO %s.%s (pk, ck, value) VALUES (%s, %s, %s)" % (self.keyspace, self.table, pk, ck, value))
transient_replication_test.py:243: in quorum
    return session.execute(SimpleStatement(stmt_str, consistency_level=ConsistencyLevel.QUORUM))
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
---------------------------- Captured stdout setup -----------------------------
18:49:30,705 ccm DEBUG Log-watching thread starting.
18:49:32,365 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node1/conf'}
18:49:32,366 ccm INFO node1: using Java 8 for the current invocation
18:49:32,584 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:49:32,585 ccm INFO node1: using Java 8 for the current invocation
18:49:32,696 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:49:33,45 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node2/conf'}
18:49:33,46 ccm INFO node2: using Java 8 for the current invocation
18:49:33,256 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:49:33,257 ccm INFO node2: using Java 8 for the current invocation
18:49:33,365 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:49:33,692 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node3/conf'}
18:49:33,694 ccm INFO node3: using Java 8 for the current invocation
18:49:33,904 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:49:33,906 ccm INFO node3: using Java 8 for the current invocation
18:49:34,13 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
install rule block digest

---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
Exception in thread Thread-1:
Traceback (most recent call last):
  File "/usr/lib/python3.6/threading.py", line 916, in _bootstrap_inner
    self.run()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 193, in run
    self.scan_and_report()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 186, in scan_and_report
    on_error_call(errordata)
  File "/root/cassandra-dtest/dtest_setup.py", line 136, in _log_error_handler
    pytest.fail("Error details: \n{message}".format(message=message))
  File "/root/dtest/lib/python3.6/site-packages/_pytest/outcomes.py", line 97, in fail
    raise Failed(msg=msg, pytrace=pytrace)
Failed: Error details: 
Errors seen in logs for: node3
node3: WARN  [epollEventLoopGroup-5-3] 2022-01-31 18:49:52,911 ExceptionHandlers.java:110 - Unknown exception in client networking
io.netty.channel.StacklessClosedChannelException: null
	at io.netty.channel.AbstractChannel$AbstractUnsafe.write(Object, ChannelPromise)(Unknown Source)

------------------------------ Captured log setup ------------------------------
18:49:30,443 conftest INFO Starting execution of test_custom_speculate at 2022-01-31 18:49:30.443471
18:49:30,605 dtest_setup INFO cluster ccm directory: /tmp/dtest-o2_i8gk_
18:49:32,365 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node1/conf'}
18:49:32,366 ccm INFO node1: using Java 8 for the current invocation
18:49:32,584 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:49:32,585 ccm INFO node1: using Java 8 for the current invocation
18:49:32,696 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:49:33,45 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node2/conf'}
18:49:33,46 ccm INFO node2: using Java 8 for the current invocation
18:49:33,256 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:49:33,257 ccm INFO node2: using Java 8 for the current invocation
18:49:33,365 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:49:33,692 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node3/conf'}
18:49:33,694 ccm INFO node3: using Java 8 for the current invocation
18:49:33,904 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o2_i8gk_/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o2_i8gk_/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:49:33,906 ccm INFO node3: using Java 8 for the current invocation
18:49:34,13 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:49:52,218 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
18:49:52,220 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:49:52,466 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:49:52,466 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
------------------------------ Captured log call -------------------------------
18:49:55,673 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:49:55,674 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:49:57,260 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:49:57,261 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:49:57,664 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:49:57,665 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:49:58,331 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
===Flaky Test Report===

test_custom_speculate failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/transient_replication_test.py:622>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:259>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:243>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
====================== 1 failed, 1 error in 29.42 seconds ======================
[msx] rc = 1
v1v2 running time = 51185893193
---> v1v2 test failed.
proj: cassandra
u_test: transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
h_list: native_transport_idle_timeout_in_ms@@@CassandraDaemon@@@-2@@@600@@@0
vv_mode: v1v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate 
-------------------------------- live log setup --------------------------------
18:50:47,317 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
-------------------------------- live log call ---------------------------------
18:50:50,105 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
18:50:50,584 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down


=================================== FAILURES ===================================
_______ TestTransientReplicationSpeculativeQueries.test_custom_speculate _______

self = <transient_replication_test.TestTransientReplicationSpeculativeQueries object at 0x7f943b48c668>

    @pytest.mark.no_vnodes
    def test_custom_speculate(self):
        """ If write can't succeed on full replica, it's written to the transient node instead """
        session = self.exclusive_cql_connection(self.node1)
        session.execute("ALTER TABLE %s.%s WITH speculative_retry = '99.99PERCENTILE';" % (self.keyspace, self.table))
        self.insert_row(1, 1, 1)
        # Stop writes to the other full node
        self.node2.byteman_submit([mk_bman_path('stop_writes.btm')])
>       self.insert_row(1, 2, 2)

transient_replication_test.py:622: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
transient_replication_test.py:259: in insert_row
    self.quorum(session, "INSERT INTO %s.%s (pk, ck, value) VALUES (%s, %s, %s)" % (self.keyspace, self.table, pk, ck, value))
transient_replication_test.py:243: in quorum
    return session.execute(SimpleStatement(stmt_str, consistency_level=ConsistencyLevel.QUORUM))
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
------------------------------ Captured log setup ------------------------------
18:50:21,609 conftest INFO Starting execution of test_custom_speculate at 2022-01-31 18:50:21.609280
18:50:21,769 dtest_setup INFO cluster ccm directory: /tmp/dtest-q_dwrnwj
18:50:23,785 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-q_dwrnwj/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-q_dwrnwj/test/node1/conf'}
18:50:23,786 ccm INFO node1: using Java 8 for the current invocation
18:50:23,989 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-q_dwrnwj/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-q_dwrnwj/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6'}
18:50:23,990 ccm INFO node1: using Java 8 for the current invocation
18:50:24,112 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:50:24,464 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-q_dwrnwj/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-q_dwrnwj/test/node2/conf'}
18:50:24,465 ccm INFO node2: using Java 8 for the current invocation
18:50:24,711 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-q_dwrnwj/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-q_dwrnwj/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:50:24,711 ccm INFO node2: using Java 8 for the current invocation
18:50:24,821 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:50:25,131 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-q_dwrnwj/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-q_dwrnwj/test/node3/conf'}
18:50:25,132 ccm INFO node3: using Java 8 for the current invocation
18:50:25,345 ccm INFO node3: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '02222d59920f', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'transient_replication_test.py::TestTransientReplicationSpeculativeQueries::()::test_custom_speculate (setup)', 'CASSANDRA_INCLUDE': '/tmp/dtest-q_dwrnwj/test/node3/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-q_dwrnwj/test/node3/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -XX:-PerfDisableSharedMem -Dcassandra.enable_nodelocal_queries=true -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6 -Dcassandra.migration_task_wait_in_seconds=6'}
18:50:25,345 ccm INFO node3: using Java 8 for the current invocation
18:50:25,459 ccm INFO Starting node3 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
18:50:44,681 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
18:50:44,683 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:50:44,888 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:50:44,889 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:50:47,317 cassandra.cluster WARNING Host 127.0.0.3:9042 has been marked down
------------------------------ Captured log call -------------------------------
18:50:47,848 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:50:47,848 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:50:48,430 cassandra.pool INFO Successful reconnection to 127.0.0.3:9042, marking node up if it isn't already
18:50:48,431 cassandra.cluster INFO Host 127.0.0.3:9042 may be up; will prepare queries and open connection pool
18:50:48,439 cassandra.cluster INFO Connection pools established for node 127.0.0.3:9042
18:50:49,470 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:50:49,471 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:50:49,913 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.3:9042 datacenter1> discovered
18:50:49,914 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
18:50:50,105 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
--------------------------- Captured stdout teardown ---------------------------
FAILED                                                                   [100%]18:50:51,58 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_custom_speculate failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/transient_replication_test.py:622>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:259>, <TracebackEntry /root/cassandra-dtest/transient_replication_test.py:243>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 30.28 seconds ===========================
[msx] rc = 1
v1v1 running time = 52006970468
cassandra transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate PASSED [100%]
===Flaky Test Report===

test_custom_speculate passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 35.51 seconds ===========================
[msx] rc = 0
v2v2 running time = 57213881132
---> v1v1 or v2v2 test failed.
v1v1 failed in a hypo test
proj: cassandra
u_test: transient_replication_test.py::TestTransientReplicationSpeculativeQueries::test_custom_speculate
h_list: native_transport_idle_timeout_in_ms@@@CassandraDaemon@@@-2@@@600@@@0
vv_mode: v1v1
result: FAIL
failureMessage: 
stackTrace: 

early stop after 7 is satisfied
v1v2 failed with probability 7 out of 7
v1v1v2v2 failed with probability 7 out of 7
Total execution time in seconds : 1113
0
