my_type=hypothesis
proj=cassandra
u_test=cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
h_list[1]=commitlog_segment_size_in_mb@@@CassandraDaemon@@@1@@@32@@@1024
proj: cassandra
u_test: cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
h_list: commitlog_segment_size_in_mb@@@CassandraDaemon@@@1@@@32@@@1024
cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log 
-------------------------------- live log call ---------------------------------
04:31:13,550 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down

------------------------------ live log teardown -------------------------------
04:31:13,658 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:31:12,884 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log ERROR         [100%]

==================================== ERRORS ====================================
______ ERROR at teardown of TestCQLSlowQuery.test_disable_slow_query_log _______
Unexpected error found in node logs (see stdout for full details). Errors: [ERROR [HintsWriteExecutor:1] 2022-02-01 04:31:12,884 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:31:12,889 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:31:12,889 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:31:12,884 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)]
---------------------------- Captured stdout setup -----------------------------
04:30:55,599 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:30:54,396 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:30:54.396520
04:30:55,506 dtest_setup INFO cluster ccm directory: /tmp/dtest-yxzjyav8
------------------------------ Captured log call -------------------------------
04:30:56,239 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-yxzjyav8/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-yxzjyav8/test/node1/conf'}
04:30:56,240 ccm INFO node1: using Java 8 for the current invocation
04:30:56,421 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-yxzjyav8/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-yxzjyav8/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:30:56,421 ccm INFO node1: using Java 8 for the current invocation
04:30:56,518 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
---------------------------- Captured log teardown -----------------------------
04:31:13,658 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:31:12,884 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
=================================== FAILURES ===================================
_________________ TestCQLSlowQuery.test_disable_slow_query_log _________________

self = <cql_test.TestCQLSlowQuery object at 0x7f57995a4908>

    def test_disable_slow_query_log(self):
        """
            Check that a query is NOT reported as slow if slow query logging is disabled.
    
            - start a one node cluster with slow_query_log_timeout_in_ms set to 0 milliseconds
              (this will disable slow query logging), the read request timeouts set to a large value
              (to ensure queries are not aborted) and read_iteration_delay set to 5 milliseconds
              (this will cause read queries to take longer than usual)
            - CREATE and INSERT into a table
            - SELECT * from the table using a retry policy that never retries, and check that the slow
              query log messages are present in the logs
    
            @jira_ticket CASSANDRA-12403
            """
        cluster = self.cluster
        cluster.set_configuration_options(values={'slow_query_log_timeout_in_ms': 0,
                                                  'request_timeout_in_ms': 120000,
                                                  'read_request_timeout_in_ms': 120000,
                                                  'range_request_timeout_in_ms': 120000})
    
        # cassandra.test.read_iteration_delay_ms causes the state tracking read iterators
        # introduced by CASSANDRA-7392 to pause by the specified amount of milliseconds during each
        # iteration of non system queries, so that these queries take much longer to complete,
        # see ReadCommand.withStateTracking()
        cluster.populate(1).start(jvm_args=["-Dcassandra.monitoring_report_interval_ms=10",
                                            "-Dcassandra.test.read_iteration_delay_ms=1"])
        node = cluster.nodelist()[0]
        session = self.patient_cql_connection(node)
    
        create_ks(session, 'ks', 1)
        session.execute("""
                CREATE TABLE test3 (
                    id int PRIMARY KEY,
                    val text
                );
            """)
    
        for i in range(100):
            session.execute("INSERT INTO test3 (id, val) VALUES ({}, 'foo')".format(i))
    
        session.execute(SimpleStatement("SELECT * from test3",
                                        consistency_level=ConsistencyLevel.ONE,
>                                       retry_policy=FallthroughRetryPolicy()))

cql_test.py:1152: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.connection.ConnectionShutdown: [Errno 104] Connection reset by peer

cassandra/cluster.py:4894: ConnectionShutdown
---------------------------- Captured stdout setup -----------------------------
04:30:55,599 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:30:54,396 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:30:54.396520
04:30:55,506 dtest_setup INFO cluster ccm directory: /tmp/dtest-yxzjyav8
------------------------------ Captured log call -------------------------------
04:30:56,239 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-yxzjyav8/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-yxzjyav8/test/node1/conf'}
04:30:56,240 ccm INFO node1: using Java 8 for the current invocation
04:30:56,421 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-yxzjyav8/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-yxzjyav8/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:30:56,421 ccm INFO node1: using Java 8 for the current invocation
04:30:56,518 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
===Flaky Test Report===

test_disable_slow_query_log failed and was not selected for rerun.
	<class 'cassandra.connection.ConnectionShutdown'>
	[Errno 104] Connection reset by peer
	[<TracebackEntry /root/cassandra-dtest/cql_test.py:1152>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
====================== 1 failed, 1 error in 20.23 seconds ======================
[msx] rc = 1
v1v2 running time = 41866225781
---> v1v2 test failed.
proj: cassandra
u_test: cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
h_list: commitlog_segment_size_in_mb@@@CassandraDaemon@@@1@@@32@@@1024
vv_mode: v1v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log PASSED        [100%]
===Flaky Test Report===

test_disable_slow_query_log passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 21.76 seconds ===========================
[msx] rc = 0
v1v1 running time = 43303840303
cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log PASSED        [100%]
===Flaky Test Report===

test_disable_slow_query_log passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 18.36 seconds ===========================
[msx] rc = 0
v2v2 running time = 39945936968
---> v1v1 and v2v2 test test suceeded.
cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log PASSED        [100%]
===Flaky Test Report===

test_disable_slow_query_log passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 18.40 seconds ===========================
[msx] rc = 0
v1v2 running time = 39984717189
---> v1v2 test suceeded.
cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log PASSED        [100%]
===Flaky Test Report===

test_disable_slow_query_log passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 22.15 seconds ===========================
[msx] rc = 0
v1v1 running time = 43653676156
cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log 
-------------------------------- live log call ---------------------------------
04:34:42,212 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down

------------------------------ live log teardown -------------------------------
04:34:42,318 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:34:41,604 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log ERROR         [100%]

==================================== ERRORS ====================================
______ ERROR at teardown of TestCQLSlowQuery.test_disable_slow_query_log _______
Unexpected error found in node logs (see stdout for full details). Errors: [ERROR [HintsWriteExecutor:1] 2022-02-01 04:34:41,604 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:34:41,607 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:34:41,607 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:34:41,604 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)]
---------------------------- Captured stdout setup -----------------------------
04:34:24,507 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:34:23,80 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:34:23.080367
04:34:24,391 dtest_setup INFO cluster ccm directory: /tmp/dtest-06yprc91
------------------------------ Captured log call -------------------------------
04:34:25,352 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-06yprc91/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-06yprc91/test/node1/conf'}
04:34:25,353 ccm INFO node1: using Java 8 for the current invocation
04:34:25,516 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-06yprc91/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-06yprc91/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:34:25,517 ccm INFO node1: using Java 8 for the current invocation
04:34:25,601 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
---------------------------- Captured log teardown -----------------------------
04:34:42,318 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:34:41,604 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
=================================== FAILURES ===================================
_________________ TestCQLSlowQuery.test_disable_slow_query_log _________________

self = <cql_test.TestCQLSlowQuery object at 0x7f9207486d68>

    def test_disable_slow_query_log(self):
        """
            Check that a query is NOT reported as slow if slow query logging is disabled.
    
            - start a one node cluster with slow_query_log_timeout_in_ms set to 0 milliseconds
              (this will disable slow query logging), the read request timeouts set to a large value
              (to ensure queries are not aborted) and read_iteration_delay set to 5 milliseconds
              (this will cause read queries to take longer than usual)
            - CREATE and INSERT into a table
            - SELECT * from the table using a retry policy that never retries, and check that the slow
              query log messages are present in the logs
    
            @jira_ticket CASSANDRA-12403
            """
        cluster = self.cluster
        cluster.set_configuration_options(values={'slow_query_log_timeout_in_ms': 0,
                                                  'request_timeout_in_ms': 120000,
                                                  'read_request_timeout_in_ms': 120000,
                                                  'range_request_timeout_in_ms': 120000})
    
        # cassandra.test.read_iteration_delay_ms causes the state tracking read iterators
        # introduced by CASSANDRA-7392 to pause by the specified amount of milliseconds during each
        # iteration of non system queries, so that these queries take much longer to complete,
        # see ReadCommand.withStateTracking()
        cluster.populate(1).start(jvm_args=["-Dcassandra.monitoring_report_interval_ms=10",
                                            "-Dcassandra.test.read_iteration_delay_ms=1"])
        node = cluster.nodelist()[0]
        session = self.patient_cql_connection(node)
    
        create_ks(session, 'ks', 1)
        session.execute("""
                CREATE TABLE test3 (
                    id int PRIMARY KEY,
                    val text
                );
>           """)

cql_test.py:1145: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
---------------------------- Captured stdout setup -----------------------------
04:34:24,507 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:34:23,80 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:34:23.080367
04:34:24,391 dtest_setup INFO cluster ccm directory: /tmp/dtest-06yprc91
------------------------------ Captured log call -------------------------------
04:34:25,352 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-06yprc91/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-06yprc91/test/node1/conf'}
04:34:25,353 ccm INFO node1: using Java 8 for the current invocation
04:34:25,516 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-06yprc91/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-06yprc91/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:34:25,517 ccm INFO node1: using Java 8 for the current invocation
04:34:25,601 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
===Flaky Test Report===

test_disable_slow_query_log failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/cql_test.py:1145>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
====================== 1 failed, 1 error in 20.22 seconds ======================
[msx] rc = 1
v2v2 running time = 41788640568
---> v1v1 or v2v2 test failed.
v2v2 failed in a hypo test
proj: cassandra
u_test: cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
h_list: commitlog_segment_size_in_mb@@@CassandraDaemon@@@1@@@32@@@1024
vv_mode: v2v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log 
-------------------------------- live log call ---------------------------------
04:35:24,207 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down

------------------------------ live log teardown -------------------------------
04:35:24,349 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:35:23,556 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log ERROR         [100%]

==================================== ERRORS ====================================
______ ERROR at teardown of TestCQLSlowQuery.test_disable_slow_query_log _______
Unexpected error found in node logs (see stdout for full details). Errors: [ERROR [HintsWriteExecutor:1] 2022-02-01 04:35:23,556 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:35:23,560 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:35:23,560 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:35:23,556 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)]
---------------------------- Captured stdout setup -----------------------------
04:35:06,111 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:35:04,854 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:35:04.854121
04:35:06,12 dtest_setup INFO cluster ccm directory: /tmp/dtest-dz3kqlq2
----------------------------- Captured stderr call -----------------------------
Exception in thread Thread-1:
Traceback (most recent call last):
  File "/usr/lib/python3.6/threading.py", line 916, in _bootstrap_inner
    self.run()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 193, in run
    self.scan_and_report()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 186, in scan_and_report
    on_error_call(errordata)
  File "/root/cassandra-dtest/dtest_setup.py", line 136, in _log_error_handler
    pytest.fail("Error details: \n{message}".format(message=message))
  File "/root/dtest/lib/python3.6/site-packages/_pytest/outcomes.py", line 97, in fail
    raise Failed(msg=msg, pytrace=pytrace)
Failed: Error details: 
Errors seen in logs for: node1
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:35:23,556 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:35:23,560 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:35:23,560 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

------------------------------ Captured log call -------------------------------
04:35:06,911 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-dz3kqlq2/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-dz3kqlq2/test/node1/conf'}
04:35:06,912 ccm INFO node1: using Java 8 for the current invocation
04:35:07,74 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-dz3kqlq2/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-dz3kqlq2/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:35:07,75 ccm INFO node1: using Java 8 for the current invocation
04:35:07,149 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
---------------------------- Captured log teardown -----------------------------
04:35:24,349 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:35:23,556 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
=================================== FAILURES ===================================
_________________ TestCQLSlowQuery.test_disable_slow_query_log _________________

self = <cql_test.TestCQLSlowQuery object at 0x7fd2f0919908>

    def test_disable_slow_query_log(self):
        """
            Check that a query is NOT reported as slow if slow query logging is disabled.
    
            - start a one node cluster with slow_query_log_timeout_in_ms set to 0 milliseconds
              (this will disable slow query logging), the read request timeouts set to a large value
              (to ensure queries are not aborted) and read_iteration_delay set to 5 milliseconds
              (this will cause read queries to take longer than usual)
            - CREATE and INSERT into a table
            - SELECT * from the table using a retry policy that never retries, and check that the slow
              query log messages are present in the logs
    
            @jira_ticket CASSANDRA-12403
            """
        cluster = self.cluster
        cluster.set_configuration_options(values={'slow_query_log_timeout_in_ms': 0,
                                                  'request_timeout_in_ms': 120000,
                                                  'read_request_timeout_in_ms': 120000,
                                                  'range_request_timeout_in_ms': 120000})
    
        # cassandra.test.read_iteration_delay_ms causes the state tracking read iterators
        # introduced by CASSANDRA-7392 to pause by the specified amount of milliseconds during each
        # iteration of non system queries, so that these queries take much longer to complete,
        # see ReadCommand.withStateTracking()
        cluster.populate(1).start(jvm_args=["-Dcassandra.monitoring_report_interval_ms=10",
                                            "-Dcassandra.test.read_iteration_delay_ms=1"])
        node = cluster.nodelist()[0]
        session = self.patient_cql_connection(node)
    
        create_ks(session, 'ks', 1)
        session.execute("""
                CREATE TABLE test3 (
                    id int PRIMARY KEY,
                    val text
                );
>           """)

cql_test.py:1145: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
---------------------------- Captured stdout setup -----------------------------
04:35:06,111 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:35:04,854 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:35:04.854121
04:35:06,12 dtest_setup INFO cluster ccm directory: /tmp/dtest-dz3kqlq2
----------------------------- Captured stderr call -----------------------------
Exception in thread Thread-1:
Traceback (most recent call last):
  File "/usr/lib/python3.6/threading.py", line 916, in _bootstrap_inner
    self.run()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 193, in run
    self.scan_and_report()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 186, in scan_and_report
    on_error_call(errordata)
  File "/root/cassandra-dtest/dtest_setup.py", line 136, in _log_error_handler
    pytest.fail("Error details: \n{message}".format(message=message))
  File "/root/dtest/lib/python3.6/site-packages/_pytest/outcomes.py", line 97, in fail
    raise Failed(msg=msg, pytrace=pytrace)
Failed: Error details: 
Errors seen in logs for: node1
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:35:23,556 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:35:23,560 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:35:23,560 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

------------------------------ Captured log call -------------------------------
04:35:06,911 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-dz3kqlq2/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-dz3kqlq2/test/node1/conf'}
04:35:06,912 ccm INFO node1: using Java 8 for the current invocation
04:35:07,74 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-dz3kqlq2/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-dz3kqlq2/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:35:07,75 ccm INFO node1: using Java 8 for the current invocation
04:35:07,149 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
===Flaky Test Report===

test_disable_slow_query_log failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/cql_test.py:1145>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
====================== 1 failed, 1 error in 20.44 seconds ======================
[msx] rc = 1
v1v2 running time = 42025380338
---> v1v2 test failed.
proj: cassandra
u_test: cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
h_list: commitlog_segment_size_in_mb@@@CassandraDaemon@@@1@@@32@@@1024
vv_mode: v1v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log PASSED        [100%]
===Flaky Test Report===

test_disable_slow_query_log passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 19.74 seconds ===========================
[msx] rc = 0
v1v1 running time = 41495116894
cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log 
-------------------------------- live log call ---------------------------------
04:36:47,310 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down

------------------------------ live log teardown -------------------------------
04:36:47,416 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:36:46,680 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log ERROR         [100%]

==================================== ERRORS ====================================
______ ERROR at teardown of TestCQLSlowQuery.test_disable_slow_query_log _______
Unexpected error found in node logs (see stdout for full details). Errors: [ERROR [HintsWriteExecutor:1] 2022-02-01 04:36:46,680 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:36:46,683 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:36:46,683 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:36:46,680 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)]
---------------------------- Captured stdout setup -----------------------------
04:36:29,233 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:36:28,382 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:36:28.382678
04:36:29,141 dtest_setup INFO cluster ccm directory: /tmp/dtest-pehzkr9_
----------------------------- Captured stdout call -----------------------------

04:36:29,240 ccm DEBUG using balanced tokens for non-vnode cluster
04:36:29,875 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-pehzkr9_/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-pehzkr9_/test/node1/conf'}
04:36:29,875 ccm INFO node1: using Java 8 for the current invocation
04:36:30,51 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-pehzkr9_/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-pehzkr9_/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:36:30,52 ccm INFO node1: using Java 8 for the current invocation
04:36:30,137 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
------------------------------ Captured log call -------------------------------
04:36:29,875 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-pehzkr9_/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-pehzkr9_/test/node1/conf'}
04:36:29,875 ccm INFO node1: using Java 8 for the current invocation
04:36:30,51 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-pehzkr9_/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-pehzkr9_/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:36:30,52 ccm INFO node1: using Java 8 for the current invocation
04:36:30,137 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
---------------------------- Captured log teardown -----------------------------
04:36:47,416 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:36:46,680 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
=================================== FAILURES ===================================
_________________ TestCQLSlowQuery.test_disable_slow_query_log _________________

self = <cql_test.TestCQLSlowQuery object at 0x7ff3c7664908>

    def test_disable_slow_query_log(self):
        """
            Check that a query is NOT reported as slow if slow query logging is disabled.
    
            - start a one node cluster with slow_query_log_timeout_in_ms set to 0 milliseconds
              (this will disable slow query logging), the read request timeouts set to a large value
              (to ensure queries are not aborted) and read_iteration_delay set to 5 milliseconds
              (this will cause read queries to take longer than usual)
            - CREATE and INSERT into a table
            - SELECT * from the table using a retry policy that never retries, and check that the slow
              query log messages are present in the logs
    
            @jira_ticket CASSANDRA-12403
            """
        cluster = self.cluster
        cluster.set_configuration_options(values={'slow_query_log_timeout_in_ms': 0,
                                                  'request_timeout_in_ms': 120000,
                                                  'read_request_timeout_in_ms': 120000,
                                                  'range_request_timeout_in_ms': 120000})
    
        # cassandra.test.read_iteration_delay_ms causes the state tracking read iterators
        # introduced by CASSANDRA-7392 to pause by the specified amount of milliseconds during each
        # iteration of non system queries, so that these queries take much longer to complete,
        # see ReadCommand.withStateTracking()
        cluster.populate(1).start(jvm_args=["-Dcassandra.monitoring_report_interval_ms=10",
                                            "-Dcassandra.test.read_iteration_delay_ms=1"])
        node = cluster.nodelist()[0]
        session = self.patient_cql_connection(node)
    
        create_ks(session, 'ks', 1)
        session.execute("""
                CREATE TABLE test3 (
                    id int PRIMARY KEY,
                    val text
                );
>           """)

cql_test.py:1145: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
---------------------------- Captured stdout setup -----------------------------
04:36:29,233 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:36:28,382 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:36:28.382678
04:36:29,141 dtest_setup INFO cluster ccm directory: /tmp/dtest-pehzkr9_
----------------------------- Captured stdout call -----------------------------

04:36:29,240 ccm DEBUG using balanced tokens for non-vnode cluster
04:36:29,875 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-pehzkr9_/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-pehzkr9_/test/node1/conf'}
04:36:29,875 ccm INFO node1: using Java 8 for the current invocation
04:36:30,51 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-pehzkr9_/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-pehzkr9_/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:36:30,52 ccm INFO node1: using Java 8 for the current invocation
04:36:30,137 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
------------------------------ Captured log call -------------------------------
04:36:29,875 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-pehzkr9_/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-pehzkr9_/test/node1/conf'}
04:36:29,875 ccm INFO node1: using Java 8 for the current invocation
04:36:30,51 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-pehzkr9_/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-pehzkr9_/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:36:30,52 ccm INFO node1: using Java 8 for the current invocation
04:36:30,137 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
===Flaky Test Report===

test_disable_slow_query_log failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/cql_test.py:1145>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
====================== 1 failed, 1 error in 20.00 seconds ======================
[msx] rc = 1
v2v2 running time = 41540827404
---> v1v1 or v2v2 test failed.
v2v2 failed in a hypo test
proj: cassandra
u_test: cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
h_list: commitlog_segment_size_in_mb@@@CassandraDaemon@@@1@@@32@@@1024
vv_mode: v2v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log PASSED        [100%]
===Flaky Test Report===

test_disable_slow_query_log passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 16.67 seconds ===========================
[msx] rc = 0
v1v2 running time = 38493694622
---> v1v2 test suceeded.
cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log PASSED        [100%]
===Flaky Test Report===

test_disable_slow_query_log passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 19.75 seconds ===========================
[msx] rc = 0
v1v1 running time = 41498696057
cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log PASSED        [100%]
===Flaky Test Report===

test_disable_slow_query_log passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 15.81 seconds ===========================
[msx] rc = 0
v2v2 running time = 37327662626
---> v1v1 and v2v2 test test suceeded.
cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log 
-------------------------------- live log call ---------------------------------
04:39:27,14 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down

------------------------------ live log teardown -------------------------------
04:39:27,121 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:39:26,383 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log ERROR         [100%]

==================================== ERRORS ====================================
______ ERROR at teardown of TestCQLSlowQuery.test_disable_slow_query_log _______
Unexpected error found in node logs (see stdout for full details). Errors: [ERROR [HintsWriteExecutor:1] 2022-02-01 04:39:26,383 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:39:26,386 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:39:26,387 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:39:26,383 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)]
---------------------------- Captured stdout setup -----------------------------
04:39:08,779 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:39:07,399 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:39:07.399260
04:39:08,661 dtest_setup INFO cluster ccm directory: /tmp/dtest-v98miydr
------------------------------ Captured log call -------------------------------
04:39:09,441 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-v98miydr/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-v98miydr/test/node1/conf'}
04:39:09,441 ccm INFO node1: using Java 8 for the current invocation
04:39:09,610 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-v98miydr/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-v98miydr/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:39:09,610 ccm INFO node1: using Java 8 for the current invocation
04:39:09,692 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
---------------------------- Captured log teardown -----------------------------
04:39:27,121 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:39:26,383 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
=================================== FAILURES ===================================
_________________ TestCQLSlowQuery.test_disable_slow_query_log _________________

self = <cql_test.TestCQLSlowQuery object at 0x7f40a7bced68>

    def test_disable_slow_query_log(self):
        """
            Check that a query is NOT reported as slow if slow query logging is disabled.
    
            - start a one node cluster with slow_query_log_timeout_in_ms set to 0 milliseconds
              (this will disable slow query logging), the read request timeouts set to a large value
              (to ensure queries are not aborted) and read_iteration_delay set to 5 milliseconds
              (this will cause read queries to take longer than usual)
            - CREATE and INSERT into a table
            - SELECT * from the table using a retry policy that never retries, and check that the slow
              query log messages are present in the logs
    
            @jira_ticket CASSANDRA-12403
            """
        cluster = self.cluster
        cluster.set_configuration_options(values={'slow_query_log_timeout_in_ms': 0,
                                                  'request_timeout_in_ms': 120000,
                                                  'read_request_timeout_in_ms': 120000,
                                                  'range_request_timeout_in_ms': 120000})
    
        # cassandra.test.read_iteration_delay_ms causes the state tracking read iterators
        # introduced by CASSANDRA-7392 to pause by the specified amount of milliseconds during each
        # iteration of non system queries, so that these queries take much longer to complete,
        # see ReadCommand.withStateTracking()
        cluster.populate(1).start(jvm_args=["-Dcassandra.monitoring_report_interval_ms=10",
                                            "-Dcassandra.test.read_iteration_delay_ms=1"])
        node = cluster.nodelist()[0]
        session = self.patient_cql_connection(node)
    
        create_ks(session, 'ks', 1)
        session.execute("""
                CREATE TABLE test3 (
                    id int PRIMARY KEY,
                    val text
                );
>           """)

cql_test.py:1145: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
---------------------------- Captured stdout setup -----------------------------
04:39:08,779 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:39:07,399 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:39:07.399260
04:39:08,661 dtest_setup INFO cluster ccm directory: /tmp/dtest-v98miydr
------------------------------ Captured log call -------------------------------
04:39:09,441 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-v98miydr/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-v98miydr/test/node1/conf'}
04:39:09,441 ccm INFO node1: using Java 8 for the current invocation
04:39:09,610 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-v98miydr/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-v98miydr/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:39:09,610 ccm INFO node1: using Java 8 for the current invocation
04:39:09,692 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
===Flaky Test Report===

test_disable_slow_query_log failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/cql_test.py:1145>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
====================== 1 failed, 1 error in 20.70 seconds ======================
[msx] rc = 1
v1v2 running time = 42305502725
---> v1v2 test failed.
proj: cassandra
u_test: cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
h_list: commitlog_segment_size_in_mb@@@CassandraDaemon@@@1@@@32@@@1024
vv_mode: v1v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log PASSED        [100%]
===Flaky Test Report===

test_disable_slow_query_log passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 20.06 seconds ===========================
[msx] rc = 0
v1v1 running time = 41554355879
cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log PASSED        [100%]
===Flaky Test Report===

test_disable_slow_query_log passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 17.88 seconds ===========================
[msx] rc = 0
v2v2 running time = 39362036816
---> v1v1 and v2v2 test test suceeded.
cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log 
-------------------------------- live log call ---------------------------------
04:41:30,392 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down

------------------------------ live log teardown -------------------------------
04:41:30,499 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:41:29,792 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log ERROR         [100%]

==================================== ERRORS ====================================
______ ERROR at teardown of TestCQLSlowQuery.test_disable_slow_query_log _______
Unexpected error found in node logs (see stdout for full details). Errors: [ERROR [HintsWriteExecutor:1] 2022-02-01 04:41:29,792 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:41:29,796 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:41:29,797 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:41:29,792 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)]
---------------------------- Captured stdout setup -----------------------------
4:41:12,82 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:41:10,882 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:41:10.882482
04:41:11,982 dtest_setup INFO cluster ccm directory: /tmp/dtest-r12gccha
------------------------------ Captured log call -------------------------------
04:41:12,780 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-r12gccha/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-r12gccha/test/node1/conf'}
04:41:12,781 ccm INFO node1: using Java 8 for the current invocation
04:41:12,983 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-r12gccha/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-r12gccha/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:41:12,983 ccm INFO node1: using Java 8 for the current invocation
04:41:13,70 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
---------------------------- Captured log teardown -----------------------------
04:41:30,499 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:41:29,792 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
=================================== FAILURES ===================================
_________________ TestCQLSlowQuery.test_disable_slow_query_log _________________

self = <cql_test.TestCQLSlowQuery object at 0x7f62691ff860>

    def test_disable_slow_query_log(self):
        """
            Check that a query is NOT reported as slow if slow query logging is disabled.
    
            - start a one node cluster with slow_query_log_timeout_in_ms set to 0 milliseconds
              (this will disable slow query logging), the read request timeouts set to a large value
              (to ensure queries are not aborted) and read_iteration_delay set to 5 milliseconds
              (this will cause read queries to take longer than usual)
            - CREATE and INSERT into a table
            - SELECT * from the table using a retry policy that never retries, and check that the slow
              query log messages are present in the logs
    
            @jira_ticket CASSANDRA-12403
            """
        cluster = self.cluster
        cluster.set_configuration_options(values={'slow_query_log_timeout_in_ms': 0,
                                                  'request_timeout_in_ms': 120000,
                                                  'read_request_timeout_in_ms': 120000,
                                                  'range_request_timeout_in_ms': 120000})
    
        # cassandra.test.read_iteration_delay_ms causes the state tracking read iterators
        # introduced by CASSANDRA-7392 to pause by the specified amount of milliseconds during each
        # iteration of non system queries, so that these queries take much longer to complete,
        # see ReadCommand.withStateTracking()
        cluster.populate(1).start(jvm_args=["-Dcassandra.monitoring_report_interval_ms=10",
                                            "-Dcassandra.test.read_iteration_delay_ms=1"])
        node = cluster.nodelist()[0]
        session = self.patient_cql_connection(node)
    
        create_ks(session, 'ks', 1)
        session.execute("""
                CREATE TABLE test3 (
                    id int PRIMARY KEY,
                    val text
                );
>           """)

cql_test.py:1145: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
---------------------------- Captured stdout setup -----------------------------
4:41:12,82 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:41:10,882 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:41:10.882482
04:41:11,982 dtest_setup INFO cluster ccm directory: /tmp/dtest-r12gccha
------------------------------ Captured log call -------------------------------
04:41:12,780 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-r12gccha/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-r12gccha/test/node1/conf'}
04:41:12,781 ccm INFO node1: using Java 8 for the current invocation
04:41:12,983 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-r12gccha/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-r12gccha/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:41:12,983 ccm INFO node1: using Java 8 for the current invocation
04:41:13,70 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
===Flaky Test Report===

test_disable_slow_query_log failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/cql_test.py:1145>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
====================== 1 failed, 1 error in 20.63 seconds ======================
[msx] rc = 1
v1v2 running time = 42206766600
---> v1v2 test failed.
proj: cassandra
u_test: cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
h_list: commitlog_segment_size_in_mb@@@CassandraDaemon@@@1@@@32@@@1024
vv_mode: v1v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log PASSED        [100%]
===Flaky Test Report===

test_disable_slow_query_log passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 20.29 seconds ===========================
[msx] rc = 0
v1v1 running time = 41865821991
cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log 
-------------------------------- live log call ---------------------------------
04:42:54,267 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down

------------------------------ live log teardown -------------------------------
04:42:54,372 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:42:53,653 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log ERROR         [100%]

==================================== ERRORS ====================================
______ ERROR at teardown of TestCQLSlowQuery.test_disable_slow_query_log _______
Unexpected error found in node logs (see stdout for full details). Errors: [ERROR [HintsWriteExecutor:1] 2022-02-01 04:42:53,653 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:42:53,656 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:42:53,656 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:42:53,653 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)]
---------------------------- Captured stdout setup -----------------------------
04:42:36,207 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:42:34,851 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:42:34.851666
04:42:36,113 dtest_setup INFO cluster ccm directory: /tmp/dtest-3ixhcsc9
----------------------------- Captured stdout call -----------------------------
04:42:36,214 ccm DEBUG using balanced tokens for non-vnode cluster
04:42:36,860 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-3ixhcsc9/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-3ixhcsc9/test/node1/conf'}
04:42:36,860 ccm INFO node1: using Java 8 for the current invocation
04:42:37,36 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-3ixhcsc9/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-3ixhcsc9/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:42:37,36 ccm INFO node1: using Java 8 for the current invocation
04:42:37,121 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra

0
------------------------------ Captured log call -------------------------------
04:42:36,860 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-3ixhcsc9/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-3ixhcsc9/test/node1/conf'}
04:42:36,860 ccm INFO node1: using Java 8 for the current invocation
04:42:37,36 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-3ixhcsc9/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-3ixhcsc9/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:42:37,36 ccm INFO node1: using Java 8 for the current invocation
04:42:37,121 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
---------------------------- Captured log teardown -----------------------------
04:42:54,372 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:42:53,653 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
=================================== FAILURES ===================================
_________________ TestCQLSlowQuery.test_disable_slow_query_log _________________

self = <cql_test.TestCQLSlowQuery object at 0x7f3d8b28dd68>

    def test_disable_slow_query_log(self):
        """
            Check that a query is NOT reported as slow if slow query logging is disabled.
    
            - start a one node cluster with slow_query_log_timeout_in_ms set to 0 milliseconds
              (this will disable slow query logging), the read request timeouts set to a large value
              (to ensure queries are not aborted) and read_iteration_delay set to 5 milliseconds
              (this will cause read queries to take longer than usual)
            - CREATE and INSERT into a table
            - SELECT * from the table using a retry policy that never retries, and check that the slow
              query log messages are present in the logs
    
            @jira_ticket CASSANDRA-12403
            """
        cluster = self.cluster
        cluster.set_configuration_options(values={'slow_query_log_timeout_in_ms': 0,
                                                  'request_timeout_in_ms': 120000,
                                                  'read_request_timeout_in_ms': 120000,
                                                  'range_request_timeout_in_ms': 120000})
    
        # cassandra.test.read_iteration_delay_ms causes the state tracking read iterators
        # introduced by CASSANDRA-7392 to pause by the specified amount of milliseconds during each
        # iteration of non system queries, so that these queries take much longer to complete,
        # see ReadCommand.withStateTracking()
        cluster.populate(1).start(jvm_args=["-Dcassandra.monitoring_report_interval_ms=10",
                                            "-Dcassandra.test.read_iteration_delay_ms=1"])
        node = cluster.nodelist()[0]
        session = self.patient_cql_connection(node)
    
        create_ks(session, 'ks', 1)
        session.execute("""
                CREATE TABLE test3 (
                    id int PRIMARY KEY,
                    val text
                );
>           """)

cql_test.py:1145: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
---------------------------- Captured stdout setup -----------------------------
04:42:36,207 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:42:34,851 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:42:34.851666
04:42:36,113 dtest_setup INFO cluster ccm directory: /tmp/dtest-3ixhcsc9
----------------------------- Captured stdout call -----------------------------
04:42:36,214 ccm DEBUG using balanced tokens for non-vnode cluster
04:42:36,860 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-3ixhcsc9/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-3ixhcsc9/test/node1/conf'}
04:42:36,860 ccm INFO node1: using Java 8 for the current invocation
04:42:37,36 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-3ixhcsc9/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-3ixhcsc9/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:42:37,36 ccm INFO node1: using Java 8 for the current invocation
04:42:37,121 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra

0
------------------------------ Captured log call -------------------------------
04:42:36,860 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-3ixhcsc9/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-3ixhcsc9/test/node1/conf'}
04:42:36,860 ccm INFO node1: using Java 8 for the current invocation
04:42:37,36 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-3ixhcsc9/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-3ixhcsc9/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:42:37,36 ccm INFO node1: using Java 8 for the current invocation
04:42:37,121 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
===Flaky Test Report===

test_disable_slow_query_log failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/cql_test.py:1145>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
====================== 1 failed, 1 error in 20.52 seconds ======================
[msx] rc = 1
v2v2 running time = 42022181273
---> v1v1 or v2v2 test failed.
v2v2 failed in a hypo test
proj: cassandra
u_test: cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
h_list: commitlog_segment_size_in_mb@@@CassandraDaemon@@@1@@@32@@@1024
vv_mode: v2v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log PASSED        [100%]
===Flaky Test Report===

test_disable_slow_query_log passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 18.29 seconds ===========================
[msx] rc = 0
v1v2 running time = 39912593238
---> v1v2 test suceeded.
cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log PASSED        [100%]
===Flaky Test Report===

test_disable_slow_query_log passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 21.49 seconds ===========================
[msx] rc = 0
v1v1 running time = 43045163310
cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log PASSED        [100%]
===Flaky Test Report===

test_disable_slow_query_log passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 18.39 seconds ===========================
[msx] rc = 0
v2v2 running time = 39929490283
---> v1v1 and v2v2 test test suceeded.
cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log 
-------------------------------- live log call ---------------------------------
04:45:39,179 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down

------------------------------ live log teardown -------------------------------
04:45:39,285 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:45:38,521 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log ERROR         [100%]

==================================== ERRORS ====================================
______ ERROR at teardown of TestCQLSlowQuery.test_disable_slow_query_log _______
Unexpected error found in node logs (see stdout for full details). Errors: [ERROR [HintsWriteExecutor:1] 2022-02-01 04:45:38,521 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:45:38,523 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:45:38,523 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:45:38,521 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)]
---------------------------- Captured stdout setup -----------------------------
04:45:21,196 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:45:19,810 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:45:19.810678
04:45:21,73 dtest_setup INFO cluster ccm directory: /tmp/dtest-w_iq2ch7
----------------------------- Captured stdout call -----------------------------

04:45:21,203 ccm DEBUG using balanced tokens for non-vnode cluster
04:45:21,807 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-w_iq2ch7/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-w_iq2ch7/test/node1/conf'}
04:45:21,807 ccm INFO node1: using Java 8 for the current invocation
04:45:21,969 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-w_iq2ch7/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-w_iq2ch7/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:45:21,970 ccm INFO node1: using Java 8 for the current invocation
04:45:22,59 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
----------------------------- Captured stderr call -----------------------------
Exception in thread Thread-1:
Traceback (most recent call last):
  File "/usr/lib/python3.6/threading.py", line 916, in _bootstrap_inner
    self.run()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 193, in run
    self.scan_and_report()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 186, in scan_and_report
    on_error_call(errordata)
  File "/root/cassandra-dtest/dtest_setup.py", line 136, in _log_error_handler
    pytest.fail("Error details: \n{message}".format(message=message))
  File "/root/dtest/lib/python3.6/site-packages/_pytest/outcomes.py", line 97, in fail
    raise Failed(msg=msg, pytrace=pytrace)
Failed: Error details: 
Errors seen in logs for: node1
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:45:38,521 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:45:38,523 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:45:38,523 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

------------------------------ Captured log call -------------------------------
04:45:21,807 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-w_iq2ch7/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-w_iq2ch7/test/node1/conf'}
04:45:21,807 ccm INFO node1: using Java 8 for the current invocation
04:45:21,969 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-w_iq2ch7/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-w_iq2ch7/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:45:21,970 ccm INFO node1: using Java 8 for the current invocation
04:45:22,59 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
---------------------------- Captured log teardown -----------------------------
04:45:39,285 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:45:38,521 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
=================================== FAILURES ===================================
_________________ TestCQLSlowQuery.test_disable_slow_query_log _________________

self = <cql_test.TestCQLSlowQuery object at 0x7f884e552908>

    def test_disable_slow_query_log(self):
        """
            Check that a query is NOT reported as slow if slow query logging is disabled.
    
            - start a one node cluster with slow_query_log_timeout_in_ms set to 0 milliseconds
              (this will disable slow query logging), the read request timeouts set to a large value
              (to ensure queries are not aborted) and read_iteration_delay set to 5 milliseconds
              (this will cause read queries to take longer than usual)
            - CREATE and INSERT into a table
            - SELECT * from the table using a retry policy that never retries, and check that the slow
              query log messages are present in the logs
    
            @jira_ticket CASSANDRA-12403
            """
        cluster = self.cluster
        cluster.set_configuration_options(values={'slow_query_log_timeout_in_ms': 0,
                                                  'request_timeout_in_ms': 120000,
                                                  'read_request_timeout_in_ms': 120000,
                                                  'range_request_timeout_in_ms': 120000})
    
        # cassandra.test.read_iteration_delay_ms causes the state tracking read iterators
        # introduced by CASSANDRA-7392 to pause by the specified amount of milliseconds during each
        # iteration of non system queries, so that these queries take much longer to complete,
        # see ReadCommand.withStateTracking()
        cluster.populate(1).start(jvm_args=["-Dcassandra.monitoring_report_interval_ms=10",
                                            "-Dcassandra.test.read_iteration_delay_ms=1"])
        node = cluster.nodelist()[0]
        session = self.patient_cql_connection(node)
    
        create_ks(session, 'ks', 1)
        session.execute("""
                CREATE TABLE test3 (
                    id int PRIMARY KEY,
                    val text
                );
>           """)

cql_test.py:1145: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
---------------------------- Captured stdout setup -----------------------------
04:45:21,196 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:45:19,810 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:45:19.810678
04:45:21,73 dtest_setup INFO cluster ccm directory: /tmp/dtest-w_iq2ch7
----------------------------- Captured stdout call -----------------------------

04:45:21,203 ccm DEBUG using balanced tokens for non-vnode cluster
04:45:21,807 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-w_iq2ch7/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-w_iq2ch7/test/node1/conf'}
04:45:21,807 ccm INFO node1: using Java 8 for the current invocation
04:45:21,969 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-w_iq2ch7/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-w_iq2ch7/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:45:21,970 ccm INFO node1: using Java 8 for the current invocation
04:45:22,59 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
----------------------------- Captured stderr call -----------------------------
Exception in thread Thread-1:
Traceback (most recent call last):
  File "/usr/lib/python3.6/threading.py", line 916, in _bootstrap_inner
    self.run()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 193, in run
    self.scan_and_report()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 186, in scan_and_report
    on_error_call(errordata)
  File "/root/cassandra-dtest/dtest_setup.py", line 136, in _log_error_handler
    pytest.fail("Error details: \n{message}".format(message=message))
  File "/root/dtest/lib/python3.6/site-packages/_pytest/outcomes.py", line 97, in fail
    raise Failed(msg=msg, pytrace=pytrace)
Failed: Error details: 
Errors seen in logs for: node1
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:45:38,521 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:45:38,523 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:45:38,523 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

------------------------------ Captured log call -------------------------------
04:45:21,807 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-w_iq2ch7/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-w_iq2ch7/test/node1/conf'}
04:45:21,807 ccm INFO node1: using Java 8 for the current invocation
04:45:21,969 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-w_iq2ch7/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-w_iq2ch7/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:45:21,970 ccm INFO node1: using Java 8 for the current invocation
04:45:22,59 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
===Flaky Test Report===

test_disable_slow_query_log failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/cql_test.py:1145>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
====================== 1 failed, 1 error in 20.47 seconds ======================
[msx] rc = 1
v1v2 running time = 42071742596
---> v1v2 test failed.
proj: cassandra
u_test: cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
h_list: commitlog_segment_size_in_mb@@@CassandraDaemon@@@1@@@32@@@1024
vv_mode: v1v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log PASSED        [100%]
===Flaky Test Report===

test_disable_slow_query_log passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 20.56 seconds ===========================
[msx] rc = 0
v1v1 running time = 42342085302
cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log 
-------------------------------- live log call ---------------------------------
04:47:03,216 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down

------------------------------ live log teardown -------------------------------
04:47:03,333 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:47:02,614 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log ERROR         [100%]

==================================== ERRORS ====================================
______ ERROR at teardown of TestCQLSlowQuery.test_disable_slow_query_log _______
Unexpected error found in node logs (see stdout for full details). Errors: [ERROR [HintsWriteExecutor:1] 2022-02-01 04:47:02,614 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:47:02,616 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:47:02,616 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:47:02,614 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)]
---------------------------- Captured stdout setup -----------------------------
04:46:45,269 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:46:44,193 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:46:44.193512
04:46:45,153 dtest_setup INFO cluster ccm directory: /tmp/dtest-ftchskyq
----------------------------- Captured stdout call -----------------------------

04:46:45,276 ccm DEBUG using balanced tokens for non-vnode cluster
04:46:45,904 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-ftchskyq/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-ftchskyq/test/node1/conf'}
04:46:45,905 ccm INFO node1: using Java 8 for the current invocation
04:46:46,69 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-ftchskyq/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-ftchskyq/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:46:46,69 ccm INFO node1: using Java 8 for the current invocation
04:46:46,151 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra

----------------------------- Captured stderr call -----------------------------
Exception in thread Thread-1:
Traceback (most recent call last):
  File "/usr/lib/python3.6/threading.py", line 916, in _bootstrap_inner
    self.run()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 193, in run
    self.scan_and_report()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 186, in scan_and_report
    on_error_call(errordata)
  File "/root/cassandra-dtest/dtest_setup.py", line 136, in _log_error_handler
    pytest.fail("Error details: \n{message}".format(message=message))
  File "/root/dtest/lib/python3.6/site-packages/_pytest/outcomes.py", line 97, in fail
    raise Failed(msg=msg, pytrace=pytrace)
Failed: Error details: 
Errors seen in logs for: node1
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:47:02,614 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:47:02,616 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:47:02,616 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

------------------------------ Captured log call -------------------------------
04:46:45,904 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-ftchskyq/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-ftchskyq/test/node1/conf'}
04:46:45,905 ccm INFO node1: using Java 8 for the current invocation
04:46:46,69 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-ftchskyq/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-ftchskyq/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:46:46,69 ccm INFO node1: using Java 8 for the current invocation
04:46:46,151 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
---------------------------- Captured log teardown -----------------------------
04:47:03,333 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:47:02,614 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
=================================== FAILURES ===================================
_________________ TestCQLSlowQuery.test_disable_slow_query_log _________________

self = <cql_test.TestCQLSlowQuery object at 0x7fd154242d68>

    def test_disable_slow_query_log(self):
        """
            Check that a query is NOT reported as slow if slow query logging is disabled.
    
            - start a one node cluster with slow_query_log_timeout_in_ms set to 0 milliseconds
              (this will disable slow query logging), the read request timeouts set to a large value
              (to ensure queries are not aborted) and read_iteration_delay set to 5 milliseconds
              (this will cause read queries to take longer than usual)
            - CREATE and INSERT into a table
            - SELECT * from the table using a retry policy that never retries, and check that the slow
              query log messages are present in the logs
    
            @jira_ticket CASSANDRA-12403
            """
        cluster = self.cluster
        cluster.set_configuration_options(values={'slow_query_log_timeout_in_ms': 0,
                                                  'request_timeout_in_ms': 120000,
                                                  'read_request_timeout_in_ms': 120000,
                                                  'range_request_timeout_in_ms': 120000})
    
        # cassandra.test.read_iteration_delay_ms causes the state tracking read iterators
        # introduced by CASSANDRA-7392 to pause by the specified amount of milliseconds during each
        # iteration of non system queries, so that these queries take much longer to complete,
        # see ReadCommand.withStateTracking()
        cluster.populate(1).start(jvm_args=["-Dcassandra.monitoring_report_interval_ms=10",
                                            "-Dcassandra.test.read_iteration_delay_ms=1"])
        node = cluster.nodelist()[0]
        session = self.patient_cql_connection(node)
    
        create_ks(session, 'ks', 1)
        session.execute("""
                CREATE TABLE test3 (
                    id int PRIMARY KEY,
                    val text
                );
            """)
    
        for i in range(100):
            session.execute("INSERT INTO test3 (id, val) VALUES ({}, 'foo')".format(i))
    
        session.execute(SimpleStatement("SELECT * from test3",
                                        consistency_level=ConsistencyLevel.ONE,
>                                       retry_policy=FallthroughRetryPolicy()))

cql_test.py:1152: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.connection.ConnectionShutdown: [Errno 104] Connection reset by peer

cassandra/cluster.py:4894: ConnectionShutdown
---------------------------- Captured stdout setup -----------------------------
04:46:45,269 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:46:44,193 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:46:44.193512
04:46:45,153 dtest_setup INFO cluster ccm directory: /tmp/dtest-ftchskyq
----------------------------- Captured stdout call -----------------------------

04:46:45,276 ccm DEBUG using balanced tokens for non-vnode cluster
04:46:45,904 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-ftchskyq/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-ftchskyq/test/node1/conf'}
04:46:45,905 ccm INFO node1: using Java 8 for the current invocation
04:46:46,69 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-ftchskyq/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-ftchskyq/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:46:46,69 ccm INFO node1: using Java 8 for the current invocation
04:46:46,151 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra

----------------------------- Captured stderr call -----------------------------
Exception in thread Thread-1:
Traceback (most recent call last):
  File "/usr/lib/python3.6/threading.py", line 916, in _bootstrap_inner
    self.run()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 193, in run
    self.scan_and_report()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 186, in scan_and_report
    on_error_call(errordata)
  File "/root/cassandra-dtest/dtest_setup.py", line 136, in _log_error_handler
    pytest.fail("Error details: \n{message}".format(message=message))
  File "/root/dtest/lib/python3.6/site-packages/_pytest/outcomes.py", line 97, in fail
    raise Failed(msg=msg, pytrace=pytrace)
Failed: Error details: 
Errors seen in logs for: node1
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:47:02,614 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:47:02,616 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:47:02,616 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

------------------------------ Captured log call -------------------------------
04:46:45,904 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-ftchskyq/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-ftchskyq/test/node1/conf'}
04:46:45,905 ccm INFO node1: using Java 8 for the current invocation
04:46:46,69 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-ftchskyq/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-ftchskyq/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:46:46,69 ccm INFO node1: using Java 8 for the current invocation
04:46:46,151 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
===Flaky Test Report===

test_disable_slow_query_log failed and was not selected for rerun.
	<class 'cassandra.connection.ConnectionShutdown'>
	[Errno 104] Connection reset by peer
	[<TracebackEntry /root/cassandra-dtest/cql_test.py:1152>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
====================== 1 failed, 1 error in 20.10 seconds ======================
[msx] rc = 1
v2v2 running time = 41641598130
---> v1v1 or v2v2 test failed.
v2v2 failed in a hypo test
proj: cassandra
u_test: cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
h_list: commitlog_segment_size_in_mb@@@CassandraDaemon@@@1@@@32@@@1024
vv_mode: v2v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log PASSED        [100%]
===Flaky Test Report===

test_disable_slow_query_log passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 16.95 seconds ===========================
[msx] rc = 0
v1v2 running time = 38557389376
---> v1v2 test suceeded.
cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log PASSED        [100%]
===Flaky Test Report===

test_disable_slow_query_log passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 18.29 seconds ===========================
[msx] rc = 0
v1v1 running time = 39879433116
cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log 
-------------------------------- live log call ---------------------------------
04:49:03,785 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down

------------------------------ live log teardown -------------------------------
04:49:03,892 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:49:03,193 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log ERROR         [100%]

==================================== ERRORS ====================================
______ ERROR at teardown of TestCQLSlowQuery.test_disable_slow_query_log _______
Unexpected error found in node logs (see stdout for full details). Errors: [ERROR [HintsWriteExecutor:1] 2022-02-01 04:49:03,193 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:49:03,195 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:49:03,196 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:49:03,193 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)]
---------------------------- Captured stdout setup -----------------------------
04:48:45,674 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:48:44,487 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:48:44.487131
04:48:45,586 dtest_setup INFO cluster ccm directory: /tmp/dtest-fi9sgy8m
------------------------------ Captured log call -------------------------------
04:48:46,342 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-fi9sgy8m/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-fi9sgy8m/test/node1/conf'}
04:48:46,342 ccm INFO node1: using Java 8 for the current invocation
04:48:46,497 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-fi9sgy8m/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-fi9sgy8m/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:48:46,498 ccm INFO node1: using Java 8 for the current invocation
04:48:46,577 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
04:49:03,785 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
---------------------------- Captured log teardown -----------------------------
04:49:03,892 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:49:03,193 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
=================================== FAILURES ===================================
_________________ TestCQLSlowQuery.test_disable_slow_query_log _________________

self = <cql_test.TestCQLSlowQuery object at 0x7fed74c78908>

    def test_disable_slow_query_log(self):
        """
            Check that a query is NOT reported as slow if slow query logging is disabled.
    
            - start a one node cluster with slow_query_log_timeout_in_ms set to 0 milliseconds
              (this will disable slow query logging), the read request timeouts set to a large value
              (to ensure queries are not aborted) and read_iteration_delay set to 5 milliseconds
              (this will cause read queries to take longer than usual)
            - CREATE and INSERT into a table
            - SELECT * from the table using a retry policy that never retries, and check that the slow
              query log messages are present in the logs
    
            @jira_ticket CASSANDRA-12403
            """
        cluster = self.cluster
        cluster.set_configuration_options(values={'slow_query_log_timeout_in_ms': 0,
                                                  'request_timeout_in_ms': 120000,
                                                  'read_request_timeout_in_ms': 120000,
                                                  'range_request_timeout_in_ms': 120000})
    
        # cassandra.test.read_iteration_delay_ms causes the state tracking read iterators
        # introduced by CASSANDRA-7392 to pause by the specified amount of milliseconds during each
        # iteration of non system queries, so that these queries take much longer to complete,
        # see ReadCommand.withStateTracking()
        cluster.populate(1).start(jvm_args=["-Dcassandra.monitoring_report_interval_ms=10",
                                            "-Dcassandra.test.read_iteration_delay_ms=1"])
        node = cluster.nodelist()[0]
        session = self.patient_cql_connection(node)
    
        create_ks(session, 'ks', 1)
        session.execute("""
                CREATE TABLE test3 (
                    id int PRIMARY KEY,
                    val text
                );
            """)
    
        for i in range(100):
>           session.execute("INSERT INTO test3 (id, val) VALUES ({}, 'foo')".format(i))

cql_test.py:1148: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
---------------------------- Captured stdout setup -----------------------------
04:48:45,674 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:48:44,487 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:48:44.487131
04:48:45,586 dtest_setup INFO cluster ccm directory: /tmp/dtest-fi9sgy8m
------------------------------ Captured log call -------------------------------
04:48:46,342 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-fi9sgy8m/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-fi9sgy8m/test/node1/conf'}
04:48:46,342 ccm INFO node1: using Java 8 for the current invocation
04:48:46,497 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-fi9sgy8m/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-fi9sgy8m/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:48:46,498 ccm INFO node1: using Java 8 for the current invocation
04:48:46,577 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
04:49:03,785 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
===Flaky Test Report===

test_disable_slow_query_log failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/cql_test.py:1148>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
====================== 1 failed, 1 error in 20.45 seconds ======================
[msx] rc = 1
v2v2 running time = 42110190020
---> v1v1 or v2v2 test failed.
v2v2 failed in a hypo test
proj: cassandra
u_test: cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
h_list: commitlog_segment_size_in_mb@@@CassandraDaemon@@@1@@@32@@@1024
vv_mode: v2v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log PASSED        [100%]
===Flaky Test Report===

test_disable_slow_query_log passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 17.84 seconds ===========================
[msx] rc = 0
v1v2 running time = 39439121547
---> v1v2 test suceeded.
cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log PASSED        [100%]
===Flaky Test Report===

test_disable_slow_query_log passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 21.10 seconds ===========================
[msx] rc = 0
v1v1 running time = 42669729770
cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log 
-------------------------------- live log call ---------------------------------
04:51:08,657 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down

------------------------------ live log teardown -------------------------------
04:51:08,764 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:51:08,037 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log ERROR         [100%]

==================================== ERRORS ====================================
______ ERROR at teardown of TestCQLSlowQuery.test_disable_slow_query_log _______
Unexpected error found in node logs (see stdout for full details). Errors: [ERROR [HintsWriteExecutor:1] 2022-02-01 04:51:08,037 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:51:08,041 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:51:08,042 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:51:08,037 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)]
---------------------------- Captured stdout setup -----------------------------
4:50:49,841 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:50:48,571 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:50:48.571593
04:50:49,730 dtest_setup INFO cluster ccm directory: /tmp/dtest-7c0yi1t3
----------------------------- Captured stderr call -----------------------------
Exception in thread Thread-1:
Traceback (most recent call last):
  File "/usr/lib/python3.6/threading.py", line 916, in _bootstrap_inner
    self.run()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 193, in run
    self.scan_and_report()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 186, in scan_and_report
    on_error_call(errordata)
  File "/root/cassandra-dtest/dtest_setup.py", line 136, in _log_error_handler
    pytest.fail("Error details: \n{message}".format(message=message))
  File "/root/dtest/lib/python3.6/site-packages/_pytest/outcomes.py", line 97, in fail
    raise Failed(msg=msg, pytrace=pytrace)
Failed: Error details: 
Errors seen in logs for: node1
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:51:08,037 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:51:08,041 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:51:08,042 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

------------------------------ Captured log call -------------------------------
04:50:50,529 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-7c0yi1t3/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-7c0yi1t3/test/node1/conf'}
04:50:50,530 ccm INFO node1: using Java 8 for the current invocation
04:50:50,681 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-7c0yi1t3/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-7c0yi1t3/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:50:50,682 ccm INFO node1: using Java 8 for the current invocation
04:50:50,760 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
---------------------------- Captured log teardown -----------------------------
04:51:08,764 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:51:08,037 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
=================================== FAILURES ===================================
_________________ TestCQLSlowQuery.test_disable_slow_query_log _________________

self = <cql_test.TestCQLSlowQuery object at 0x7fecab918828>

    def test_disable_slow_query_log(self):
        """
            Check that a query is NOT reported as slow if slow query logging is disabled.
    
            - start a one node cluster with slow_query_log_timeout_in_ms set to 0 milliseconds
              (this will disable slow query logging), the read request timeouts set to a large value
              (to ensure queries are not aborted) and read_iteration_delay set to 5 milliseconds
              (this will cause read queries to take longer than usual)
            - CREATE and INSERT into a table
            - SELECT * from the table using a retry policy that never retries, and check that the slow
              query log messages are present in the logs
    
            @jira_ticket CASSANDRA-12403
            """
        cluster = self.cluster
        cluster.set_configuration_options(values={'slow_query_log_timeout_in_ms': 0,
                                                  'request_timeout_in_ms': 120000,
                                                  'read_request_timeout_in_ms': 120000,
                                                  'range_request_timeout_in_ms': 120000})
    
        # cassandra.test.read_iteration_delay_ms causes the state tracking read iterators
        # introduced by CASSANDRA-7392 to pause by the specified amount of milliseconds during each
        # iteration of non system queries, so that these queries take much longer to complete,
        # see ReadCommand.withStateTracking()
        cluster.populate(1).start(jvm_args=["-Dcassandra.monitoring_report_interval_ms=10",
                                            "-Dcassandra.test.read_iteration_delay_ms=1"])
        node = cluster.nodelist()[0]
        session = self.patient_cql_connection(node)
    
        create_ks(session, 'ks', 1)
        session.execute("""
                CREATE TABLE test3 (
                    id int PRIMARY KEY,
                    val text
                );
>           """)

cql_test.py:1145: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
---------------------------- Captured stdout setup -----------------------------
4:50:49,841 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:50:48,571 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:50:48.571593
04:50:49,730 dtest_setup INFO cluster ccm directory: /tmp/dtest-7c0yi1t3
----------------------------- Captured stderr call -----------------------------
Exception in thread Thread-1:
Traceback (most recent call last):
  File "/usr/lib/python3.6/threading.py", line 916, in _bootstrap_inner
    self.run()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 193, in run
    self.scan_and_report()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 186, in scan_and_report
    on_error_call(errordata)
  File "/root/cassandra-dtest/dtest_setup.py", line 136, in _log_error_handler
    pytest.fail("Error details: \n{message}".format(message=message))
  File "/root/dtest/lib/python3.6/site-packages/_pytest/outcomes.py", line 97, in fail
    raise Failed(msg=msg, pytrace=pytrace)
Failed: Error details: 
Errors seen in logs for: node1
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:51:08,037 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:51:08,041 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:51:08,042 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

------------------------------ Captured log call -------------------------------
04:50:50,529 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-7c0yi1t3/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-7c0yi1t3/test/node1/conf'}
04:50:50,530 ccm INFO node1: using Java 8 for the current invocation
04:50:50,681 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-7c0yi1t3/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-7c0yi1t3/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:50:50,682 ccm INFO node1: using Java 8 for the current invocation
04:50:50,760 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
===Flaky Test Report===

test_disable_slow_query_log failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/cql_test.py:1145>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
====================== 1 failed, 1 error in 21.19 seconds ======================
[msx] rc = 1
v2v2 running time = 42767585856
---> v1v1 or v2v2 test failed.
v2v2 failed in a hypo test
proj: cassandra
u_test: cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
h_list: commitlog_segment_size_in_mb@@@CassandraDaemon@@@1@@@32@@@1024
vv_mode: v2v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log 
-------------------------------- live log call ---------------------------------
04:51:50,709 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down

------------------------------ live log teardown -------------------------------
04:51:50,816 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:51:50,082 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log ERROR         [100%]

==================================== ERRORS ====================================
______ ERROR at teardown of TestCQLSlowQuery.test_disable_slow_query_log _______
Unexpected error found in node logs (see stdout for full details). Errors: [ERROR [HintsWriteExecutor:1] 2022-02-01 04:51:50,082 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:51:50,084 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:51:50,085 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:51:50,082 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)]
---------------------------- Captured stdout setup -----------------------------
04:51:32,600 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:51:31,364 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:51:31.364483
04:51:32,474 dtest_setup INFO cluster ccm directory: /tmp/dtest-aqviinkn
----------------------------- Captured stdout call -----------------------------

04:51:32,610 ccm DEBUG using balanced tokens for non-vnode cluster
04:51:33,282 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-aqviinkn/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-aqviinkn/test/node1/conf'}
04:51:33,282 ccm INFO node1: using Java 8 for the current invocation
04:51:33,450 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-aqviinkn/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-aqviinkn/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:51:33,455 ccm INFO node1: using Java 8 for the current invocation
04:51:33,555 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
------------------------------ Captured log call -------------------------------
04:51:33,282 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-aqviinkn/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-aqviinkn/test/node1/conf'}
04:51:33,282 ccm INFO node1: using Java 8 for the current invocation
04:51:33,450 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-aqviinkn/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-aqviinkn/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:51:33,455 ccm INFO node1: using Java 8 for the current invocation
04:51:33,555 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
---------------------------- Captured log teardown -----------------------------
04:51:50,816 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:51:50,082 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
=================================== FAILURES ===================================
_________________ TestCQLSlowQuery.test_disable_slow_query_log _________________

self = <cql_test.TestCQLSlowQuery object at 0x7fd7a7f03908>

    def test_disable_slow_query_log(self):
        """
            Check that a query is NOT reported as slow if slow query logging is disabled.
    
            - start a one node cluster with slow_query_log_timeout_in_ms set to 0 milliseconds
              (this will disable slow query logging), the read request timeouts set to a large value
              (to ensure queries are not aborted) and read_iteration_delay set to 5 milliseconds
              (this will cause read queries to take longer than usual)
            - CREATE and INSERT into a table
            - SELECT * from the table using a retry policy that never retries, and check that the slow
              query log messages are present in the logs
    
            @jira_ticket CASSANDRA-12403
            """
        cluster = self.cluster
        cluster.set_configuration_options(values={'slow_query_log_timeout_in_ms': 0,
                                                  'request_timeout_in_ms': 120000,
                                                  'read_request_timeout_in_ms': 120000,
                                                  'range_request_timeout_in_ms': 120000})
    
        # cassandra.test.read_iteration_delay_ms causes the state tracking read iterators
        # introduced by CASSANDRA-7392 to pause by the specified amount of milliseconds during each
        # iteration of non system queries, so that these queries take much longer to complete,
        # see ReadCommand.withStateTracking()
        cluster.populate(1).start(jvm_args=["-Dcassandra.monitoring_report_interval_ms=10",
                                            "-Dcassandra.test.read_iteration_delay_ms=1"])
        node = cluster.nodelist()[0]
        session = self.patient_cql_connection(node)
    
        create_ks(session, 'ks', 1)
        session.execute("""
                CREATE TABLE test3 (
                    id int PRIMARY KEY,
                    val text
                );
>           """)

cql_test.py:1145: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
---------------------------- Captured stdout setup -----------------------------
04:51:32,600 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:51:31,364 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:51:31.364483
04:51:32,474 dtest_setup INFO cluster ccm directory: /tmp/dtest-aqviinkn
----------------------------- Captured stdout call -----------------------------

04:51:32,610 ccm DEBUG using balanced tokens for non-vnode cluster
04:51:33,282 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-aqviinkn/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-aqviinkn/test/node1/conf'}
04:51:33,282 ccm INFO node1: using Java 8 for the current invocation
04:51:33,450 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-aqviinkn/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-aqviinkn/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:51:33,455 ccm INFO node1: using Java 8 for the current invocation
04:51:33,555 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
------------------------------ Captured log call -------------------------------
04:51:33,282 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-aqviinkn/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-aqviinkn/test/node1/conf'}
04:51:33,282 ccm INFO node1: using Java 8 for the current invocation
04:51:33,450 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-aqviinkn/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-aqviinkn/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:51:33,455 ccm INFO node1: using Java 8 for the current invocation
04:51:33,555 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
===Flaky Test Report===

test_disable_slow_query_log failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/cql_test.py:1145>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
====================== 1 failed, 1 error in 20.43 seconds ======================
[msx] rc = 1
v1v2 running time = 42025595128
---> v1v2 test failed.
proj: cassandra
u_test: cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
h_list: commitlog_segment_size_in_mb@@@CassandraDaemon@@@1@@@32@@@1024
vv_mode: v1v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log PASSED        [100%]
===Flaky Test Report===

test_disable_slow_query_log passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 18.25 seconds ===========================
[msx] rc = 0
v1v1 running time = 39717463914
cassandra cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log 
-------------------------------- live log call ---------------------------------
04:53:12,570 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down

------------------------------ live log teardown -------------------------------
04:53:12,779 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:53:11,875 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log ERROR         [100%]

==================================== ERRORS ====================================
______ ERROR at teardown of TestCQLSlowQuery.test_disable_slow_query_log _______
Unexpected error found in node logs (see stdout for full details). Errors: [ERROR [HintsWriteExecutor:1] 2022-02-01 04:53:11,875 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:53:11,877 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:53:11,877 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748), ERROR [HintsWriteExecutor:1] 2022-02-01 04:53:11,875 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)]
---------------------------- Captured stdout setup -----------------------------
04:52:54,605 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:52:53,230 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:52:53.230846
04:52:54,482 dtest_setup INFO cluster ccm directory: /tmp/dtest-xd0djq1y
----------------------------- Captured stderr call -----------------------------
Exception in thread Thread-1:
Traceback (most recent call last):
  File "/usr/lib/python3.6/threading.py", line 916, in _bootstrap_inner
    self.run()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 193, in run
    self.scan_and_report()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 186, in scan_and_report
    on_error_call(errordata)
  File "/root/cassandra-dtest/dtest_setup.py", line 136, in _log_error_handler
    pytest.fail("Error details: \n{message}".format(message=message))
  File "/root/dtest/lib/python3.6/site-packages/_pytest/outcomes.py", line 97, in fail
    raise Failed(msg=msg, pytrace=pytrace)
Failed: Error details: 
Errors seen in logs for: node1
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:53:11,875 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:53:11,877 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:53:11,877 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

------------------------------ Captured log call -------------------------------
04:52:55,261 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-xd0djq1y/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-xd0djq1y/test/node1/conf'}
04:52:55,262 ccm INFO node1: using Java 8 for the current invocation
04:52:55,429 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-xd0djq1y/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-xd0djq1y/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:52:55,429 ccm INFO node1: using Java 8 for the current invocation
04:52:55,504 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
---------------------------- Captured log teardown -----------------------------
04:53:12,779 conftest ERROR Unexpected error in node1 log, error: 
ERROR [HintsWriteExecutor:1] 2022-02-01 04:53:11,875 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
=================================== FAILURES ===================================
_________________ TestCQLSlowQuery.test_disable_slow_query_log _________________

self = <cql_test.TestCQLSlowQuery object at 0x7fbd7c5cfd68>

    def test_disable_slow_query_log(self):
        """
            Check that a query is NOT reported as slow if slow query logging is disabled.
    
            - start a one node cluster with slow_query_log_timeout_in_ms set to 0 milliseconds
              (this will disable slow query logging), the read request timeouts set to a large value
              (to ensure queries are not aborted) and read_iteration_delay set to 5 milliseconds
              (this will cause read queries to take longer than usual)
            - CREATE and INSERT into a table
            - SELECT * from the table using a retry policy that never retries, and check that the slow
              query log messages are present in the logs
    
            @jira_ticket CASSANDRA-12403
            """
        cluster = self.cluster
        cluster.set_configuration_options(values={'slow_query_log_timeout_in_ms': 0,
                                                  'request_timeout_in_ms': 120000,
                                                  'read_request_timeout_in_ms': 120000,
                                                  'range_request_timeout_in_ms': 120000})
    
        # cassandra.test.read_iteration_delay_ms causes the state tracking read iterators
        # introduced by CASSANDRA-7392 to pause by the specified amount of milliseconds during each
        # iteration of non system queries, so that these queries take much longer to complete,
        # see ReadCommand.withStateTracking()
        cluster.populate(1).start(jvm_args=["-Dcassandra.monitoring_report_interval_ms=10",
                                            "-Dcassandra.test.read_iteration_delay_ms=1"])
        node = cluster.nodelist()[0]
        session = self.patient_cql_connection(node)
    
        create_ks(session, 'ks', 1)
        session.execute("""
                CREATE TABLE test3 (
                    id int PRIMARY KEY,
                    val text
                );
>           """)

cql_test.py:1145: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.cluster.NoHostAvailable: ('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})

cassandra/cluster.py:4894: NoHostAvailable
---------------------------- Captured stdout setup -----------------------------
04:52:54,605 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
04:52:53,230 conftest INFO Starting execution of test_disable_slow_query_log at 2022-02-01 04:52:53.230846
04:52:54,482 dtest_setup INFO cluster ccm directory: /tmp/dtest-xd0djq1y
----------------------------- Captured stderr call -----------------------------
Exception in thread Thread-1:
Traceback (most recent call last):
  File "/usr/lib/python3.6/threading.py", line 916, in _bootstrap_inner
    self.run()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 193, in run
    self.scan_and_report()
  File "/root/dtest/lib/python3.6/site-packages/ccmlib/cluster.py", line 186, in scan_and_report
    on_error_call(errordata)
  File "/root/cassandra-dtest/dtest_setup.py", line 136, in _log_error_handler
    pytest.fail("Error details: \n{message}".format(message=message))
  File "/root/dtest/lib/python3.6/site-packages/_pytest/outcomes.py", line 97, in fail
    raise Failed(msg=msg, pytrace=pytrace)
Failed: Error details: 
Errors seen in logs for: node1
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:53:11,875 CassandraDaemon.java:581 - Exception in thread Thread[HintsWriteExecutor:1,5,main]
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:53:11,877 JVMStabilityInspector.java:102 - OutOfMemory error letting the JVM handle the error:
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
node1: ERROR [HintsWriteExecutor:1] 2022-02-01 04:53:11,877 JVMStabilityInspector.java:151 - Force heap space OutOfMemoryError in the presence of
java.lang.OutOfMemoryError: Direct buffer memory
	at java.nio.Bits.reserveMemory(Bits.java:695)
	at java.nio.DirectByteBuffer.<init>(DirectByteBuffer.java:123)
	at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:311)
	at org.apache.cassandra.hints.HintsBuffer.create(HintsBuffer.java:73)
	at org.apache.cassandra.hints.HintsBufferPool.createBuffer(HintsBufferPool.java:131)
	at org.apache.cassandra.hints.HintsBufferPool.initializeCurrentBuffer(HintsBufferPool.java:102)
	at org.apache.cassandra.hints.HintsBufferPool.currentBuffer(HintsBufferPool.java:94)
	at org.apache.cassandra.hints.HintsWriteExecutor$FlushBufferPoolTask.run(HintsWriteExecutor.java:159)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)

------------------------------ Captured log call -------------------------------
04:52:55,261 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-xd0djq1y/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-xd0djq1y/test/node1/conf'}
04:52:55,262 ccm INFO node1: using Java 8 for the current invocation
04:52:55,429 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '28b39e975c50', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'cql_test.py::TestCQLSlowQuery::()::test_disable_slow_query_log (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-xd0djq1y/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-xd0djq1y/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.monitoring_report_interval_ms=10 -Dcassandra.test.read_iteration_delay_ms=1 -Dcassandra.migration_task_wait_in_seconds=2'}
04:52:55,429 ccm INFO node1: using Java 8 for the current invocation
04:52:55,504 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
===Flaky Test Report===

test_disable_slow_query_log failed and was not selected for rerun.
	<class 'cassandra.cluster.NoHostAvailable'>
	('Unable to complete the operation against any hosts', {<Host: 127.0.0.1:9042 datacenter1>: ConnectionShutdown('[Errno 104] Connection reset by peer',)})
	[<TracebackEntry /root/cassandra-dtest/cql_test.py:1145>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
====================== 1 failed, 1 error in 20.52 seconds ======================
[msx] rc = 1
v2v2 running time = 42283700290
---> v1v1 or v2v2 test failed.
v2v2 failed in a hypo test
proj: cassandra
u_test: cql_test.py::TestCQLSlowQuery::test_disable_slow_query_log
h_list: commitlog_segment_size_in_mb@@@CassandraDaemon@@@1@@@32@@@1024
vv_mode: v2v2
result: FAIL
failureMessage: 
stackTrace: 

early stop after 7 is satisfied
v1v2 failed with probability 6 out of 11
v1v1v2v2 failed with probability 7 out of 11
Total execution time in seconds : 1361
0
