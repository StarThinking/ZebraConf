my_type=hypothesis
proj=cassandra
u_test=pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
h_list[1]=memtable_offheap_space_in_mb@@@CassandraDaemon@@@-2@@@64@@@123
proj: cassandra
u_test: pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
h_list: memtable_offheap_space_in_mb@@@CassandraDaemon@@@-2@@@64@@@123
cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
15:34:49,37 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:34:55,709 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
15:35:10,236 cassandra.cluster ERROR Exception refreshing schema in response to schema change:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 4206, in cassandra.cluster.refresh_schema_and_set_result
  File "cassandra/cluster.py", line 3686, in cassandra.cluster.ControlConnection._refresh_schema
  File "cassandra/cluster.py", line 3935, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3975, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3963, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/connection.py", line 1076, in cassandra.connection.Connection.wait_for_responses
  File "cassandra/connection.py", line 1071, in cassandra.connection.Connection.wait_for_responses
  File "cassandra/connection.py", line 1570, in cassandra.connection.ResponseWaiter.deliver
cassandra.connection.ConnectionShutdown: [Errno 104] Connection reset by peer
15:35:10,239 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
15:35:10,241 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
15:35:10,307 cassandra.cluster WARNING Host 127.0.0.2:9042 has been marked down
15:35:11,345 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 1.7 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused
15:35:11,413 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.2:9042, scheduling retry in 1.96 seconds: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
15:35:11,445 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
15:35:13,49 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 4.08 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused
15:35:13,249 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
15:35:13,417 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.2:9042, scheduling retry in 4.08 seconds: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused

-------------------------------- live log call ---------------------------------
15:35:41,484 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:35:47,371 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_________________ TestPushedNotifications.test_schema_changes __________________

self = <pushed_notifications_test.TestPushedNotifications object at 0x7fd0ae124c18>

    @since("3.0")
    def test_schema_changes(self):
        """
            @jira_ticket CASSANDRA-10328
            Creating, updating and dropping a keyspace, a table and a materialized view
            will generate the correct schema change notifications.
            """
        self.cluster.set_configuration_options({'enable_materialized_views': 'true'})
        self.cluster.populate(2).start()
        node1, node2 = self.cluster.nodelist()
    
        session = self.patient_cql_connection(node1)
        waiter = NotificationWaiter(self, node2, ["SCHEMA_CHANGE"], keyspace='ks')
    
        create_ks(session, 'ks', 3)
        session.execute("create TABLE t (k int PRIMARY KEY , v int)")
        session.execute("alter TABLE t add v1 int;")
    
        session.execute("create MATERIALIZED VIEW mv as select * from t WHERE v IS NOT NULL AND k IS NOT NULL PRIMARY KEY (v, k)")
        session.execute(" alter materialized view mv with min_index_interval = 100")
    
>       session.execute("drop MATERIALIZED VIEW mv")

pushed_notifications_test.py:341: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.OperationTimedOut: errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042

cassandra/cluster.py:4894: OperationTimedOut
---------------------------- Captured stdout setup -----------------------------
15:34:23,175 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
15:34:22,519 conftest INFO Starting execution of test_schema_changes at 2022-02-02 15:34:22.519683
15:34:23,79 dtest_setup INFO cluster ccm directory: /tmp/dtest-mbqur1mi
------------------------------ Captured log call -------------------------------
15:34:24,129 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-mbqur1mi/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-mbqur1mi/test/node1/conf'}
15:34:24,129 ccm INFO node1: using Java 8 for the current invocation
15:34:24,293 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-mbqur1mi/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-mbqur1mi/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
15:34:24,294 ccm INFO node1: using Java 8 for the current invocation
15:34:24,378 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:34:24,633 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-mbqur1mi/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-mbqur1mi/test/node2/conf'}
15:34:24,634 ccm INFO node2: using Java 8 for the current invocation
15:34:24,803 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-mbqur1mi/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-mbqur1mi/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
15:34:24,804 ccm INFO node2: using Java 8 for the current invocation
15:34:24,887 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:34:48,132 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
15:34:48,318 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
15:34:49,37 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:34:55,709 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
15:35:13,620 ccm DEBUG Log-watching thread exiting.
---------------------------- Captured stdout setup -----------------------------
15:35:17,714 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
15:35:16,785 conftest INFO Starting execution of test_schema_changes at 2022-02-02 15:35:16.785134
15:35:17,598 dtest_setup INFO cluster ccm directory: /tmp/dtest-c5yv9vjt
------------------------------ Captured log call -------------------------------
15:35:18,887 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-c5yv9vjt/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-c5yv9vjt/test/node1/conf'}
15:35:18,888 ccm INFO node1: using Java 8 for the current invocation
15:35:19,49 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-c5yv9vjt/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-c5yv9vjt/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
15:35:19,50 ccm INFO node1: using Java 8 for the current invocation
15:35:19,136 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:35:19,397 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-c5yv9vjt/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-c5yv9vjt/test/node2/conf'}
15:35:19,398 ccm INFO node2: using Java 8 for the current invocation
15:35:19,576 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-c5yv9vjt/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-c5yv9vjt/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
15:35:19,576 ccm INFO node2: using Java 8 for the current invocation
15:35:19,661 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:35:40,905 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
15:35:41,126 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
15:35:41,484 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:35:47,371 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
15:35:13,620 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
15:35:13,620 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
15:36:02,383 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_schema_changes failed (1 runs remaining out of 2).
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]
test_schema_changes failed; it passed 0 out of the required 1 times.
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 100.65 seconds ==========================
[msx] rc = 1
v1v2 running time = 122414519322
---> v1v2 test failed.
proj: cassandra
u_test: pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
h_list: memtable_offheap_space_in_mb@@@CassandraDaemon@@@-2@@@64@@@123
vv_mode: v1v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
15:36:49,501 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:36:56,677 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_schema_changes passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 56.20 seconds ===========================
[msx] rc = 0
v1v1 running time = 77885153800
cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
15:38:06,947 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:38:12,632 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
15:38:27,145 cassandra.cluster ERROR Exception refreshing schema in response to schema change:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 4206, in cassandra.cluster.refresh_schema_and_set_result
  File "cassandra/cluster.py", line 3686, in cassandra.cluster.ControlConnection._refresh_schema
  File "cassandra/cluster.py", line 3935, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3975, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3963, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/connection.py", line 1041, in cassandra.connection.Connection.wait_for_responses
cassandra.connection.ConnectionShutdown: Connection <LibevConnection(140176817356928) 127.0.0.2:9042 (defunct)> is already closed
15:38:27,175 cassandra.cluster WARNING Host 127.0.0.2:9042 has been marked down
15:38:27,268 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
15:38:27,273 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
15:38:28,277 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.2:9042, scheduling retry in 2.0 seconds: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
15:38:28,277 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
15:38:28,476 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 1.98 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused

-------------------------------- live log call ---------------------------------
15:38:59,439 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:39:05,58 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_schema_changes failed (1 runs remaining out of 2).
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]
test_schema_changes passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 108.21 seconds ==========================
[msx] rc = 0
v2v2 running time = 129874933670
---> v1v1 and v2v2 test test suceeded.
cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
15:40:18,784 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:40:25,360 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
15:40:40,74 cassandra.cluster WARNING Host 127.0.0.2:9042 has been marked down
15:40:40,87 cassandra.cluster ERROR Exception refreshing schema in response to schema change:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 4206, in cassandra.cluster.refresh_schema_and_set_result
  File "cassandra/cluster.py", line 3686, in cassandra.cluster.ControlConnection._refresh_schema
  File "cassandra/cluster.py", line 3935, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3975, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3963, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/connection.py", line 1041, in cassandra.connection.Connection.wait_for_responses
cassandra.connection.ConnectionShutdown: Connection <LibevConnection(139768497860792) 127.0.0.2:9042 (defunct)> is already closed
15:40:41,337 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.2:9042, scheduling retry in 2.28 seconds: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused

-------------------------------- live log call ---------------------------------
15:41:10,315 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:41:17,782 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_________________ TestPushedNotifications.test_schema_changes __________________

self = <pushed_notifications_test.TestPushedNotifications object at 0x7f1e63a9ee48>

    @since("3.0")
    def test_schema_changes(self):
        """
            @jira_ticket CASSANDRA-10328
            Creating, updating and dropping a keyspace, a table and a materialized view
            will generate the correct schema change notifications.
            """
        self.cluster.set_configuration_options({'enable_materialized_views': 'true'})
        self.cluster.populate(2).start()
        node1, node2 = self.cluster.nodelist()
    
        session = self.patient_cql_connection(node1)
        waiter = NotificationWaiter(self, node2, ["SCHEMA_CHANGE"], keyspace='ks')
    
        create_ks(session, 'ks', 3)
        session.execute("create TABLE t (k int PRIMARY KEY , v int)")
        session.execute("alter TABLE t add v1 int;")
    
        session.execute("create MATERIALIZED VIEW mv as select * from t WHERE v IS NOT NULL AND k IS NOT NULL PRIMARY KEY (v, k)")
        session.execute(" alter materialized view mv with min_index_interval = 100")
    
>       session.execute("drop MATERIALIZED VIEW mv")

pushed_notifications_test.py:341: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.OperationTimedOut: errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042

cassandra/cluster.py:4894: OperationTimedOut
---------------------------- Captured stdout setup -----------------------------
15:39:54,19 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
15:39:52,770 conftest INFO Starting execution of test_schema_changes at 2022-02-02 15:39:52.770627
15:39:53,920 dtest_setup INFO cluster ccm directory: /tmp/dtest-i2ktwgoz
------------------------------ Captured log call -------------------------------
15:39:55,136 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-i2ktwgoz/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-i2ktwgoz/test/node1/conf'}
15:39:55,137 ccm INFO node1: using Java 8 for the current invocation
15:39:55,297 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-i2ktwgoz/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-i2ktwgoz/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
15:39:55,297 ccm INFO node1: using Java 8 for the current invocation
15:39:55,378 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:39:55,635 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-i2ktwgoz/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-i2ktwgoz/test/node2/conf'}
15:39:55,636 ccm INFO node2: using Java 8 for the current invocation
15:39:55,802 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-i2ktwgoz/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-i2ktwgoz/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
15:39:55,803 ccm INFO node2: using Java 8 for the current invocation
15:39:55,882 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:40:18,199 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
15:40:18,403 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
15:40:18,784 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:40:25,360 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
15:40:43,186 ccm DEBUG Log-watching thread exiting.
---------------------------- Captured stdout setup -----------------------------
15:40:46,647 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
15:40:46,78 conftest INFO Starting execution of test_schema_changes at 2022-02-02 15:40:46.078444
15:40:46,539 dtest_setup INFO cluster ccm directory: /tmp/dtest-xg0cqurj
------------------------------ Captured log call -------------------------------
15:40:47,699 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-xg0cqurj/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-xg0cqurj/test/node1/conf'}
15:40:47,700 ccm INFO node1: using Java 8 for the current invocation
15:40:47,879 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-xg0cqurj/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-xg0cqurj/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
15:40:47,880 ccm INFO node1: using Java 8 for the current invocation
15:40:47,965 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:40:48,229 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-xg0cqurj/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-xg0cqurj/test/node2/conf'}
15:40:48,229 ccm INFO node2: using Java 8 for the current invocation
15:40:48,411 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-xg0cqurj/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-xg0cqurj/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
15:40:48,412 ccm INFO node2: using Java 8 for the current invocation
15:40:48,503 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:41:09,773 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
15:41:09,972 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
15:41:10,315 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:41:17,782 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
15:40:43,186 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
15:40:43,186 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
15:41:32,330 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_schema_changes failed (1 runs remaining out of 2).
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]
test_schema_changes failed; it passed 0 out of the required 1 times.
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 100.26 seconds ==========================
[msx] rc = 1
v1v2 running time = 122126870295
---> v1v2 test failed.
proj: cassandra
u_test: pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
h_list: memtable_offheap_space_in_mb@@@CassandraDaemon@@@-2@@@64@@@123
vv_mode: v1v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
15:42:20,845 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:42:27,899 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
15:42:42,806 cassandra.cluster ERROR Exception refreshing schema in response to schema change:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 4206, in cassandra.cluster.refresh_schema_and_set_result
  File "cassandra/cluster.py", line 3686, in cassandra.cluster.ControlConnection._refresh_schema
  File "cassandra/cluster.py", line 3935, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3975, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3963, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/connection.py", line 1076, in cassandra.connection.Connection.wait_for_responses
  File "cassandra/connection.py", line 1071, in cassandra.connection.Connection.wait_for_responses
  File "cassandra/connection.py", line 1570, in cassandra.connection.ResponseWaiter.deliver
cassandra.connection.ConnectionShutdown: [Errno 104] Connection reset by peer
15:42:42,807 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
15:42:42,944 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
15:42:43,948 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 1.86 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused
15:42:44,48 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
15:42:45,852 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 3.88 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused

-------------------------------- live log call ---------------------------------
15:43:14,764 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:43:24,245 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_________________ TestPushedNotifications.test_schema_changes __________________

self = <pushed_notifications_test.TestPushedNotifications object at 0x7f3da234eb70>

    @since("3.0")
    def test_schema_changes(self):
        """
            @jira_ticket CASSANDRA-10328
            Creating, updating and dropping a keyspace, a table and a materialized view
            will generate the correct schema change notifications.
            """
        self.cluster.set_configuration_options({'enable_materialized_views': 'true'})
        self.cluster.populate(2).start()
        node1, node2 = self.cluster.nodelist()
    
        session = self.patient_cql_connection(node1)
        waiter = NotificationWaiter(self, node2, ["SCHEMA_CHANGE"], keyspace='ks')
    
        create_ks(session, 'ks', 3)
        session.execute("create TABLE t (k int PRIMARY KEY , v int)")
        session.execute("alter TABLE t add v1 int;")
    
        session.execute("create MATERIALIZED VIEW mv as select * from t WHERE v IS NOT NULL AND k IS NOT NULL PRIMARY KEY (v, k)")
        session.execute(" alter materialized view mv with min_index_interval = 100")
    
>       session.execute("drop MATERIALIZED VIEW mv")

pushed_notifications_test.py:341: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.OperationTimedOut: errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042

cassandra/cluster.py:4894: OperationTimedOut
---------------------------- Captured stdout setup -----------------------------
15:41:55,775 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
15:41:54,761 conftest INFO Starting execution of test_schema_changes at 2022-02-02 15:41:54.761324
15:41:55,672 dtest_setup INFO cluster ccm directory: /tmp/dtest-aczm780u
------------------------------ Captured log call -------------------------------
15:41:56,710 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-aczm780u/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-aczm780u/test/node1/conf'}
15:41:56,711 ccm INFO node1: using Java 8 for the current invocation
15:41:56,883 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-aczm780u/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-aczm780u/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
15:41:56,884 ccm INFO node1: using Java 8 for the current invocation
15:41:56,977 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:41:57,242 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-aczm780u/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-aczm780u/test/node2/conf'}
15:41:57,243 ccm INFO node2: using Java 8 for the current invocation
15:41:57,431 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-aczm780u/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-aczm780u/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
15:41:57,432 ccm INFO node2: using Java 8 for the current invocation
15:41:57,572 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:42:19,874 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
15:42:20,73 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
15:42:20,845 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:42:27,899 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
15:42:45,982 ccm DEBUG Log-watching thread exiting.
---------------------------- Captured stdout setup -----------------------------
15:42:50,84 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
15:42:49,250 conftest INFO Starting execution of test_schema_changes at 2022-02-02 15:42:49.250390
15:42:49,963 dtest_setup INFO cluster ccm directory: /tmp/dtest-qumaghj6
------------------------------ Captured log call -------------------------------
15:42:51,183 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-qumaghj6/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-qumaghj6/test/node1/conf'}
15:42:51,183 ccm INFO node1: using Java 8 for the current invocation
15:42:51,356 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-qumaghj6/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-qumaghj6/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
15:42:51,357 ccm INFO node1: using Java 8 for the current invocation
15:42:51,450 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:42:51,713 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-qumaghj6/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-qumaghj6/test/node2/conf'}
15:42:51,714 ccm INFO node2: using Java 8 for the current invocation
15:42:51,885 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-qumaghj6/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-qumaghj6/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
15:42:51,885 ccm INFO node2: using Java 8 for the current invocation
15:42:51,972 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:43:13,223 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
15:43:13,415 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
15:43:14,764 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:43:24,245 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
15:42:45,982 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
15:42:45,982 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
15:43:39,542 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_schema_changes failed (1 runs remaining out of 2).
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]
test_schema_changes failed; it passed 0 out of the required 1 times.
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 107.49 seconds ==========================
[msx] rc = 1
v1v1 running time = 129208995598
cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
15:44:31,467 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:44:37,938 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
15:44:51,932 cassandra.cluster ERROR Exception refreshing schema in response to schema change:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 4206, in cassandra.cluster.refresh_schema_and_set_result
  File "cassandra/cluster.py", line 3686, in cassandra.cluster.ControlConnection._refresh_schema
  File "cassandra/cluster.py", line 3935, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3975, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3963, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/connection.py", line 1076, in cassandra.connection.Connection.wait_for_responses
  File "cassandra/connection.py", line 1071, in cassandra.connection.Connection.wait_for_responses
  File "cassandra/connection.py", line 1570, in cassandra.connection.ResponseWaiter.deliver
cassandra.connection.ConnectionShutdown: [Errno 104] Connection reset by peer
15:44:51,934 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
15:44:51,954 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 837, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 350, in handle_read
    buf = self._socket.recv(self.in_buffer_size)
ConnectionResetError: [Errno 104] Connection reset by peer
15:44:53,42 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
15:44:53,142 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 2.26 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused

-------------------------------- live log call ---------------------------------
15:45:27,623 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:45:34,364 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_________________ TestPushedNotifications.test_schema_changes __________________

self = <pushed_notifications_test.TestPushedNotifications object at 0x7eff54f009b0>

    @since("3.0")
    def test_schema_changes(self):
        """
            @jira_ticket CASSANDRA-10328
            Creating, updating and dropping a keyspace, a table and a materialized view
            will generate the correct schema change notifications.
            """
        self.cluster.set_configuration_options({'enable_materialized_views': 'true'})
        self.cluster.populate(2).start()
        node1, node2 = self.cluster.nodelist()
    
        session = self.patient_cql_connection(node1)
        waiter = NotificationWaiter(self, node2, ["SCHEMA_CHANGE"], keyspace='ks')
    
        create_ks(session, 'ks', 3)
        session.execute("create TABLE t (k int PRIMARY KEY , v int)")
        session.execute("alter TABLE t add v1 int;")
    
        session.execute("create MATERIALIZED VIEW mv as select * from t WHERE v IS NOT NULL AND k IS NOT NULL PRIMARY KEY (v, k)")
        session.execute(" alter materialized view mv with min_index_interval = 100")
    
>       session.execute("drop MATERIALIZED VIEW mv")

pushed_notifications_test.py:341: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.OperationTimedOut: errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042

cassandra/cluster.py:4894: OperationTimedOut
---------------------------- Captured stdout setup -----------------------------
15:44:04,665 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
15:44:03,966 conftest INFO Starting execution of test_schema_changes at 2022-02-02 15:44:03.966578
15:44:04,574 dtest_setup INFO cluster ccm directory: /tmp/dtest-2ax062p3
------------------------------ Captured log call -------------------------------
15:44:05,623 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-2ax062p3/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-2ax062p3/test/node1/conf'}
15:44:05,624 ccm INFO node1: using Java 8 for the current invocation
15:44:05,795 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-2ax062p3/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-2ax062p3/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
15:44:05,796 ccm INFO node1: using Java 8 for the current invocation
15:44:05,882 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:44:06,160 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-2ax062p3/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-2ax062p3/test/node2/conf'}
15:44:06,160 ccm INFO node2: using Java 8 for the current invocation
15:44:06,325 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-2ax062p3/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-2ax062p3/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
15:44:06,326 ccm INFO node2: using Java 8 for the current invocation
15:44:06,407 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:44:30,647 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
15:44:30,903 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
15:44:31,467 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:44:37,938 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
15:44:54,865 ccm DEBUG Log-watching thread exiting.
---------------------------- Captured stdout setup -----------------------------
15:44:59,389 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
15:44:58,169 conftest INFO Starting execution of test_schema_changes at 2022-02-02 15:44:58.169688
15:44:59,271 dtest_setup INFO cluster ccm directory: /tmp/dtest-sw0ydr_5
------------------------------ Captured log call -------------------------------
15:45:00,775 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-sw0ydr_5/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-sw0ydr_5/test/node1/conf'}
15:45:00,776 ccm INFO node1: using Java 8 for the current invocation
15:45:00,958 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-sw0ydr_5/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-sw0ydr_5/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
15:45:00,958 ccm INFO node1: using Java 8 for the current invocation
15:45:01,36 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:45:01,276 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-sw0ydr_5/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-sw0ydr_5/test/node2/conf'}
15:45:01,277 ccm INFO node2: using Java 8 for the current invocation
15:45:01,440 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-sw0ydr_5/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-sw0ydr_5/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
15:45:01,441 ccm INFO node2: using Java 8 for the current invocation
15:45:01,532 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:45:26,802 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
15:45:27,9 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
15:45:27,623 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:45:34,364 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
15:44:54,865 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
15:44:54,865 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
15:45:50,594 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_schema_changes failed (1 runs remaining out of 2).
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]
test_schema_changes failed; it passed 0 out of the required 1 times.
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 107.58 seconds ==========================
[msx] rc = 1
v2v2 running time = 129199400316
---> v1v1 or v2v2 test failed.
v1v1 failed in a hypo test
proj: cassandra
u_test: pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
h_list: memtable_offheap_space_in_mb@@@CassandraDaemon@@@-2@@@64@@@123
vv_mode: v1v1
result: FAIL
failureMessage: 
stackTrace: 

v2v2 failed in a hypo test
proj: cassandra
u_test: pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
h_list: memtable_offheap_space_in_mb@@@CassandraDaemon@@@-2@@@64@@@123
vv_mode: v2v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
15:46:37,458 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:46:43,149 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_schema_changes passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 55.78 seconds ===========================
[msx] rc = 0
v1v2 running time = 77486930538
---> v1v2 test suceeded.
cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
15:47:56,137 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:48:03,566 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
15:48:18,159 cassandra.cluster ERROR Exception refreshing schema in response to schema change:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 4206, in cassandra.cluster.refresh_schema_and_set_result
  File "cassandra/cluster.py", line 3686, in cassandra.cluster.ControlConnection._refresh_schema
  File "cassandra/cluster.py", line 3935, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3975, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3963, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/connection.py", line 1041, in cassandra.connection.Connection.wait_for_responses
cassandra.connection.ConnectionShutdown: Connection <LibevConnection(139681983528072) 127.0.0.1:9042 (defunct)> is already closed
15:48:18,160 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
15:48:18,174 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
15:48:19,177 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 1.74 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused
15:48:19,277 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused

-------------------------------- live log call ---------------------------------
15:48:50,508 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:49:00,421 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_________________ TestPushedNotifications.test_schema_changes __________________

self = <pushed_notifications_test.TestPushedNotifications object at 0x7f0a3e7be5c0>

    @since("3.0")
    def test_schema_changes(self):
        """
            @jira_ticket CASSANDRA-10328
            Creating, updating and dropping a keyspace, a table and a materialized view
            will generate the correct schema change notifications.
            """
        self.cluster.set_configuration_options({'enable_materialized_views': 'true'})
        self.cluster.populate(2).start()
        node1, node2 = self.cluster.nodelist()
    
        session = self.patient_cql_connection(node1)
        waiter = NotificationWaiter(self, node2, ["SCHEMA_CHANGE"], keyspace='ks')
    
        create_ks(session, 'ks', 3)
        session.execute("create TABLE t (k int PRIMARY KEY , v int)")
        session.execute("alter TABLE t add v1 int;")
    
        session.execute("create MATERIALIZED VIEW mv as select * from t WHERE v IS NOT NULL AND k IS NOT NULL PRIMARY KEY (v, k)")
        session.execute(" alter materialized view mv with min_index_interval = 100")
    
>       session.execute("drop MATERIALIZED VIEW mv")

pushed_notifications_test.py:341: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.OperationTimedOut: errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042

cassandra/cluster.py:4894: OperationTimedOut
---------------------------- Captured stdout setup -----------------------------
15:47:31,537 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
15:47:30,583 conftest INFO Starting execution of test_schema_changes at 2022-02-02 15:47:30.583005
15:47:31,442 dtest_setup INFO cluster ccm directory: /tmp/dtest-obq6a814
------------------------------ Captured log call -------------------------------
15:47:32,474 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-obq6a814/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-obq6a814/test/node1/conf'}
15:47:32,474 ccm INFO node1: using Java 8 for the current invocation
15:47:32,654 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-obq6a814/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-obq6a814/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
15:47:32,655 ccm INFO node1: using Java 8 for the current invocation
15:47:32,739 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:47:32,997 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-obq6a814/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-obq6a814/test/node2/conf'}
15:47:32,998 ccm INFO node2: using Java 8 for the current invocation
15:47:33,170 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-obq6a814/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-obq6a814/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
15:47:33,171 ccm INFO node2: using Java 8 for the current invocation
15:47:33,273 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:47:55,593 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
15:47:55,797 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
15:47:56,137 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:48:03,566 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
15:48:20,965 ccm DEBUG Log-watching thread exiting.
---------------------------- Captured stdout setup -----------------------------
5:48:25,338 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
15:48:24,271 conftest INFO Starting execution of test_schema_changes at 2022-02-02 15:48:24.271607
15:48:25,231 dtest_setup INFO cluster ccm directory: /tmp/dtest-v3fzxbj3
------------------------------ Captured log call -------------------------------
15:48:26,663 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-v3fzxbj3/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-v3fzxbj3/test/node1/conf'}
15:48:26,664 ccm INFO node1: using Java 8 for the current invocation
15:48:26,839 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-v3fzxbj3/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-v3fzxbj3/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
15:48:26,840 ccm INFO node1: using Java 8 for the current invocation
15:48:26,917 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:48:27,168 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-v3fzxbj3/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-v3fzxbj3/test/node2/conf'}
15:48:27,169 ccm INFO node2: using Java 8 for the current invocation
15:48:27,352 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-v3fzxbj3/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-v3fzxbj3/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
15:48:27,353 ccm INFO node2: using Java 8 for the current invocation
15:48:27,443 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:48:49,746 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
15:48:49,964 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
15:48:50,508 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:49:00,421 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
15:48:20,965 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
15:48:20,965 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
15:49:16,86 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_schema_changes failed (1 runs remaining out of 2).
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]
test_schema_changes failed; it passed 0 out of the required 1 times.
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 106.15 seconds ==========================
[msx] rc = 1
v1v1 running time = 127846193245
cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
15:50:02,737 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:50:12,19 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
15:50:26,465 cassandra.cluster ERROR Exception refreshing schema in response to schema change:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 4206, in cassandra.cluster.refresh_schema_and_set_result
  File "cassandra/cluster.py", line 3686, in cassandra.cluster.ControlConnection._refresh_schema
  File "cassandra/cluster.py", line 3935, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3975, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3963, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/connection.py", line 1041, in cassandra.connection.Connection.wait_for_responses
cassandra.connection.ConnectionShutdown: Connection <LibevConnection(140558647849200) 127.0.0.2:9042 (defunct)> is already closed
15:50:26,546 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
15:50:26,547 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
15:50:27,550 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 2.26 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused
15:50:27,650 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused

-------------------------------- live log call ---------------------------------
15:51:00,13 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:51:07,780 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_________________ TestPushedNotifications.test_schema_changes __________________

self = <pushed_notifications_test.TestPushedNotifications object at 0x7fd65c463588>

    @since("3.0")
    def test_schema_changes(self):
        """
            @jira_ticket CASSANDRA-10328
            Creating, updating and dropping a keyspace, a table and a materialized view
            will generate the correct schema change notifications.
            """
        self.cluster.set_configuration_options({'enable_materialized_views': 'true'})
        self.cluster.populate(2).start()
        node1, node2 = self.cluster.nodelist()
    
        session = self.patient_cql_connection(node1)
        waiter = NotificationWaiter(self, node2, ["SCHEMA_CHANGE"], keyspace='ks')
    
        create_ks(session, 'ks', 3)
        session.execute("create TABLE t (k int PRIMARY KEY , v int)")
        session.execute("alter TABLE t add v1 int;")
    
        session.execute("create MATERIALIZED VIEW mv as select * from t WHERE v IS NOT NULL AND k IS NOT NULL PRIMARY KEY (v, k)")
        session.execute(" alter materialized view mv with min_index_interval = 100")
    
>       session.execute("drop MATERIALIZED VIEW mv")

pushed_notifications_test.py:341: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.OperationTimedOut: errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042

cassandra/cluster.py:4894: OperationTimedOut
---------------------------- Captured stdout setup -----------------------------
15:49:39,29 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
15:49:38,475 conftest INFO Starting execution of test_schema_changes at 2022-02-02 15:49:38.475441
15:49:38,932 dtest_setup INFO cluster ccm directory: /tmp/dtest-5s_sdhg_
------------------------------ Captured log call -------------------------------
15:49:39,979 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-5s_sdhg_/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-5s_sdhg_/test/node1/conf'}
15:49:39,979 ccm INFO node1: using Java 8 for the current invocation
15:49:40,153 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-5s_sdhg_/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-5s_sdhg_/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
15:49:40,153 ccm INFO node1: using Java 8 for the current invocation
15:49:40,241 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:49:40,516 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-5s_sdhg_/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-5s_sdhg_/test/node2/conf'}
15:49:40,517 ccm INFO node2: using Java 8 for the current invocation
15:49:40,688 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-5s_sdhg_/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-5s_sdhg_/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
15:49:40,689 ccm INFO node2: using Java 8 for the current invocation
15:49:40,769 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:50:02,9 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
15:50:02,198 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
15:50:02,737 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:50:12,19 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
15:50:29,995 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stderr teardown ---------------------------
swapoff: Not superuser.
---------------------------- Captured stdout setup -----------------------------
5:50:35,41 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
15:50:33,373 conftest INFO Starting execution of test_schema_changes at 2022-02-02 15:50:33.373368
15:50:34,936 dtest_setup INFO cluster ccm directory: /tmp/dtest-xasrh3w2
------------------------------ Captured log call -------------------------------
15:50:36,218 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-xasrh3w2/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-xasrh3w2/test/node1/conf'}
15:50:36,219 ccm INFO node1: using Java 8 for the current invocation
15:50:36,382 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-xasrh3w2/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-xasrh3w2/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
15:50:36,383 ccm INFO node1: using Java 8 for the current invocation
15:50:36,465 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:50:36,735 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-xasrh3w2/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-xasrh3w2/test/node2/conf'}
15:50:36,736 ccm INFO node2: using Java 8 for the current invocation
15:50:36,909 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-xasrh3w2/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-xasrh3w2/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
15:50:36,910 ccm INFO node2: using Java 8 for the current invocation
15:50:36,996 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:50:59,410 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
15:50:59,611 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
15:51:00,13 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:51:07,780 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
15:50:29,995 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stderr teardown ---------------------------
swapoff: Not superuser.
--------------------------- Captured stdout teardown ---------------------------
15:50:29,995 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stderr teardown ---------------------------
swapoff: Not superuser.
--------------------------- Captured stdout teardown ---------------------------
15:51:25,498 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_schema_changes failed (1 runs remaining out of 2).
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]
test_schema_changes failed; it passed 0 out of the required 1 times.
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 109.66 seconds ==========================
[msx] rc = 1
v2v2 running time = 131418479814
---> v1v1 or v2v2 test failed.
v1v1 failed in a hypo test
proj: cassandra
u_test: pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
h_list: memtable_offheap_space_in_mb@@@CassandraDaemon@@@-2@@@64@@@123
vv_mode: v1v1
result: FAIL
failureMessage: 
stackTrace: 

v2v2 failed in a hypo test
proj: cassandra
u_test: pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
h_list: memtable_offheap_space_in_mb@@@CassandraDaemon@@@-2@@@64@@@123
vv_mode: v2v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
15:52:14,741 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:52:22,891 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
15:52:38,495 cassandra.cluster ERROR Exception refreshing schema in response to schema change:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 4206, in cassandra.cluster.refresh_schema_and_set_result
  File "cassandra/cluster.py", line 3686, in cassandra.cluster.ControlConnection._refresh_schema
  File "cassandra/cluster.py", line 3935, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3975, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3963, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/connection.py", line 1041, in cassandra.connection.Connection.wait_for_responses
cassandra.connection.ConnectionShutdown: Connection <LibevConnection(139838222077288) 127.0.0.2:9042 (defunct)> is already closed
15:52:38,496 cassandra.cluster WARNING Host 127.0.0.2:9042 has been marked down
15:52:38,498 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
15:52:38,501 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
15:52:39,504 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.2:9042, scheduling retry in 2.02 seconds: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
15:52:39,506 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
15:52:39,507 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 2.2 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused
15:52:41,514 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused

------------------------------ live log teardown -------------------------------
15:52:41,611 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.2:9042, scheduling retry in 4.4 seconds: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused

-------------------------------- live log call ---------------------------------
15:53:12,815 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:53:23,155 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_schema_changes failed (1 runs remaining out of 2).
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]
test_schema_changes passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 121.14 seconds ==========================
[msx] rc = 0
v1v2 running time = 142824976112
---> v1v2 test suceeded.
cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
15:54:42,614 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:54:48,220 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_schema_changes passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 60.19 seconds ===========================
[msx] rc = 0
v1v1 running time = 81906926879
cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
15:56:01,976 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:56:09,782 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_schema_changes passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 61.00 seconds ===========================
[msx] rc = 0
v2v2 running time = 82706790255
---> v1v1 and v2v2 test test suceeded.
cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
15:57:21,871 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:57:27,855 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
15:57:42,287 cassandra.cluster ERROR Exception refreshing schema in response to schema change:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 4206, in cassandra.cluster.refresh_schema_and_set_result
  File "cassandra/cluster.py", line 3686, in cassandra.cluster.ControlConnection._refresh_schema
  File "cassandra/cluster.py", line 3935, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3975, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3963, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/connection.py", line 1041, in cassandra.connection.Connection.wait_for_responses
cassandra.connection.ConnectionShutdown: Connection <LibevConnection(139987329592400) 127.0.0.1:9042 (defunct)> is already closed
15:57:42,289 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
15:57:42,433 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
15:57:43,435 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
15:57:43,539 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 1.86 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused
15:57:45,441 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
15:57:45,442 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 4.04 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused

-------------------------------- live log call ---------------------------------
15:58:15,487 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:58:21,941 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_________________ TestPushedNotifications.test_schema_changes __________________

self = <pushed_notifications_test.TestPushedNotifications object at 0x7f51568815f8>

    @since("3.0")
    def test_schema_changes(self):
        """
            @jira_ticket CASSANDRA-10328
            Creating, updating and dropping a keyspace, a table and a materialized view
            will generate the correct schema change notifications.
            """
        self.cluster.set_configuration_options({'enable_materialized_views': 'true'})
        self.cluster.populate(2).start()
        node1, node2 = self.cluster.nodelist()
    
        session = self.patient_cql_connection(node1)
        waiter = NotificationWaiter(self, node2, ["SCHEMA_CHANGE"], keyspace='ks')
    
        create_ks(session, 'ks', 3)
        session.execute("create TABLE t (k int PRIMARY KEY , v int)")
        session.execute("alter TABLE t add v1 int;")
    
        session.execute("create MATERIALIZED VIEW mv as select * from t WHERE v IS NOT NULL AND k IS NOT NULL PRIMARY KEY (v, k)")
        session.execute(" alter materialized view mv with min_index_interval = 100")
    
>       session.execute("drop MATERIALIZED VIEW mv")

pushed_notifications_test.py:341: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.OperationTimedOut: errors={'127.0.0.1:9042': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042

cassandra/cluster.py:4894: OperationTimedOut
---------------------------- Captured stdout setup -----------------------------
5:56:58,160 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
15:56:57,345 conftest INFO Starting execution of test_schema_changes at 2022-02-02 15:56:57.345600
15:56:58,53 dtest_setup INFO cluster ccm directory: /tmp/dtest-gak5k0e8
------------------------------ Captured log call -------------------------------
15:56:59,276 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-gak5k0e8/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-gak5k0e8/test/node1/conf'}
15:56:59,277 ccm INFO node1: using Java 8 for the current invocation
15:56:59,440 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-gak5k0e8/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-gak5k0e8/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
15:56:59,441 ccm INFO node1: using Java 8 for the current invocation
15:56:59,532 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:56:59,785 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-gak5k0e8/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-gak5k0e8/test/node2/conf'}
15:56:59,785 ccm INFO node2: using Java 8 for the current invocation
15:56:59,957 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-gak5k0e8/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-gak5k0e8/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
15:56:59,958 ccm INFO node2: using Java 8 for the current invocation
15:57:00,52 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:57:21,290 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
15:57:21,495 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
15:57:21,871 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:57:27,855 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
15:57:45,858 ccm DEBUG Log-watching thread exiting.
---------------------------- Captured stdout setup -----------------------------
15:57:50,265 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
15:57:49,179 conftest INFO Starting execution of test_schema_changes at 2022-02-02 15:57:49.179408
15:57:50,139 dtest_setup INFO cluster ccm directory: /tmp/dtest-4j71rhn3
------------------------------ Captured log call -------------------------------
15:57:51,476 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-4j71rhn3/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-4j71rhn3/test/node1/conf'}
15:57:51,477 ccm INFO node1: using Java 8 for the current invocation
15:57:51,629 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-4j71rhn3/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-4j71rhn3/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
15:57:51,629 ccm INFO node1: using Java 8 for the current invocation
15:57:51,715 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:57:51,973 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-4j71rhn3/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-4j71rhn3/test/node2/conf'}
15:57:51,973 ccm INFO node2: using Java 8 for the current invocation
15:57:52,150 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-4j71rhn3/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-4j71rhn3/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
15:57:52,151 ccm INFO node2: using Java 8 for the current invocation
15:57:52,230 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:58:14,490 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
15:58:14,674 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
15:58:15,487 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:58:21,941 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
15:57:45,858 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
15:57:45,858 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
15:58:37,693 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_schema_changes failed (1 runs remaining out of 2).
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]
test_schema_changes failed; it passed 0 out of the required 1 times.
	<class 'cassandra.OperationTimedOut'>
	errors={'127.0.0.1:9042': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 101.03 seconds ==========================
[msx] rc = 1
v1v2 running time = 122721724340
---> v1v2 test failed.
proj: cassandra
u_test: pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
h_list: memtable_offheap_space_in_mb@@@CassandraDaemon@@@-2@@@64@@@123
vv_mode: v1v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
15:59:28,608 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:59:38,615 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
15:59:53,777 cassandra.cluster ERROR Exception refreshing schema in response to schema change:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 4206, in cassandra.cluster.refresh_schema_and_set_result
  File "cassandra/cluster.py", line 3686, in cassandra.cluster.ControlConnection._refresh_schema
  File "cassandra/cluster.py", line 3935, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3975, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3963, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/connection.py", line 1076, in cassandra.connection.Connection.wait_for_responses
  File "cassandra/connection.py", line 1071, in cassandra.connection.Connection.wait_for_responses
  File "cassandra/connection.py", line 1570, in cassandra.connection.ResponseWaiter.deliver
cassandra.connection.ConnectionShutdown: [Errno 104] Connection reset by peer
15:59:53,778 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
15:59:53,908 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
15:59:54,911 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
15:59:54,911 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 2.04 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused
15:59:56,618 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
15:59:57,19 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 3.52 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused

-------------------------------- live log call ---------------------------------
16:00:26,699 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:00:34,271 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_________________ TestPushedNotifications.test_schema_changes __________________

self = <pushed_notifications_test.TestPushedNotifications object at 0x7f3c27b4de80>

    @since("3.0")
    def test_schema_changes(self):
        """
            @jira_ticket CASSANDRA-10328
            Creating, updating and dropping a keyspace, a table and a materialized view
            will generate the correct schema change notifications.
            """
        self.cluster.set_configuration_options({'enable_materialized_views': 'true'})
        self.cluster.populate(2).start()
        node1, node2 = self.cluster.nodelist()
    
        session = self.patient_cql_connection(node1)
        waiter = NotificationWaiter(self, node2, ["SCHEMA_CHANGE"], keyspace='ks')
    
        create_ks(session, 'ks', 3)
        session.execute("create TABLE t (k int PRIMARY KEY , v int)")
        session.execute("alter TABLE t add v1 int;")
    
        session.execute("create MATERIALIZED VIEW mv as select * from t WHERE v IS NOT NULL AND k IS NOT NULL PRIMARY KEY (v, k)")
        session.execute(" alter materialized view mv with min_index_interval = 100")
    
>       session.execute("drop MATERIALIZED VIEW mv")

pushed_notifications_test.py:341: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.OperationTimedOut: errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042

cassandra/cluster.py:4894: OperationTimedOut
---------------------------- Captured stdout setup -----------------------------
15:59:00,814 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
15:59:00,11 conftest INFO Starting execution of test_schema_changes at 2022-02-02 15:59:00.011422
15:59:00,720 dtest_setup INFO cluster ccm directory: /tmp/dtest-bwpchoq3
------------------------------ Captured log call -------------------------------
15:59:01,740 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-bwpchoq3/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-bwpchoq3/test/node1/conf'}
15:59:01,741 ccm INFO node1: using Java 8 for the current invocation
15:59:01,914 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-bwpchoq3/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-bwpchoq3/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
15:59:01,915 ccm INFO node1: using Java 8 for the current invocation
15:59:02,3 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:59:02,281 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-bwpchoq3/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-bwpchoq3/test/node2/conf'}
15:59:02,282 ccm INFO node2: using Java 8 for the current invocation
15:59:02,470 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-bwpchoq3/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-bwpchoq3/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
15:59:02,471 ccm INFO node2: using Java 8 for the current invocation
15:59:02,546 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
15:59:27,800 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
15:59:28,13 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
15:59:28,608 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
15:59:38,615 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
15:59:57,337 ccm DEBUG Log-watching thread exiting.
---------------------------- Captured stdout setup -----------------------------
16:00:01,910 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
16:00:00,759 conftest INFO Starting execution of test_schema_changes at 2022-02-02 16:00:00.759345
16:00:01,771 dtest_setup INFO cluster ccm directory: /tmp/dtest-tq5w7cnb
------------------------------ Captured log call -------------------------------
16:00:03,107 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-tq5w7cnb/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-tq5w7cnb/test/node1/conf'}
16:00:03,107 ccm INFO node1: using Java 8 for the current invocation
16:00:03,285 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-tq5w7cnb/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-tq5w7cnb/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
16:00:03,286 ccm INFO node1: using Java 8 for the current invocation
16:00:03,359 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:00:03,630 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-tq5w7cnb/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-tq5w7cnb/test/node2/conf'}
16:00:03,630 ccm INFO node2: using Java 8 for the current invocation
16:00:03,796 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-tq5w7cnb/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-tq5w7cnb/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
16:00:03,797 ccm INFO node2: using Java 8 for the current invocation
16:00:03,890 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:00:26,138 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
16:00:26,342 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
16:00:26,699 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:00:34,271 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
15:59:57,337 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
15:59:57,337 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
16:00:48,406 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_schema_changes failed (1 runs remaining out of 2).
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]
test_schema_changes failed; it passed 0 out of the required 1 times.
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 111.05 seconds ==========================
[msx] rc = 1
v1v1 running time = 132755171920
cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
16:01:38,980 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:01:45,417 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_schema_changes passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 57.84 seconds ===========================
[msx] rc = 0
v2v2 running time = 79528418846
---> v1v1 or v2v2 test failed.
v1v1 failed in a hypo test
proj: cassandra
u_test: pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
h_list: memtable_offheap_space_in_mb@@@CassandraDaemon@@@-2@@@64@@@123
vv_mode: v1v1
result: FAIL
failureMessage: 
stackTrace: 

cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
16:02:55,442 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:03:01,698 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
16:03:17,224 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
16:03:17,227 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
16:03:18,230 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 1.98 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused
16:03:18,231 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused

-------------------------------- live log call ---------------------------------
16:03:44,745 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:03:52,273 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_schema_changes failed (1 runs remaining out of 2).
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]
test_schema_changes passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 105.98 seconds ==========================
[msx] rc = 0
v1v2 running time = 127652896359
---> v1v2 test suceeded.
cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
16:05:04,24 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:05:11,342 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
16:05:28,874 cassandra.cluster ERROR Exception refreshing schema in response to schema change:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 4206, in cassandra.cluster.refresh_schema_and_set_result
  File "cassandra/cluster.py", line 3686, in cassandra.cluster.ControlConnection._refresh_schema
  File "cassandra/cluster.py", line 3935, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3975, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3963, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/connection.py", line 1041, in cassandra.connection.Connection.wait_for_responses
cassandra.connection.ConnectionShutdown: Connection <LibevConnection(140336720296592) 127.0.0.1:9042 (defunct)> is already closed
16:05:28,875 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
16:05:28,957 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 837, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 350, in handle_read
    buf = self._socket.recv(self.in_buffer_size)
ConnectionResetError: [Errno 104] Connection reset by peer
16:05:29,881 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 2.18 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused
16:05:29,982 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
16:05:31,887 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused

-------------------------------- live log call ---------------------------------
16:06:00,521 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:06:06,815 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_________________ TestPushedNotifications.test_schema_changes __________________

self = <pushed_notifications_test.TestPushedNotifications object at 0x7fa2afd73ef0>

    @since("3.0")
    def test_schema_changes(self):
        """
            @jira_ticket CASSANDRA-10328
            Creating, updating and dropping a keyspace, a table and a materialized view
            will generate the correct schema change notifications.
            """
        self.cluster.set_configuration_options({'enable_materialized_views': 'true'})
        self.cluster.populate(2).start()
        node1, node2 = self.cluster.nodelist()
    
        session = self.patient_cql_connection(node1)
        waiter = NotificationWaiter(self, node2, ["SCHEMA_CHANGE"], keyspace='ks')
    
        create_ks(session, 'ks', 3)
        session.execute("create TABLE t (k int PRIMARY KEY , v int)")
        session.execute("alter TABLE t add v1 int;")
    
        session.execute("create MATERIALIZED VIEW mv as select * from t WHERE v IS NOT NULL AND k IS NOT NULL PRIMARY KEY (v, k)")
        session.execute(" alter materialized view mv with min_index_interval = 100")
    
>       session.execute("drop MATERIALIZED VIEW mv")

pushed_notifications_test.py:341: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.OperationTimedOut: errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042

cassandra/cluster.py:4894: OperationTimedOut
---------------------------- Captured stdout setup -----------------------------
16:04:40,406 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
16:04:39,958 conftest INFO Starting execution of test_schema_changes at 2022-02-02 16:04:39.958169
16:04:40,315 dtest_setup INFO cluster ccm directory: /tmp/dtest-ybd1qhdw
------------------------------ Captured log call -------------------------------
16:04:41,422 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-ybd1qhdw/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-ybd1qhdw/test/node1/conf'}
16:04:41,423 ccm INFO node1: using Java 8 for the current invocation
16:04:41,594 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-ybd1qhdw/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-ybd1qhdw/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
16:04:41,595 ccm INFO node1: using Java 8 for the current invocation
16:04:41,681 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:04:41,969 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-ybd1qhdw/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-ybd1qhdw/test/node2/conf'}
16:04:41,969 ccm INFO node2: using Java 8 for the current invocation
16:04:42,139 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-ybd1qhdw/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-ybd1qhdw/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
16:04:42,139 ccm INFO node2: using Java 8 for the current invocation
16:04:42,230 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:05:03,470 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
16:05:03,665 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
16:05:04,24 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:05:11,342 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
16:05:32,99 ccm DEBUG Log-watching thread exiting.
---------------------------- Captured stdout setup -----------------------------
16:05:35,851 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
16:05:35,182 conftest INFO Starting execution of test_schema_changes at 2022-02-02 16:05:35.181983
16:05:35,743 dtest_setup INFO cluster ccm directory: /tmp/dtest-4yt1n7wa
------------------------------ Captured log call -------------------------------
16:05:36,868 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-4yt1n7wa/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-4yt1n7wa/test/node1/conf'}
16:05:36,869 ccm INFO node1: using Java 8 for the current invocation
16:05:37,48 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-4yt1n7wa/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-4yt1n7wa/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
16:05:37,49 ccm INFO node1: using Java 8 for the current invocation
16:05:37,138 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:05:37,409 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-4yt1n7wa/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-4yt1n7wa/test/node2/conf'}
16:05:37,410 ccm INFO node2: using Java 8 for the current invocation
16:05:37,595 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-4yt1n7wa/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-4yt1n7wa/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
16:05:37,595 ccm INFO node2: using Java 8 for the current invocation
16:05:37,687 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:05:59,963 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
16:06:00,169 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
16:06:00,521 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:06:06,815 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
16:05:32,99 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
16:05:32,99 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
16:06:22,19 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_schema_changes failed (1 runs remaining out of 2).
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]
test_schema_changes failed; it passed 0 out of the required 1 times.
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 102.72 seconds ==========================
[msx] rc = 1
v1v1 running time = 124374952481
cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
16:07:08,574 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:07:14,559 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
16:07:28,617 cassandra.cluster ERROR Exception refreshing schema in response to schema change:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 4206, in cassandra.cluster.refresh_schema_and_set_result
  File "cassandra/cluster.py", line 3686, in cassandra.cluster.ControlConnection._refresh_schema
  File "cassandra/cluster.py", line 3935, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3975, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3963, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/connection.py", line 1076, in cassandra.connection.Connection.wait_for_responses
  File "cassandra/connection.py", line 1071, in cassandra.connection.Connection.wait_for_responses
  File "cassandra/connection.py", line 1570, in cassandra.connection.ResponseWaiter.deliver
cassandra.connection.ConnectionShutdown: [Errno 104] Connection reset by peer
16:07:28,620 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
16:07:28,624 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
16:07:28,753 cassandra.cluster WARNING Host 127.0.0.2:9042 has been marked down
16:07:29,663 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
16:07:29,757 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.2:9042, scheduling retry in 2.04 seconds: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
16:07:29,762 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 1.82 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused

-------------------------------- live log call ---------------------------------
16:07:59,661 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:08:05,421 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_________________ TestPushedNotifications.test_schema_changes __________________

self = <pushed_notifications_test.TestPushedNotifications object at 0x7ff92f482860>

    @since("3.0")
    def test_schema_changes(self):
        """
            @jira_ticket CASSANDRA-10328
            Creating, updating and dropping a keyspace, a table and a materialized view
            will generate the correct schema change notifications.
            """
        self.cluster.set_configuration_options({'enable_materialized_views': 'true'})
        self.cluster.populate(2).start()
        node1, node2 = self.cluster.nodelist()
    
        session = self.patient_cql_connection(node1)
        waiter = NotificationWaiter(self, node2, ["SCHEMA_CHANGE"], keyspace='ks')
    
        create_ks(session, 'ks', 3)
        session.execute("create TABLE t (k int PRIMARY KEY , v int)")
        session.execute("alter TABLE t add v1 int;")
    
        session.execute("create MATERIALIZED VIEW mv as select * from t WHERE v IS NOT NULL AND k IS NOT NULL PRIMARY KEY (v, k)")
        session.execute(" alter materialized view mv with min_index_interval = 100")
    
>       session.execute("drop MATERIALIZED VIEW mv")

pushed_notifications_test.py:341: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.OperationTimedOut: errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042

cassandra/cluster.py:4894: OperationTimedOut
---------------------------- Captured stdout setup -----------------------------
16:06:44,974 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
16:06:44,323 conftest INFO Starting execution of test_schema_changes at 2022-02-02 16:06:44.323121
16:06:44,880 dtest_setup INFO cluster ccm directory: /tmp/dtest-o6qwdvtq
------------------------------ Captured log call -------------------------------
16:06:46,20 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o6qwdvtq/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o6qwdvtq/test/node1/conf'}
16:06:46,21 ccm INFO node1: using Java 8 for the current invocation
16:06:46,188 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o6qwdvtq/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o6qwdvtq/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
16:06:46,189 ccm INFO node1: using Java 8 for the current invocation
16:06:46,272 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:06:46,531 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o6qwdvtq/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o6qwdvtq/test/node2/conf'}
16:06:46,532 ccm INFO node2: using Java 8 for the current invocation
16:06:46,697 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-o6qwdvtq/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-o6qwdvtq/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
16:06:46,698 ccm INFO node2: using Java 8 for the current invocation
16:06:46,780 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:07:08,29 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
16:07:08,224 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
16:07:08,574 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:07:14,559 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
16:07:31,653 ccm DEBUG Log-watching thread exiting.
---------------------------- Captured stdout setup -----------------------------
16:07:35,926 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
16:07:34,912 conftest INFO Starting execution of test_schema_changes at 2022-02-02 16:07:34.912421
16:07:35,814 dtest_setup INFO cluster ccm directory: /tmp/dtest-8pd_wl1x
------------------------------ Captured log call -------------------------------
16:07:37,56 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-8pd_wl1x/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-8pd_wl1x/test/node1/conf'}
16:07:37,57 ccm INFO node1: using Java 8 for the current invocation
16:07:37,213 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-8pd_wl1x/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-8pd_wl1x/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
16:07:37,214 ccm INFO node1: using Java 8 for the current invocation
16:07:37,298 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:07:37,566 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-8pd_wl1x/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-8pd_wl1x/test/node2/conf'}
16:07:37,567 ccm INFO node2: using Java 8 for the current invocation
16:07:37,739 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-8pd_wl1x/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-8pd_wl1x/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
16:07:37,740 ccm INFO node2: using Java 8 for the current invocation
16:07:37,829 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:07:59,77 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
16:07:59,301 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
16:07:59,661 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:08:05,421 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
16:07:31,653 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
16:07:31,653 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
16:08:19,602 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_schema_changes failed (1 runs remaining out of 2).
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]
test_schema_changes failed; it passed 0 out of the required 1 times.
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 97.94 seconds ===========================
[msx] rc = 1
v2v2 running time = 119631259691
---> v1v1 or v2v2 test failed.
v1v1 failed in a hypo test
proj: cassandra
u_test: pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
h_list: memtable_offheap_space_in_mb@@@CassandraDaemon@@@-2@@@64@@@123
vv_mode: v1v1
result: FAIL
failureMessage: 
stackTrace: 

v2v2 failed in a hypo test
proj: cassandra
u_test: pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
h_list: memtable_offheap_space_in_mb@@@CassandraDaemon@@@-2@@@64@@@123
vv_mode: v2v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
16:09:08,556 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:09:15,200 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_schema_changes passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 59.73 seconds ===========================
[msx] rc = 0
v1v2 running time = 81417718606
---> v1v2 test suceeded.
cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
16:10:29,914 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:10:36,737 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
16:10:52,53 cassandra.cluster ERROR Exception refreshing schema in response to schema change:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 4206, in cassandra.cluster.refresh_schema_and_set_result
  File "cassandra/cluster.py", line 3686, in cassandra.cluster.ControlConnection._refresh_schema
  File "cassandra/cluster.py", line 3935, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3975, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3963, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/connection.py", line 1041, in cassandra.connection.Connection.wait_for_responses
cassandra.connection.ConnectionShutdown: Connection <LibevConnection(139847342890176) 127.0.0.1:9042 (defunct)> is already closed
16:10:52,55 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
16:10:52,128 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
16:10:53,132 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
16:10:53,133 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 1.82 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused

-------------------------------- live log call ---------------------------------
16:11:23,538 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:11:29,31 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_schema_changes failed (1 runs remaining out of 2).
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]
test_schema_changes passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 109.33 seconds ==========================
[msx] rc = 0
v1v1 running time = 131098161754
cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
16:12:40,58 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:12:50,114 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
16:13:04,471 cassandra.cluster ERROR Exception refreshing schema in response to schema change:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 4206, in cassandra.cluster.refresh_schema_and_set_result
  File "cassandra/cluster.py", line 3686, in cassandra.cluster.ControlConnection._refresh_schema
  File "cassandra/cluster.py", line 3935, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3975, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3963, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/connection.py", line 1041, in cassandra.connection.Connection.wait_for_responses
cassandra.connection.ConnectionShutdown: Connection <LibevConnection(139845894917200) 127.0.0.1:9042 (defunct)> is already closed
16:13:04,472 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
16:13:04,716 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 837, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 350, in handle_read
    buf = self._socket.recv(self.in_buffer_size)
ConnectionResetError: [Errno 104] Connection reset by peer
16:13:05,727 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 2.0 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused
16:13:05,827 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused

-------------------------------- live log call ---------------------------------
16:13:36,806 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:13:43,58 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_________________ TestPushedNotifications.test_schema_changes __________________

self = <pushed_notifications_test.TestPushedNotifications object at 0x7f30685e2940>

    @since("3.0")
    def test_schema_changes(self):
        """
            @jira_ticket CASSANDRA-10328
            Creating, updating and dropping a keyspace, a table and a materialized view
            will generate the correct schema change notifications.
            """
        self.cluster.set_configuration_options({'enable_materialized_views': 'true'})
        self.cluster.populate(2).start()
        node1, node2 = self.cluster.nodelist()
    
        session = self.patient_cql_connection(node1)
        waiter = NotificationWaiter(self, node2, ["SCHEMA_CHANGE"], keyspace='ks')
    
        create_ks(session, 'ks', 3)
        session.execute("create TABLE t (k int PRIMARY KEY , v int)")
        session.execute("alter TABLE t add v1 int;")
    
        session.execute("create MATERIALIZED VIEW mv as select * from t WHERE v IS NOT NULL AND k IS NOT NULL PRIMARY KEY (v, k)")
        session.execute(" alter materialized view mv with min_index_interval = 100")
    
>       session.execute("drop MATERIALIZED VIEW mv")

pushed_notifications_test.py:341: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.OperationTimedOut: errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042

cassandra/cluster.py:4894: OperationTimedOut
---------------------------- Captured stdout setup -----------------------------
16:12:17,279 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
16:12:16,526 conftest INFO Starting execution of test_schema_changes at 2022-02-02 16:12:16.526760
16:12:17,186 dtest_setup INFO cluster ccm directory: /tmp/dtest-kiin2iom
------------------------------ Captured log call -------------------------------
16:12:18,193 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-kiin2iom/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-kiin2iom/test/node1/conf'}
16:12:18,194 ccm INFO node1: using Java 8 for the current invocation
16:12:18,363 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-kiin2iom/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-kiin2iom/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
16:12:18,364 ccm INFO node1: using Java 8 for the current invocation
16:12:18,449 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:12:18,708 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-kiin2iom/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-kiin2iom/test/node2/conf'}
16:12:18,709 ccm INFO node2: using Java 8 for the current invocation
16:12:18,880 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-kiin2iom/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-kiin2iom/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
16:12:18,881 ccm INFO node2: using Java 8 for the current invocation
16:12:18,958 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:12:39,200 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
16:12:39,412 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
16:12:40,58 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:12:50,114 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
16:13:07,786 ccm DEBUG Log-watching thread exiting.
---------------------------- Captured stdout setup -----------------------------
16:13:11,998 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
16:13:11,55 conftest INFO Starting execution of test_schema_changes at 2022-02-02 16:13:11.055092
16:13:11,867 dtest_setup INFO cluster ccm directory: /tmp/dtest-co2s9r6r
------------------------------ Captured log call -------------------------------
16:13:13,206 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-co2s9r6r/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-co2s9r6r/test/node1/conf'}
16:13:13,207 ccm INFO node1: using Java 8 for the current invocation
16:13:13,380 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-co2s9r6r/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-co2s9r6r/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
16:13:13,381 ccm INFO node1: using Java 8 for the current invocation
16:13:13,474 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:13:13,753 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-co2s9r6r/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-co2s9r6r/test/node2/conf'}
16:13:13,754 ccm INFO node2: using Java 8 for the current invocation
16:13:13,931 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-co2s9r6r/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-co2s9r6r/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
16:13:13,932 ccm INFO node2: using Java 8 for the current invocation
16:13:14,12 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:13:36,262 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
16:13:36,475 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
16:13:36,806 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:13:43,58 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
16:13:07,786 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
16:13:07,786 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
16:13:57,184 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_schema_changes failed (1 runs remaining out of 2).
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]
test_schema_changes failed; it passed 0 out of the required 1 times.
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 101.32 seconds ==========================
[msx] rc = 1
v2v2 running time = 122990333762
---> v1v1 or v2v2 test failed.
v2v2 failed in a hypo test
proj: cassandra
u_test: pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
h_list: memtable_offheap_space_in_mb@@@CassandraDaemon@@@-2@@@64@@@123
vv_mode: v2v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
16:14:43,892 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:14:50,812 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
16:15:05,735 cassandra.cluster ERROR Exception refreshing schema in response to schema change:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 4206, in cassandra.cluster.refresh_schema_and_set_result
  File "cassandra/cluster.py", line 3686, in cassandra.cluster.ControlConnection._refresh_schema
  File "cassandra/cluster.py", line 3935, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3975, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3963, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/connection.py", line 1076, in cassandra.connection.Connection.wait_for_responses
  File "cassandra/connection.py", line 1071, in cassandra.connection.Connection.wait_for_responses
  File "cassandra/connection.py", line 1570, in cassandra.connection.ResponseWaiter.deliver
cassandra.connection.ConnectionShutdown: [Errno 104] Connection reset by peer
16:15:05,811 cassandra.cluster WARNING Host 127.0.0.2:9042 has been marked down
16:15:06,816 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.2:9042, scheduling retry in 1.78 seconds: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
16:15:08,620 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.2:9042, scheduling retry in 3.52 seconds: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused

-------------------------------- live log call ---------------------------------
16:15:36,213 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:15:42,675 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_________________ TestPushedNotifications.test_schema_changes __________________

self = <pushed_notifications_test.TestPushedNotifications object at 0x7f97f6b7ae10>

    @since("3.0")
    def test_schema_changes(self):
        """
            @jira_ticket CASSANDRA-10328
            Creating, updating and dropping a keyspace, a table and a materialized view
            will generate the correct schema change notifications.
            """
        self.cluster.set_configuration_options({'enable_materialized_views': 'true'})
        self.cluster.populate(2).start()
        node1, node2 = self.cluster.nodelist()
    
        session = self.patient_cql_connection(node1)
        waiter = NotificationWaiter(self, node2, ["SCHEMA_CHANGE"], keyspace='ks')
    
        create_ks(session, 'ks', 3)
        session.execute("create TABLE t (k int PRIMARY KEY , v int)")
        session.execute("alter TABLE t add v1 int;")
    
        session.execute("create MATERIALIZED VIEW mv as select * from t WHERE v IS NOT NULL AND k IS NOT NULL PRIMARY KEY (v, k)")
        session.execute(" alter materialized view mv with min_index_interval = 100")
    
>       session.execute("drop MATERIALIZED VIEW mv")

pushed_notifications_test.py:341: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.OperationTimedOut: errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042

cassandra/cluster.py:4894: OperationTimedOut
---------------------------- Captured stdout setup -----------------------------
16:14:20,343 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
16:14:19,412 conftest INFO Starting execution of test_schema_changes at 2022-02-02 16:14:19.412221
16:14:20,221 dtest_setup INFO cluster ccm directory: /tmp/dtest-mnc5ovy_
------------------------------ Captured log call -------------------------------
16:14:21,316 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-mnc5ovy_/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-mnc5ovy_/test/node1/conf'}
16:14:21,316 ccm INFO node1: using Java 8 for the current invocation
16:14:21,493 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-mnc5ovy_/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-mnc5ovy_/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
16:14:21,494 ccm INFO node1: using Java 8 for the current invocation
16:14:21,587 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:14:21,838 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-mnc5ovy_/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-mnc5ovy_/test/node2/conf'}
16:14:21,839 ccm INFO node2: using Java 8 for the current invocation
16:14:22,8 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-mnc5ovy_/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-mnc5ovy_/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
16:14:22,9 ccm INFO node2: using Java 8 for the current invocation
16:14:22,99 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:14:43,343 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
16:14:43,540 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
16:14:43,892 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:14:50,812 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
16:15:08,771 ccm DEBUG Log-watching thread exiting.
---------------------------- Captured stdout setup -----------------------------
16:15:12,579 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
16:15:11,815 conftest INFO Starting execution of test_schema_changes at 2022-02-02 16:15:11.815000
16:15:12,477 dtest_setup INFO cluster ccm directory: /tmp/dtest-wi9w9rhx
------------------------------ Captured log call -------------------------------
16:15:13,549 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-wi9w9rhx/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-wi9w9rhx/test/node1/conf'}
16:15:13,550 ccm INFO node1: using Java 8 for the current invocation
16:15:13,722 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-wi9w9rhx/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-wi9w9rhx/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
16:15:13,723 ccm INFO node1: using Java 8 for the current invocation
16:15:13,808 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:15:14,88 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-wi9w9rhx/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-wi9w9rhx/test/node2/conf'}
16:15:14,89 ccm INFO node2: using Java 8 for the current invocation
16:15:14,262 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-wi9w9rhx/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-wi9w9rhx/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
16:15:14,263 ccm INFO node2: using Java 8 for the current invocation
16:15:14,348 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:15:35,592 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
16:15:35,818 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
16:15:36,213 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:15:42,675 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
16:15:08,771 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
16:15:08,771 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
16:15:59,13 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_schema_changes failed (1 runs remaining out of 2).
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]
test_schema_changes failed; it passed 0 out of the required 1 times.
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 100.26 seconds ==========================
[msx] rc = 1
v1v2 running time = 121848694970
---> v1v2 test failed.
proj: cassandra
u_test: pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
h_list: memtable_offheap_space_in_mb@@@CassandraDaemon@@@-2@@@64@@@123
vv_mode: v1v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
16:16:46,147 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:16:53,16 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
16:17:07,110 cassandra.cluster WARNING Host 127.0.0.2:9042 has been marked down
16:17:07,124 cassandra.cluster ERROR Exception refreshing schema in response to schema change:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 4206, in cassandra.cluster.refresh_schema_and_set_result
  File "cassandra/cluster.py", line 3686, in cassandra.cluster.ControlConnection._refresh_schema
  File "cassandra/cluster.py", line 3935, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3975, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3963, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/connection.py", line 1041, in cassandra.connection.Connection.wait_for_responses
cassandra.connection.ConnectionShutdown: Connection <LibevConnection(140118855459168) 127.0.0.2:9042 (defunct)> is already closed
16:17:07,126 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
16:17:07,128 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
16:17:08,126 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.2:9042, scheduling retry in 2.3 seconds: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
16:17:08,131 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 1.98 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused
16:17:08,231 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused

-------------------------------- live log call ---------------------------------
16:17:41,517 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:17:48,576 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_________________ TestPushedNotifications.test_schema_changes __________________

self = <pushed_notifications_test.TestPushedNotifications object at 0x7f6ff69a6a90>

    @since("3.0")
    def test_schema_changes(self):
        """
            @jira_ticket CASSANDRA-10328
            Creating, updating and dropping a keyspace, a table and a materialized view
            will generate the correct schema change notifications.
            """
        self.cluster.set_configuration_options({'enable_materialized_views': 'true'})
        self.cluster.populate(2).start()
        node1, node2 = self.cluster.nodelist()
    
        session = self.patient_cql_connection(node1)
        waiter = NotificationWaiter(self, node2, ["SCHEMA_CHANGE"], keyspace='ks')
    
        create_ks(session, 'ks', 3)
        session.execute("create TABLE t (k int PRIMARY KEY , v int)")
        session.execute("alter TABLE t add v1 int;")
    
        session.execute("create MATERIALIZED VIEW mv as select * from t WHERE v IS NOT NULL AND k IS NOT NULL PRIMARY KEY (v, k)")
        session.execute(" alter materialized view mv with min_index_interval = 100")
    
>       session.execute("drop MATERIALIZED VIEW mv")

pushed_notifications_test.py:341: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.OperationTimedOut: errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042

cassandra/cluster.py:4894: OperationTimedOut
---------------------------- Captured stdout setup -----------------------------
16:16:22,536 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
16:16:21,334 conftest INFO Starting execution of test_schema_changes at 2022-02-02 16:16:21.334631
16:16:22,444 dtest_setup INFO cluster ccm directory: /tmp/dtest-dizppgvq
------------------------------ Captured log call -------------------------------
16:16:23,520 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-dizppgvq/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-dizppgvq/test/node1/conf'}
16:16:23,521 ccm INFO node1: using Java 8 for the current invocation
16:16:23,691 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-dizppgvq/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-dizppgvq/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
16:16:23,691 ccm INFO node1: using Java 8 for the current invocation
16:16:23,775 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:16:24,43 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-dizppgvq/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-dizppgvq/test/node2/conf'}
16:16:24,44 ccm INFO node2: using Java 8 for the current invocation
16:16:24,217 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-dizppgvq/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-dizppgvq/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
16:16:24,218 ccm INFO node2: using Java 8 for the current invocation
16:16:24,296 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:16:45,553 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
16:16:45,772 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
16:16:46,147 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:16:53,16 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
16:17:10,233 ccm DEBUG Log-watching thread exiting.
---------------------------- Captured stdout setup -----------------------------
16:17:14,671 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
16:17:13,575 conftest INFO Starting execution of test_schema_changes at 2022-02-02 16:17:13.575218
16:17:14,534 dtest_setup INFO cluster ccm directory: /tmp/dtest-2g6ultsy
------------------------------ Captured log call -------------------------------
16:17:15,913 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-2g6ultsy/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-2g6ultsy/test/node1/conf'}
16:17:15,914 ccm INFO node1: using Java 8 for the current invocation
16:17:16,102 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-2g6ultsy/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-2g6ultsy/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
16:17:16,103 ccm INFO node1: using Java 8 for the current invocation
16:17:16,194 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:17:16,476 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-2g6ultsy/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-2g6ultsy/test/node2/conf'}
16:17:16,479 ccm INFO node2: using Java 8 for the current invocation
16:17:16,651 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-2g6ultsy/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-2g6ultsy/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
16:17:16,652 ccm INFO node2: using Java 8 for the current invocation
16:17:16,739 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:17:41,1 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
16:17:41,206 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
16:17:41,517 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:17:48,576 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
16:17:10,233 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
16:17:10,233 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
16:18:03,657 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_schema_changes failed (1 runs remaining out of 2).
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]
test_schema_changes failed; it passed 0 out of the required 1 times.
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 102.97 seconds ==========================
[msx] rc = 1
v1v1 running time = 124697347925
cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
16:18:51,856 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:18:58,835 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
16:19:14,772 cassandra.cluster ERROR Exception refreshing schema in response to schema change:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 4206, in cassandra.cluster.refresh_schema_and_set_result
  File "cassandra/cluster.py", line 3686, in cassandra.cluster.ControlConnection._refresh_schema
  File "cassandra/cluster.py", line 3935, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3975, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3963, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/connection.py", line 1076, in cassandra.connection.Connection.wait_for_responses
  File "cassandra/connection.py", line 1071, in cassandra.connection.Connection.wait_for_responses
  File "cassandra/connection.py", line 1570, in cassandra.connection.ResponseWaiter.deliver
cassandra.connection.ConnectionShutdown: [Errno 104] Connection reset by peer
16:19:14,774 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
16:19:14,783 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 837, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 350, in handle_read
    buf = self._socket.recv(self.in_buffer_size)
ConnectionResetError: [Errno 104] Connection reset by peer
16:19:15,783 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 2.2 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused
16:19:15,883 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused

-------------------------------- live log call ---------------------------------
16:19:44,652 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:19:55,703 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_________________ TestPushedNotifications.test_schema_changes __________________

self = <pushed_notifications_test.TestPushedNotifications object at 0x7f3fe6bb3dd8>

    @since("3.0")
    def test_schema_changes(self):
        """
            @jira_ticket CASSANDRA-10328
            Creating, updating and dropping a keyspace, a table and a materialized view
            will generate the correct schema change notifications.
            """
        self.cluster.set_configuration_options({'enable_materialized_views': 'true'})
        self.cluster.populate(2).start()
        node1, node2 = self.cluster.nodelist()
    
        session = self.patient_cql_connection(node1)
        waiter = NotificationWaiter(self, node2, ["SCHEMA_CHANGE"], keyspace='ks')
    
        create_ks(session, 'ks', 3)
        session.execute("create TABLE t (k int PRIMARY KEY , v int)")
        session.execute("alter TABLE t add v1 int;")
    
        session.execute("create MATERIALIZED VIEW mv as select * from t WHERE v IS NOT NULL AND k IS NOT NULL PRIMARY KEY (v, k)")
        session.execute(" alter materialized view mv with min_index_interval = 100")
    
>       session.execute("drop MATERIALIZED VIEW mv")

pushed_notifications_test.py:341: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.OperationTimedOut: errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042

cassandra/cluster.py:4894: OperationTimedOut
---------------------------- Captured stdout setup -----------------------------
16:18:26,997 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
16:18:26,76 conftest INFO Starting execution of test_schema_changes at 2022-02-02 16:18:26.076578
16:18:26,886 dtest_setup INFO cluster ccm directory: /tmp/dtest-f7gaem8j
------------------------------ Captured log call -------------------------------
16:18:28,22 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-f7gaem8j/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-f7gaem8j/test/node1/conf'}
16:18:28,31 ccm INFO node1: using Java 8 for the current invocation
16:18:28,199 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-f7gaem8j/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-f7gaem8j/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
16:18:28,200 ccm INFO node1: using Java 8 for the current invocation
16:18:28,290 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:18:28,582 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-f7gaem8j/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-f7gaem8j/test/node2/conf'}
16:18:28,583 ccm INFO node2: using Java 8 for the current invocation
16:18:28,751 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-f7gaem8j/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-f7gaem8j/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
16:18:28,752 ccm INFO node2: using Java 8 for the current invocation
16:18:28,837 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:18:51,95 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
16:18:51,293 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
16:18:51,856 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:18:58,835 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
16:19:17,443 ccm DEBUG Log-watching thread exiting.
---------------------------- Captured stdout setup -----------------------------
16:19:20,744 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
16:19:20,233 conftest INFO Starting execution of test_schema_changes at 2022-02-02 16:19:20.233310
16:19:20,643 dtest_setup INFO cluster ccm directory: /tmp/dtest-g0lzjw10
------------------------------ Captured log call -------------------------------
16:19:21,715 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-g0lzjw10/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-g0lzjw10/test/node1/conf'}
16:19:21,716 ccm INFO node1: using Java 8 for the current invocation
16:19:21,889 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-g0lzjw10/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-g0lzjw10/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
16:19:21,890 ccm INFO node1: using Java 8 for the current invocation
16:19:21,970 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:19:22,227 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-g0lzjw10/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-g0lzjw10/test/node2/conf'}
16:19:22,228 ccm INFO node2: using Java 8 for the current invocation
16:19:22,396 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-g0lzjw10/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-g0lzjw10/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
16:19:22,396 ccm INFO node2: using Java 8 for the current invocation
16:19:22,481 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:19:43,728 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
16:19:43,930 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
16:19:44,652 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:19:55,703 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
16:19:17,443 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
16:19:17,443 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
16:20:10,923 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_schema_changes failed (1 runs remaining out of 2).
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]
test_schema_changes failed; it passed 0 out of the required 1 times.
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 105.55 seconds ==========================
[msx] rc = 1
v2v2 running time = 127228721743
---> v1v1 or v2v2 test failed.
v1v1 failed in a hypo test
proj: cassandra
u_test: pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
h_list: memtable_offheap_space_in_mb@@@CassandraDaemon@@@-2@@@64@@@123
vv_mode: v1v1
result: FAIL
failureMessage: 
stackTrace: 

v2v2 failed in a hypo test
proj: cassandra
u_test: pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
h_list: memtable_offheap_space_in_mb@@@CassandraDaemon@@@-2@@@64@@@123
vv_mode: v2v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
16:20:59,74 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:21:08,404 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
16:21:23,307 cassandra.cluster ERROR Exception refreshing schema in response to schema change:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 4206, in cassandra.cluster.refresh_schema_and_set_result
  File "cassandra/cluster.py", line 3686, in cassandra.cluster.ControlConnection._refresh_schema
  File "cassandra/cluster.py", line 3935, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3975, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3963, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/connection.py", line 1041, in cassandra.connection.Connection.wait_for_responses
cassandra.connection.ConnectionShutdown: Connection <LibevConnection(139721583958840) 127.0.0.1:9042 (defunct)> is already closed
16:21:23,308 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
16:21:23,314 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
16:21:24,319 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 1.7 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused
16:21:24,319 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused

-------------------------------- live log call ---------------------------------
16:21:54,256 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:22:00,627 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_________________ TestPushedNotifications.test_schema_changes __________________

self = <pushed_notifications_test.TestPushedNotifications object at 0x7f1376db0f28>

    @since("3.0")
    def test_schema_changes(self):
        """
            @jira_ticket CASSANDRA-10328
            Creating, updating and dropping a keyspace, a table and a materialized view
            will generate the correct schema change notifications.
            """
        self.cluster.set_configuration_options({'enable_materialized_views': 'true'})
        self.cluster.populate(2).start()
        node1, node2 = self.cluster.nodelist()
    
        session = self.patient_cql_connection(node1)
        waiter = NotificationWaiter(self, node2, ["SCHEMA_CHANGE"], keyspace='ks')
    
        create_ks(session, 'ks', 3)
        session.execute("create TABLE t (k int PRIMARY KEY , v int)")
        session.execute("alter TABLE t add v1 int;")
    
        session.execute("create MATERIALIZED VIEW mv as select * from t WHERE v IS NOT NULL AND k IS NOT NULL PRIMARY KEY (v, k)")
        session.execute(" alter materialized view mv with min_index_interval = 100")
    
>       session.execute("drop MATERIALIZED VIEW mv")

pushed_notifications_test.py:341: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.OperationTimedOut: errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042

cassandra/cluster.py:4894: OperationTimedOut
---------------------------- Captured stdout setup -----------------------------
16:20:34,379 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
16:20:33,328 conftest INFO Starting execution of test_schema_changes at 2022-02-02 16:20:33.328743
16:20:34,285 dtest_setup INFO cluster ccm directory: /tmp/dtest-t4k1phag
------------------------------ Captured log call -------------------------------
16:20:35,476 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-t4k1phag/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-t4k1phag/test/node1/conf'}
16:20:35,476 ccm INFO node1: using Java 8 for the current invocation
16:20:35,633 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-t4k1phag/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-t4k1phag/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
16:20:35,634 ccm INFO node1: using Java 8 for the current invocation
16:20:35,724 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:20:35,981 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-t4k1phag/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-t4k1phag/test/node2/conf'}
16:20:35,982 ccm INFO node2: using Java 8 for the current invocation
16:20:36,156 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-t4k1phag/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-t4k1phag/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
16:20:36,156 ccm INFO node2: using Java 8 for the current invocation
16:20:36,241 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:20:58,485 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
16:20:58,700 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
16:20:59,74 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:21:08,404 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
16:21:26,70 ccm DEBUG Log-watching thread exiting.
---------------------------- Captured stdout setup -----------------------------
16:21:29,383 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
16:21:29,19 conftest INFO Starting execution of test_schema_changes at 2022-02-02 16:21:29.019525
16:21:29,279 dtest_setup INFO cluster ccm directory: /tmp/dtest-x6xadusu
------------------------------ Captured log call -------------------------------
16:21:30,408 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-x6xadusu/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-x6xadusu/test/node1/conf'}
16:21:30,409 ccm INFO node1: using Java 8 for the current invocation
16:21:30,579 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-x6xadusu/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-x6xadusu/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
16:21:30,580 ccm INFO node1: using Java 8 for the current invocation
16:21:30,664 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:21:30,934 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-x6xadusu/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-x6xadusu/test/node2/conf'}
16:21:30,935 ccm INFO node2: using Java 8 for the current invocation
16:21:31,114 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-x6xadusu/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-x6xadusu/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
16:21:31,114 ccm INFO node2: using Java 8 for the current invocation
16:21:31,194 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:21:53,457 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
16:21:53,710 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
16:21:54,256 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:22:00,627 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
16:21:26,70 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
16:21:26,70 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
16:22:15,564 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_schema_changes failed (1 runs remaining out of 2).
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]
test_schema_changes failed; it passed 0 out of the required 1 times.
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 104.94 seconds ==========================
[msx] rc = 1
v1v2 running time = 126641189215
---> v1v2 test failed.
proj: cassandra
u_test: pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
h_list: memtable_offheap_space_in_mb@@@CassandraDaemon@@@-2@@@64@@@123
vv_mode: v1v2
result: FAIL
failureMessage: 
stackTrace: 

cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
16:23:09,377 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:23:16,204 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
PASSED                                                                   [100%]
===Flaky Test Report===

test_schema_changes passed 1 out of the required 1 times. Success!

===End Flaky Test Report===

========================== 1 passed in 63.31 seconds ===========================
[msx] rc = 0
v1v1 running time = 85069906794
cassandra pushed_notifications_test.py::TestPushedNotifications::test_schema_changes false false
log_dst_dir = /root/vm_images/ZebraConf/app_meta/logs
the_test is pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /root/dtest/bin/python
cachedir: .pytest_cache
rootdir: /root/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 1200.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

pushed_notifications_test.py::TestPushedNotifications::test_schema_changes 
-------------------------------- live log call ---------------------------------
16:24:29,325 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:24:35,26 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
16:24:50,656 cassandra.cluster WARNING Host 127.0.0.2:9042 has been marked down
16:24:50,687 cassandra.cluster ERROR Exception refreshing schema in response to schema change:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 4206, in cassandra.cluster.refresh_schema_and_set_result
  File "cassandra/cluster.py", line 3686, in cassandra.cluster.ControlConnection._refresh_schema
  File "cassandra/cluster.py", line 3935, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3975, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/cluster.py", line 3963, in cassandra.cluster.ControlConnection.wait_for_schema_agreement
  File "cassandra/connection.py", line 1041, in cassandra.connection.Connection.wait_for_responses
cassandra.connection.ConnectionShutdown: Connection <LibevConnection(139981583379648) 127.0.0.2:9042 (defunct)> is already closed
16:24:50,719 cassandra.cluster WARNING Host 127.0.0.1:9042 has been marked down
16:24:50,721 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
16:24:51,725 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.1:9042, scheduling retry in 2.0 seconds: [Errno 111] Tried connecting to [('127.0.0.1', 9042)]. Last error: Connection refused
16:24:51,725 cassandra.cluster WARNING [control connection] Error connecting to 127.0.0.2:9042:
Traceback (most recent call last):
  File "cassandra/cluster.py", line 3522, in cassandra.cluster.ControlConnection._reconnect_internal
  File "cassandra/cluster.py", line 3544, in cassandra.cluster.ControlConnection._try_connect
  File "cassandra/cluster.py", line 1620, in cassandra.cluster.Cluster.connection_factory
  File "cassandra/connection.py", line 831, in cassandra.connection.Connection.factory
  File "/root/dtest/src/cassandra-driver/cassandra/io/libevreactor.py", line 267, in __init__
    self._connect_socket()
  File "cassandra/connection.py", line 898, in cassandra.connection.Connection._connect_socket
ConnectionRefusedError: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused
16:24:51,921 cassandra.pool WARNING Error attempting to reconnect to 127.0.0.2:9042, scheduling retry in 2.26 seconds: [Errno 111] Tried connecting to [('127.0.0.2', 9042)]. Last error: Connection refused

-------------------------------- live log call ---------------------------------
16:25:21,168 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:25:30,112 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
FAILED                                                                   [100%]

=================================== FAILURES ===================================
_________________ TestPushedNotifications.test_schema_changes __________________

self = <pushed_notifications_test.TestPushedNotifications object at 0x7f500007ee48>

    @since("3.0")
    def test_schema_changes(self):
        """
            @jira_ticket CASSANDRA-10328
            Creating, updating and dropping a keyspace, a table and a materialized view
            will generate the correct schema change notifications.
            """
        self.cluster.set_configuration_options({'enable_materialized_views': 'true'})
        self.cluster.populate(2).start()
        node1, node2 = self.cluster.nodelist()
    
        session = self.patient_cql_connection(node1)
        waiter = NotificationWaiter(self, node2, ["SCHEMA_CHANGE"], keyspace='ks')
    
        create_ks(session, 'ks', 3)
        session.execute("create TABLE t (k int PRIMARY KEY , v int)")
        session.execute("alter TABLE t add v1 int;")
    
        session.execute("create MATERIALIZED VIEW mv as select * from t WHERE v IS NOT NULL AND k IS NOT NULL PRIMARY KEY (v, k)")
        session.execute(" alter materialized view mv with min_index_interval = 100")
    
>       session.execute("drop MATERIALIZED VIEW mv")

pushed_notifications_test.py:341: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
cassandra/cluster.py:2618: in cassandra.cluster.Session.execute
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

>   ???
E   cassandra.OperationTimedOut: errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042

cassandra/cluster.py:4894: OperationTimedOut
---------------------------- Captured stdout setup -----------------------------
16:24:05,668 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
16:24:05,14 conftest INFO Starting execution of test_schema_changes at 2022-02-02 16:24:05.014423
16:24:05,573 dtest_setup INFO cluster ccm directory: /tmp/dtest-t6rt9_rq
------------------------------ Captured log call -------------------------------
16:24:06,582 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-t6rt9_rq/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-t6rt9_rq/test/node1/conf'}
16:24:06,582 ccm INFO node1: using Java 8 for the current invocation
16:24:06,752 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-t6rt9_rq/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-t6rt9_rq/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
16:24:06,753 ccm INFO node1: using Java 8 for the current invocation
16:24:06,838 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:24:07,98 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-t6rt9_rq/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-t6rt9_rq/test/node2/conf'}
16:24:07,99 ccm INFO node2: using Java 8 for the current invocation
16:24:07,270 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-t6rt9_rq/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-t6rt9_rq/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
16:24:07,271 ccm INFO node2: using Java 8 for the current invocation
16:24:07,352 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:24:28,586 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
16:24:28,782 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
16:24:29,325 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:24:35,26 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
16:24:53,769 ccm DEBUG Log-watching thread exiting.
---------------------------- Captured stdout setup -----------------------------
16:24:57,346 ccm DEBUG Log-watching thread starting.
---------------------------- Captured stderr setup -----------------------------
swapoff: Not superuser.
------------------------------ Captured log setup ------------------------------
16:24:56,614 conftest INFO Starting execution of test_schema_changes at 2022-02-02 16:24:56.614611
16:24:57,225 dtest_setup INFO cluster ccm directory: /tmp/dtest-122kv1l2
------------------------------ Captured log call -------------------------------
16:24:58,470 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-122kv1l2/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-122kv1l2/test/node1/conf'}
16:24:58,471 ccm INFO node1: using Java 8 for the current invocation
16:24:58,643 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-122kv1l2/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-122kv1l2/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4'}
16:24:58,644 ccm INFO node1: using Java 8 for the current invocation
16:24:58,729 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:24:59,0 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-122kv1l2/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-122kv1l2/test/node2/conf'}
16:24:59,1 ccm INFO node2: using Java 8 for the current invocation
16:24:59,170 ccm INFO node2: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/root/cassandra, env={'HOSTNAME': '6a0960e5ce72', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'PWD': '/root/cassandra-dtest', 'HOME': '/root', 'SHLVL': '4', 'ZEBRACONF_HOME': '/root/vm_images/ZebraConf', 'PATH': '/root/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin', '_': '/root/dtest/bin/pytest', 'OLDPWD': '/', 'PYTEST_CURRENT_TEST': 'pushed_notifications_test.py::TestPushedNotifications::()::test_schema_changes (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-122kv1l2/test/node2/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/root/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-122kv1l2/test/node2/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=4 -Dcassandra.migration_task_wait_in_seconds=4'}
16:24:59,171 ccm INFO node2: using Java 8 for the current invocation
16:24:59,254 ccm INFO Starting node2 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/root/cassandra
16:25:20,500 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.2:9042 datacenter1> discovered
16:25:20,710 cassandra.cluster INFO New Cassandra host <Host: 127.0.0.1:9042 datacenter1> discovered
16:25:21,168 cassandra.protocol WARNING Server warning: Your replication factor 3 for keyspace ks is higher than the number of nodes 2
16:25:30,112 cassandra.protocol WARNING Server warning: Materialized views are experimental and are not recommended for production use.
--------------------------- Captured stdout teardown ---------------------------
16:24:53,769 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
16:24:53,769 ccm DEBUG Log-watching thread exiting.
--------------------------- Captured stdout teardown ---------------------------
16:25:46,289 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_schema_changes failed (1 runs remaining out of 2).
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]
test_schema_changes failed; it passed 0 out of the required 1 times.
	<class 'cassandra.OperationTimedOut'>
	errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.2:9042
	[<TracebackEntry /root/cassandra-dtest/pushed_notifications_test.py:341>, <TracebackEntry cassandra/cluster.py:2618>, <TracebackEntry cassandra/cluster.py:4894>]

===End Flaky Test Report===
========================== 1 failed in 101.93 seconds ==========================
[msx] rc = 1
v2v2 running time = 123628135221
---> v1v1 or v2v2 test failed.
v2v2 failed in a hypo test
proj: cassandra
u_test: pushed_notifications_test.py::TestPushedNotifications::test_schema_changes
h_list: memtable_offheap_space_in_mb@@@CassandraDaemon@@@-2@@@64@@@123
vv_mode: v2v2
result: FAIL
failureMessage: 
stackTrace: 

early stop after 7 is satisfied
v1v2 failed with probability 5 out of 9
v1v1v2v2 failed with probability 7 out of 9
Total execution time in seconds : 3106
0
