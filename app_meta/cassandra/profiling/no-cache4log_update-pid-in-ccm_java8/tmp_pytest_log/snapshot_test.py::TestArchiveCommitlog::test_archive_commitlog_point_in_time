cassandra snapshot_test.py::TestArchiveCommitlog::test_archive_commitlog_point_in_time true true
log_dts_dir = /users/masix/vm_images/ZebraConf/app_meta/logs
the_test is snapshot_test.py::TestArchiveCommitlog::test_archive_commitlog_point_in_time
rm: cannot remove '/tmp/my_log.txt': No such file or directory
============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-3.6.4, py-1.11.0, pluggy-0.7.1 -- /users/masix/dtest/bin/python
cachedir: .pytest_cache
rootdir: /users/masix/cassandra-dtest, inifile: pytest.ini
plugins: flaky-3.7.0, timeout-1.4.2, repeat-0.9.1
timeout: 900.0s
timeout method: signal
timeout func_only: False
collecting ... collected 1 item

snapshot_test.py::TestArchiveCommitlog::test_archive_commitlog_point_in_time 
-------------------------------- live log call ---------------------------------
18:41:50,104 ccmlib.node WARNING [msx] ccmlib:node.py:start(), self.name= node1, self.pid= 19993
18:41:50,105 ccmlib.cluster WARNING [msx] ccmlib:cluster.py:start() p.pid= 19897 node.name= node1 node.pid= 19993
FAILED                                                                   [100%]

=================================== FAILURES ===================================
__________ TestArchiveCommitlog.test_archive_commitlog_point_in_time ___________

self = <snapshot_test.TestArchiveCommitlog object at 0x7f9bda54b470>

    def test_archive_commitlog_point_in_time(self):
        """
            Test archive commit log with restore_point_in_time setting
            """
>       self.run_archive_commitlog(restore_point_in_time=True)

snapshot_test.py:259: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
snapshot_test.py:302: in run_archive_commitlog
    commitlog_dir=os.path.join(node1.get_path(), 'commitlogs')
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

session = <cassandra.cluster.Session object at 0x7f9bd9a7f048>
commitlog_dir = '/tmp/dtest-oqjvmef2/test/node1/commitlogs'
keyspace_name = 'ks', table_name = 'junk_table', timeout = 120

    def advance_to_next_cl_segment(session, commitlog_dir,
                                   keyspace_name='ks', table_name='junk_table',
                                   timeout=120):
        """
        This is a hack to work around problems like CASSANDRA-11811.
    
        The problem happens in commitlog-replaying tests, like the snapshot and CDC
        tests. If we replay the first commitlog that's created, we wind up
        replaying some mutations that initialize system tables, so this function
        advances the node to the next CL by filling up the first one.
        """
        session.execute(
            'CREATE TABLE {ks}.{tab} ('
            'a uuid PRIMARY KEY, b uuid, c uuid, d uuid, '
            'e uuid, f uuid, g uuid, h uuid'
            ')'.format(ks=keyspace_name, tab=table_name)
        )
        prepared_insert = session.prepare(
            'INSERT INTO {ks}.{tab} '
            '(a, b, c, d, e, f, g, h) '
            'VALUES ('
            'uuid(), uuid(), uuid(), uuid(), '
            'uuid(), uuid(), uuid(), uuid()'
            ')'.format(ks=keyspace_name, tab=table_name)
        )
    
        # record segments that we want to advance past
        initial_cl_files = _files_in(commitlog_dir)
    
        start = time.time()
        stop_time = start + timeout
        rate_limited_debug_logger = get_rate_limited_function(logger.debug, 5)
        logger.debug('attempting to write until we start writing to new CL segments: {}'.format(initial_cl_files))
    
        while _files_in(commitlog_dir) <= initial_cl_files:
            elapsed = time.time() - start
            rate_limited_debug_logger('  commitlog-advancing load step has lasted {s:.2f}s'.format(s=elapsed))
            assert (
                time.time() <= stop_time), "It's been over a {s}s and we haven't written a new " + \
>               "commitlog segment. Something is wrong.".format(s=timeout)
E           AssertionError: It's been over a {s}s and we haven't written a new commitlog segment. Something is wrong.

tools/hacks.py:61: AssertionError
---------------------------- Captured stdout setup -----------------------------
18:41:48,975 ccm DEBUG Log-watching thread starting.
------------------------------ Captured log setup ------------------------------
18:41:48,922 conftest INFO Starting execution of test_archive_commitlog_point_in_time at 2022-01-11 18:41:48.922687
18:41:48,923 dtest_setup INFO cluster ccm directory: /tmp/dtest-oqjvmef2
------------------------------ Captured log call -------------------------------
18:41:49,357 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/users/masix/cassandra, env={'LS_COLORS': 'rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=01;31:*.tzst=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.wim=01;31:*.swm=01;31:*.dwm=01;31:*.esd=01;31:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36:', 'HOSTTYPE': 'x86_64-linux', 'SSH_CONNECTION': '104.6.248.234 65373 128.105.145.106 22', 'LESSCLOSE': '/usr/bin/lesspipe %s %s', 'LANG': 'en_US.UTF-8', 'OLDPWD': '/users/masix/vm_images/ZebraConf/app_meta', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'VENDOR': 'unknown', 'MACHTYPE': 'x86_64', 'OSTYPE': 'linux', 'XDG_SESSION_ID': '295', 'USER': 'masix', 'GROUP': 'postman-PG0', 'PWD': '/users/masix/cassandra-dtest', 'HOME': '/users/masix', 'HOST': 'node0.2-220g2.postman-pg0.wisc.cloudlab.us', 'SSH_CLIENT': '104.6.248.234 65373 22', 'SSH_TTY': '/dev/pts/1', 'MAIL': '/var/mail/masix', 'REMOTEHOST': '104.6.248.234', 'TERM': 'xterm-256color', 'SHELL': '/bin/tcsh', 'SHLVL': '4', 'ZEBRACONF_HOME': '/users/masix/vm_images/ZebraConf', 'LOGNAME': 'masix', 'XDG_RUNTIME_DIR': '/run/user/20001', 'PATH': '/users/masix/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games', 'LESSOPEN': '| /usr/bin/lesspipe %s', '_': '/users/masix/dtest/bin/pytest', 'PYTEST_CURRENT_TEST': 'snapshot_test.py::TestArchiveCommitlog::()::test_archive_commitlog_point_in_time (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-oqjvmef2/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/users/masix/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-oqjvmef2/test/node1/conf'}
18:41:49,358 ccm INFO node1: using Java 8 for the current invocation
18:41:49,514 ccm INFO node1: current_java_version=8, current_java_home_version=8, jvm_version=None, for_build=False, cassandra_version=4.0.2, install_dir=/users/masix/cassandra, env={'LS_COLORS': 'rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=01;31:*.tzst=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.wim=01;31:*.swm=01;31:*.dwm=01;31:*.esd=01;31:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36:', 'HOSTTYPE': 'x86_64-linux', 'SSH_CONNECTION': '104.6.248.234 65373 128.105.145.106 22', 'LESSCLOSE': '/usr/bin/lesspipe %s %s', 'LANG': 'en_US.UTF-8', 'OLDPWD': '/users/masix/vm_images/ZebraConf/app_meta', 'JAVA_HOME': '/usr/lib/jvm/java-1.8.0-openjdk-amd64', 'VENDOR': 'unknown', 'MACHTYPE': 'x86_64', 'OSTYPE': 'linux', 'XDG_SESSION_ID': '295', 'USER': 'masix', 'GROUP': 'postman-PG0', 'PWD': '/users/masix/cassandra-dtest', 'HOME': '/users/masix', 'HOST': 'node0.2-220g2.postman-pg0.wisc.cloudlab.us', 'SSH_CLIENT': '104.6.248.234 65373 22', 'SSH_TTY': '/dev/pts/1', 'MAIL': '/var/mail/masix', 'REMOTEHOST': '104.6.248.234', 'TERM': 'xterm-256color', 'SHELL': '/bin/tcsh', 'SHLVL': '4', 'ZEBRACONF_HOME': '/users/masix/vm_images/ZebraConf', 'LOGNAME': 'masix', 'XDG_RUNTIME_DIR': '/run/user/20001', 'PATH': '/users/masix/dtest/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games', 'LESSOPEN': '| /usr/bin/lesspipe %s', '_': '/users/masix/dtest/bin/pytest', 'PYTEST_CURRENT_TEST': 'snapshot_test.py::TestArchiveCommitlog::()::test_archive_commitlog_point_in_time (call)', 'CASSANDRA_INCLUDE': '/tmp/dtest-oqjvmef2/test/node1/bin/cassandra.in.sh', 'MAX_HEAP_SIZE': '500M', 'HEAP_NEWSIZE': '50M', 'CASSANDRA_HOME': '/users/masix/cassandra', 'CASSANDRA_CONF': '/tmp/dtest-oqjvmef2/test/node1/conf', 'CASSANDRA_LIBJEMALLOC': '-', 'JVM_EXTRA_OPTS': ' -Dcassandra.migration_task_wait_in_seconds=2'}
18:41:49,515 ccm INFO node1: using Java 8 for the current invocation
18:41:49,593 ccm INFO Starting node1 with JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 java_version=8 cassandra_version=4.0.2, install_dir=/users/masix/cassandra
18:41:50,104 ccmlib.node WARNING [msx] ccmlib:node.py:start(), self.name= node1, self.pid= 19993
18:41:50,105 ccmlib.cluster WARNING [msx] ccmlib:cluster.py:start() p.pid= 19897 node.name= node1 node.pid= 19993
--------------------------- Captured stdout teardown ---------------------------
18:43:59,172 ccm DEBUG Log-watching thread exiting.
===Flaky Test Report===

test_archive_commitlog_point_in_time failed and was not selected for rerun.
	<class 'AssertionError'>
	It's been over a {s}s and we haven't written a new commitlog segment. Something is wrong.
	[<TracebackEntry /users/masix/cassandra-dtest/snapshot_test.py:259>, <TracebackEntry /users/masix/cassandra-dtest/snapshot_test.py:302>, <TracebackEntry /users/masix/cassandra-dtest/tools/hacks.py:61>]

===End Flaky Test Report===
========================== 1 failed in 130.91 seconds ==========================
[msx] rc = 1
